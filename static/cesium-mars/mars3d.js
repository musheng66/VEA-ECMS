// import Cesium from 'cesium/Cesium'
// import widgets from 'cesium/Widgets/widgets.css'
// window.Cesium = Cesium
!function(e){function t(r){if(i[r])return i[r].exports;var n=i[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var i={};t.m=e,t.c=i,t.i=function(e){return e},t.d=function(e,i,r){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=60)}([function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={createDragger:function(e,t){var i;if(t.dragger)i=t.dragger;else{var r=Cesium.defaultValue(t.position,Cesium.Cartesian3.ZERO);i=t.dragIcon?e.entities.add({position:r,billboard:{scale:1,image:t.dragIcon,heightReference:t.clampToGround?Cesium.HeightReference.CLAMP_TO_GROUND:Cesium.HeightReference.NONE}}):e.entities.add({position:r,point:{scale:1,color:new Cesium.Color.fromCssColorString("#3388ff").withAlpha(.4),pixelSize:10,outlineColor:new Cesium.Color.fromCssColorString("#ffffff"),outlineWidth:3,scaleByDistance:new Cesium.NearFarScalar(1e3,1,1e6,.4),heightReference:t.clampToGround?Cesium.HeightReference.CLAMP_TO_GROUND:Cesium.HeightReference.NONE}})}return i._isDragger=!0,i.onDrag=Cesium.defaultValue(t.onDrag,null),i.horizontal=Cesium.defaultValue(t.horizontal,!0),i.vertical=Cesium.defaultValue(t.vertical,!1),i.verticalCtrl=Cesium.defaultValue(t.vertical,!1),i},getCoordinates:function(e){for(var t=[],i=0;i<e.length;i++){var r=Cesium.Cartographic.fromCartesian(e[i]),n=Number(Cesium.Math.toDegrees(r.longitude).toFixed(6)),a=Number(Cesium.Math.toDegrees(r.latitude).toFixed(6)),o=Number(r.height.toFixed(1));t.push([n,a,o])}return t},getMaxHeightForPositions:function(e,t){null==t&&(t=0);var i=t;if(null==e||0==e.length)return i;for(var r=(e[0],0);r<e.length;r++){var n=Cesium.Cartographic.fromCartesian(e[r]);n.height>i&&(i=n.height)}return i},getPositionsWithHeight:function(e,t){if(e instanceof Array){for(var i=[],r=0;r<e.length;r++){var n=Cesium.Ellipsoid.WGS84.cartesianToCartographic(e[r]),a={lon:Cesium.Math.toDegrees(n.longitude),lat:Cesium.Math.toDegrees(n.latitude),hgt:Math.ceil(Number(n.height)+Number(t))},o=[a.lon,a.lat,a.hgt];i=i.concat(o)}return Cesium.Cartesian3.fromDegreesArrayHeights(i)}var n=Cesium.Ellipsoid.WGS84.cartesianToCartographic(e),s=Cesium.Math.toDegrees(n.longitude),l=Cesium.Math.toDegrees(n.latitude);return Cesium.Cartesian3.fromDegrees(s,l,Number(n.height)+Number(t))},getZHeightPosition:function(e,t){var i=Cesium.Cartographic.fromCartesian(e),r=Number(Cesium.Math.toDegrees(i.longitude)),n=Number(Cesium.Math.toDegrees(i.latitude)),a=Number(i.height.toFixed(2)),o=Cesium.Cartographic.fromCartesian(t),s=Number(Cesium.Math.toDegrees(o.longitude)),l=Number(Cesium.Math.toDegrees(o.latitude)),u=Number(o.height.toFixed(2));return a>u?Cesium.Cartesian3.fromDegrees(s,l,a):Cesium.Cartesian3.fromDegrees(r,n,u)},getHDistance:function(e,t){var i=this.getZHeightPosition(e,t),r=Cesium.Cartographic.fromCartesian(t),n=Cesium.Cartographic.fromCartesian(i),a=Cesium.Cartesian3.distance(e,i);return Math.abs(Number(n.height)-Number(r.height))<.01&&(a=Cesium.Cartesian3.distance(t,i)),a},getMidPosition:function(e,t){var i=Cesium.Cartographic.fromCartesian(e),r=Number(Cesium.Math.toDegrees(i.longitude)),n=Number(Cesium.Math.toDegrees(i.latitude)),a=Number(i.height.toFixed(2)),o=Cesium.Cartographic.fromCartesian(t),s=Number(Cesium.Math.toDegrees(o.longitude)),l=Number(Cesium.Math.toDegrees(o.latitude)),u=Number(o.height.toFixed(2)),c=(r+s)/2,h=(n+l)/2,d=(a+u)/2;return Cesium.Cartesian3.fromDegrees(c,h,d)},isArray:function(e){return"object"==typeof e&&e.constructor==Array},getPositionsFromJson:function(e){if(!e)return null;switch(e.type){case"Point":var t=e.coordinates;return 1==t.length&&this.isArray(t[0])&&(t=t[0]),this.lonLatToCartesian(t);case"MultiPoint":case"LineString":return this.lonLatsToCartesians(e.coordinates);case"MultiLineString":case"Polygon":return this.lonLatsToCartesians(e.coordinates[0]);case"MultiPolygon":return this.lonLatsToCartesians(e.coordinates[0][0]);default:throw new Error("Invalid GeoJSON object.")}},lonLatToCartesian:function(e){return Cesium.Cartesian3.fromDegrees(Number(e[0]),Number(e[1]),Number(e[2]||0))},lonLatsToCartesians:function(e){for(var t=[],i=0;i<e.length;i++){var r=[Number(e[i][0]),Number(e[i][1]),Number(e[i][2]||0)];t=t.concat(r)}return Cesium.Cartesian3.fromDegreesArrayHeights(t)},normalizeJsonData:function(e){var t={};t.type="FeatureCollection",t.features=[];var i;if((i="string"==typeof e?JSON.parse(e):e)instanceof Array){for(var r=0;r<i.length;r++){var n={type:"Feature"};n.properties=i[r].properties||i[r].PROPERTIES,n.geometry=i[r].geometry||i[r].GEOMETRY,t.features.push(n)}return JSON.stringify(t)}if(e.features&&e.features instanceof Array)return e},normalizeBusinessData:function(e){var t={};try{t=JSON.parse(e)}catch(e){return void haoutil.alert(e.name+": "+e.message+" \n请确认json文件格式正确!!!")}for(var i=t.features,r=[],n=0;n<i.length;n++){var a=i[n],o={dataID:a.properties.attr.id,dataType:a.properties.attr.type,properties:a.properties,geometry:a.geometry};r.push(o)}return JSON.stringify(r)}};t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){this._value=void 0,this._hasClone=!1,this._hasEquals=!1,this._definitionChanged=new Cesium.Event,this._constant=!1,this.setValue(e)};Cesium.defineProperties(r.prototype,{isConstant:{get:function(){return this._constant},set:function(e){this._constant!==e&&(this._constant=e,this._definitionChanged.raiseEvent(this))}},definitionChanged:{get:function(){return this._definitionChanged}}}),r.prototype.getValue=function(e,t){return this._hasClone?this._value.clone(t):this._value},r.prototype.setValue=function(e){var t=this._value;if(t!==e){var i=Cesium.defined(e),r=i&&"function"==typeof e.clone,n=i&&"function"==typeof e.equals;this._hasClone=r,this._hasEquals=n;(!n||!e.equals(t))&&(this._value=r?e.clone():e,this._definitionChanged.raiseEvent(this))}},r.prototype.equals=function(e){return this===e||e instanceof r&&(!this._hasEquals&&this._value===e._value||this._hasEquals&&this._value.equals(e._value))},r.prototype.valueOf=function(e){return this._value},r.prototype.toString=function(e){return String(this._value)},t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=L.Class.extend({config:{},viewer:null,initialize:function(e,t){this.viewer=t,this.config=e,this.name=e.name,this.config.alpha&&(this._opacity=this.config.alpha),this.config.hasOwnProperty("hasOpacity")&&(this.hasOpacity=this.config.hasOpacity),this.create(),e.visible?this.setVisible(!0):this._visible=!1,e.visible&&e.flyTo&&this.centerAt(0)},create:function(){},showError:function(e,t){t||(t="未知错误"),this.viewer&&this.viewer.cesiumWidget.showErrorPanel(e,void 0,t),console.log("layer错误:"+e+t)},_visible:null,getVisible:function(){return this._visible},setVisible:function(e){null!=this._visible&&this._visible==e||(this._visible=e,e?(this.config.msg&&window.haoutil&&window.haoutil.msg&&haoutil.msg(this.config.msg),this.add()):this.remove())},add:function(){this._visible=!0,this.config.onAdd&&this.config.onAdd()},remove:function(){this._visible=!1,this.config.onRemove&&this.config.onRemove()},centerAt:function(e){this.config.extent||this.config.center?this.viewer.mars.centerAt(this.config.extent||this.config.center,{duration:e,isWgs84:!0}):this.config.onCenterAt&&this.config.onCenterAt(e)},hasOpacity:!1,setOpacity:function(e){this.config.onSetOpacity&&this.config.onSetOpacity(e)},hasZIndex:!1,setZIndex:function(e){this.config.onSetZIndex&&this.config.onSetZIndex(e)},destroy:function(){this.setVisible(!1)}});t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(1).default,n=i(0).default,a=i(9).default,o={typename:"label",startDraw:function(e,t){var i=this.attribute2Entity(t);return e.entities.add({label:i,attribute:t})},attribute2Entity:function(e,t){e=e||{},e.style=e.style||{},null==t&&(t={scale:1,horizontalOrigin:Cesium.HorizontalOrigin.CENTER,verticalOrigin:Cesium.VerticalOrigin.BOTTOM});for(var i in e.style){var r=e.style[i];switch(i){default:t[i]=r;break;case"font_style":case"font_weight":case"font_size":case"font_family":case"text":case"scaleByDistance_near":case"scaleByDistance_nearValue":case"scaleByDistance_far":case"scaleByDistance_farValue":case"distanceDisplayCondition_far":case"distanceDisplayCondition_near":case"background_opacity":break;case"color":t.fillColor=new Cesium.Color.fromCssColorString(r||"#ffffff").withAlpha(Number(e.style.opacity||1));break;case"border":t.style=r?Cesium.LabelStyle.FILL_AND_OUTLINE:Cesium.LabelStyle.FILL;break;case"border_color":t.outlineColor=new Cesium.Color.fromCssColorString(r||"#000000").withAlpha(Number(e.style.opacity||1));break;case"border_width":t.outlineWidth=r;break;case"background":t.showBackground=r;break;case"background_color":t.backgroundColor=new Cesium.Color.fromCssColorString(r||"#000000").withAlpha(Number(e.style.background_opacity||e.style.opacity||.5));break;case"pixelOffset":t.pixelOffset=new Cesium.Cartesian2(e.style.pixelOffset[0],e.style.pixelOffset[1]);break;case"scaleByDistance":t.scaleByDistance=r?new Cesium.NearFarScalar(Number(e.style.scaleByDistance_near||1e3),Number(e.style.scaleByDistance_nearValue||1),Number(e.style.scaleByDistance_far||1e6),Number(e.style.scaleByDistance_farValue||.1)):null;break;case"distanceDisplayCondition":t.distanceDisplayCondition=r?new Cesium.DistanceDisplayCondition(Number(e.style.distanceDisplayCondition_near||0),Number(e.style.distanceDisplayCondition_far||1e5)):null}}t.text=(e.style.text||"文字").replace(new RegExp("<br />","gm"),"\n");var n=(e.style.font_style||"normal")+" small-caps "+(e.style.font_weight||"normal")+" "+(e.style.font_size||"25")+"px "+(e.style.font_family||"楷体");return t.font=n,t},getEditor:function(e,t,i){return new a(e,t,i)},setPositions:function(e,t){e.position=new r(t)},getPositions:function(e){return[e.position._value]},getCoordinates:function(e){var t=this.getPositions(e);return n.getCoordinates(t)},toGeoJSON:function(e){var t=this.getCoordinates(e);return{type:"Feature",properties:e.attribute,geometry:{type:"Point",coordinates:t[0]}}}};t.default=o},function(e,t,i){"use strict";function r(e){var t=Cesium.Cartographic.fromCartesian(e),i={};return i.y=Number(Cesium.Math.toDegrees(t.latitude).toFixed(6)),i.x=Number(Cesium.Math.toDegrees(t.longitude).toFixed(6)),i.z=Number(t.height.toFixed(1)),i}function n(e,t,i){var r,n=e.pick(t);if(e.pickPositionSupported&&Cesium.defined(n)){var a=n.id;if(null==i||i&&a!==i){var r=viewer.scene.pickPosition(t);if(Cesium.defined(r)){var o=Cesium.Cartographic.fromCartesian(r),s=o.height;if(s>=0)return r;if(!Cesium.defined(n.id)&&s>=-500)return r}}}if(e.mode===Cesium.SceneMode.SCENE3D){var l=e.camera.getPickRay(t);r=e.globe.pick(l,e)}else r=e.camera.pickEllipsoid(t,e.globe.ellipsoid);return r}function a(e,t){var i=e.scene,n=o(i),a=n;if(!a){var s=i.globe,l=i.camera.positionCartographic.clone(),u=s.getHeight(l);l.height=u||0,a=Cesium.Ellipsoid.WGS84.cartographicToCartesian(l)}var c=r(a);t&&(c=e.mars.point2wgs(c));var h=Cesium.Cartesian3.distance(a,e.scene.camera.positionWC);return c.cameraZ=h,c}function o(e){var t=e.canvas,i=new Cesium.Cartesian2(t.clientWidth/2,t.clientHeight/2),r=e.camera.getPickRay(i);return e.globe.pick(r,e)||e.camera.pickEllipsoid(i)}function s(e,t){var i={xmin:70,xmax:140,ymin:0,ymax:55},r=e.scene,n=r.globe.ellipsoid,a=r.canvas,o=e.camera.pickEllipsoid(new Cesium.Cartesian2(0,0),n);if(o){var s=n.cartesianToCartographic(o);i.xmin=Cesium.Math.toDegrees(s.longitude),i.ymax=Cesium.Math.toDegrees(s.latitude)}else{for(var l,u=a.width/2,c=a.height/2,h=0;h<=c;h+=10){var d=h<=u?h:u;if(l=e.camera.pickEllipsoid(new Cesium.Cartesian2(d,h),n))break}if(l){var s=n.cartesianToCartographic(l);i.xmin=Cesium.Math.toDegrees(s.longitude),i.ymax=Cesium.Math.toDegrees(s.latitude)}}var p=e.camera.pickEllipsoid(new Cesium.Cartesian2(a.width,a.height),n);if(p){var g=n.cartesianToCartographic(p);i.xmax=Cesium.Math.toDegrees(g.longitude),i.ymin=Cesium.Math.toDegrees(g.latitude)}else{for(var f,u=a.width/2,c=a.height/2,h=a.height;h>=c;h-=10){var d=h>=u?h:u;if(f=e.camera.pickEllipsoid(new Cesium.Cartesian2(d,h),n))break}if(f){var g=n.cartesianToCartographic(f);i.xmax=Cesium.Math.toDegrees(g.longitude),i.ymin=Cesium.Math.toDegrees(g.latitude)}}if(t){var m=e.mars.point2wgs({x:i.xmin,y:i.ymin});i.xmin=m.x,i.ymin=m.y;var y=e.mars.point2wgs({x:i.xmax,y:i.ymax});i.xmax=y.x,i.ymax=y.y}if(i.xmax<i.xmin){var v=i.xmax;i.xmax=i.xmin,i.xmin=v}if(i.ymax<i.ymin){var v=i.ymax;i.ymax=i.ymin,i.ymin=v}return i}function l(e,t){var i=e.camera,r=i.positionCartographic,n={};return n.y=Number(Cesium.Math.toDegrees(r.latitude).toFixed(6)),n.x=Number(Cesium.Math.toDegrees(r.longitude).toFixed(6)),n.z=Number(r.height.toFixed(1)),n.heading=Number(Cesium.Math.toDegrees(i.heading||-90).toFixed(1)),n.pitch=Number(Cesium.Math.toDegrees(i.pitch||0).toFixed(1)),n.roll=Number(Cesium.Math.toDegrees(i.roll||0).toFixed(1)),t&&(n=e.mars.point2wgs(n)),n}Object.defineProperty(t,"__esModule",{value:!0}),i.d(t,"getCurrentMousePosition",function(){return n}),i.d(t,"getCenter",function(){return a}),i.d(t,"getExtent",function(){return s}),i.d(t,"getCameraView",function(){return l}),i.d(t,"formatPositon",function(){return r}),i.d(t,"windingPoint",function(){return u}),i.d(t,"aroundPoint",function(){return c});var u={isStart:!1,viewer:null,start:function(e,t){t||(t=a(e)),this.viewer=e,this.position=Cesium.Cartesian3.fromDegrees(t.x,t.y,t.z),this.distance=t.distance||Cesium.Cartesian3.distance(this.position,e.camera.positionWC),this.angle=360/(t.time||60),this.time=e.clock.currentTime.clone(),this.heading=e.camera.heading,this.pitch=e.camera.pitch,this.viewer.clock.onTick.addEventListener(this.clock_onTickHandler,this),this.isStart=!0},clock_onTickHandler:function(e){var t=Cesium.JulianDate.secondsDifference(this.viewer.clock.currentTime,this.time),i=Cesium.Math.toRadians(t*this.angle)+this.heading;this.viewer.scene.camera.setView({destination:this.position,orientation:{heading:i,pitch:this.pitch}}),this.viewer.scene.camera.moveBackward(this.distance)},stop:function(){this.isStart&&(this.viewer&&this.viewer.clock.onTick.removeEventListener(this.clock_onTickHandler,this),this.isStart=!1)}},c={isStart:!1,viewer:null,start:function(e,t){t||(t=a(e)),this.viewer=e,this.position=Cesium.Cartesian3.fromDegrees(t.x,t.y,t.z),this.angle=360/(t.time||60),this.time=e.clock.currentTime.clone(),this.heading=e.camera.heading,this.pitch=e.camera.pitch,this.viewer.clock.onTick.addEventListener(this.clock_onTickHandler,this),this.isStart=!0},clock_onTickHandler:function(e){var t=Cesium.JulianDate.secondsDifference(this.viewer.clock.currentTime,this.time),i=Cesium.Math.toRadians(t*this.angle)+this.heading;viewer.scene.camera.setView({orientation:{heading:i,pitch:this.pitch}})},stop:function(){this.isStart&&(this.viewer&&this.viewer.clock.onTick.removeEventListener(this.clock_onTickHandler,this),this.isStart=!1)}}},function(e,t,i){"use strict";function r(e){return"number"==typeof e&&e.constructor==Number}function n(e){return"string"==typeof e&&e.constructor==String}function a(){var e=location.search,t=new Object;if(-1!=e.indexOf("?"))for(var i=e.substr(1),r=i.split("&"),n=0;n<r.length;n++)t[r[n].split("=")[0]]=decodeURI(r[n].split("=")[1]);return t}function o(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),i=window.location.search.substr(1).match(t);return null!=i?decodeURI(i[2]):null}function s(e){if(null==e||"object"!=typeof e)return e;if(e instanceof Date){var t=new Date;return t.setTime(e.getTime()),t}if(e instanceof Array){for(var t=[],i=0,r=e.length;i<r;++i)t[i]=s(e[i]);return t}if("object"==typeof e){var t={};for(var n in e)"_layer"!=n&&"_layers"!=n&&"_parent"!=n&&e.hasOwnProperty(n)&&(t[n]=s(e[n]));return t}return e}function l(){var e=navigator.userAgent.toLowerCase(),t="ipad"==e.match(/ipad/i),i="iphone"==e.match(/iphone/i),r="midp"==e.match(/midp/i),n="rv:1.2.3.4"==e.match(/rv:1.2.3.4/i),a="ucweb"==e.match(/ucweb/i),o="android"==e.match(/android/i),s="windows ce"==e.match(/windows ce/i),l="windows mobile"==e.match(/windows mobile/i);return!(t||i||r||n||a||o||s||l)}function u(){var e=haoutil.system.getExplorerInfo();if("IE"==e.type&&e.version<11)return!1;try{var t,i=document.createElement("canvas");if("undefined"!=typeof WebGL2RenderingContext&&(t=i.getContext("webgl2")||i.getContext("experimental-webgl2")||void 0),null==t&&(t=i.getContext("webgl")||i.getContext("experimental-webgl")||void 0),null==t)return!1}catch(e){return!1}return!0}function c(e){var t=e.viewer,i=e.positions;if(null==i||0==i.length)return void(e.calback&&e.calback(i));for(var r=Cesium.PolylinePipeline.generateArc({positions:i,granularity:e.granularity||1e-5}),n=[],a=t.scene.globe.ellipsoid,o=0;o<r.length;o+=3){var s=Cesium.Cartesian3.unpack(r,o);n.push(a.cartesianToCartographic(s))}var l=Cesium.Cartographic.fromCartesian(i[0]).height;Cesium.when(Cesium.sampleTerrainMostDetailed(t.terrainProvider,n),function(r){for(var n=!1,o=e.offset||2,s=0;s<r.length;++s)null==r[s].height?(n=!0,r[s].height=l):r[s].height=o+r[s].height*t.scene._terrainExaggeration;var u=a.cartographicArrayToCartesianArray(r);e.calback?e.calback(u,n):i.setValue&&i.setValue(u)})}function h(){return f}function d(e){e.hasOwnProperty("requestWaterMask")||(e.requestWaterMask=!0),e.hasOwnProperty("requestVertexNormals")||(e.requestVertexNormals=!0);return""==e.url||null==e.url||"cesium"==e.url?new Cesium.CesiumTerrainProvider({url:Cesium.IonResource.fromAssetId(1)}):"ellipsoid"==e.url||"null"==e.url?f:new Cesium.CesiumTerrainProvider(e)}function p(e,t){e=t.mars.point2map(e);var i=Cesium.Cartesian3.fromDegrees(e.x,e.y,e.z||0),r=Cesium.Math.toRadians(e.heading||0),n=Cesium.Math.toRadians(e.pitch||0),a=Cesium.Math.toRadians(e.roll||0),o=new Cesium.HeadingPitchRoll(r,n,a),s=Cesium.Transforms.headingPitchRollQuaternion(i,o);return t.entities.add({name:e.name||"",position:i,orientation:s,model:e,tooltip:e.tooltip,popup:e.popup})}function g(e){e=Math.abs(e);var t=Math.floor(e);return t+"° "+Math.floor(60*(e-t))+"'  "+Math.round(3600*(e-t)%60)+'"'}Object.defineProperty(t,"__esModule",{value:!0}),i.d(t,"getRequest",function(){return a}),i.d(t,"getRequestByName",function(){return o}),i.d(t,"isNumber",function(){return r}),i.d(t,"isString",function(){return n}),i.d(t,"isPCBroswer",function(){return l}),i.d(t,"clone",function(){return s}),i.d(t,"webglreport",function(){return u}),i.d(t,"terrainPolyline",function(){return c}),i.d(t,"getEllipsoidTerrain",function(){return h}),i.d(t,"getTerrainProvider",function(){return d}),i.d(t,"createModel",function(){return p}),i.d(t,"formatDegree",function(){return g});var f=new Cesium.EllipsoidTerrainProvider({ellipsoid:Cesium.Ellipsoid.WGS84})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(1).default,n=i(0).default,a=i(9).default,o={typename:"billboard",startDraw:function(e,t){var i=this.attribute2Entity(t);return e.entities.add({billboard:i,attribute:t})},attribute2Entity:function(e,t){e=e||{},e.style=e.style||{},null==t&&(t={scale:1,horizontalOrigin:Cesium.HorizontalOrigin.CENTER,verticalOrigin:Cesium.VerticalOrigin.BOTTOM});for(var i in e.style){var r=e.style[i];switch(i){default:t[i]=r;break;case"scaleByDistance_near":case"scaleByDistance_nearValue":case"scaleByDistance_far":case"scaleByDistance_farValue":case"distanceDisplayCondition_far":case"distanceDisplayCondition_near":break;case"opacity":t.color=new Cesium.Color.fromCssColorString("#FFFFFF").withAlpha(Number(r||1));break;case"rotation":t.rotation=Cesium.Math.toRadians(r);break;case"scaleByDistance":t.scaleByDistance=r?new Cesium.NearFarScalar(Number(e.style.scaleByDistance_near||1e3),Number(e.style.scaleByDistance_nearValue||1),Number(e.style.scaleByDistance_far||1e6),Number(e.style.scaleByDistance_farValue||.1)):null;break;case"distanceDisplayCondition":t.distanceDisplayCondition=r?new Cesium.DistanceDisplayCondition(Number(e.style.distanceDisplayCondition_near||0),Number(e.style.distanceDisplayCondition_far||1e5)):null}}return t},getEditor:function(e,t,i){return new a(e,t,i)},setPositions:function(e,t){e.position=new r(t)},getPositions:function(e){return[e.position._value]},getCoordinates:function(e){var t=this.getPositions(e);return n.getCoordinates(t)},toGeoJSON:function(e){var t=this.getCoordinates(e);return{type:"Feature",properties:e.attribute,geometry:{type:"Point",coordinates:t[0]}}}};t.default=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(1).default,n=i(0).default,a=i(31).default,o=i(30).default,s={typename:"polygon",startDraw:function(e,t){var i=this.attribute2Entity(t);return e.entities.add({polygon:i,attribute:t})},attribute2Entity:function(e,t){e=e||{},e.style=e.style||{},null==t&&(t={fill:!0,classificationType:Cesium.ClassificationType.BOTH,hierarchy:new r([])});for(var i in e.style){var a=e.style[i];switch(i){default:t[i]=a;break;case"opacity":case"outlineOpacity":break;case"outlineColor":t.outlineColor=new Cesium.Color.fromCssColorString(a||e.style.color||"#FFFF00").withAlpha(e.style.outlineOpacity||e.style.opacity||1);break;case"color":t.material=new Cesium.Color.fromCssColorString(a||"#FFFF00").withAlpha(Number(e.style.opacity||1));break;case"extrudedHeight":var o=n.getMaxHeightForPositions(t.hierarchy._value);t.extrudedHeight=Number(a)+o;break;case"clampToGround":t.perPositionHeight=!a}}return null==e.style.color&&(t.material=Cesium.Color.fromRandom({minimumGreen:.75,maximumBlue:.75,alpha:Number(e.style.opacity||1)})),t},getEditor:function(e,t,i){return t.polygon.extrudedHeight?new a(e,t,i):new o(e,t,i)},setPositions:function(e,t){if(e.polygon.hierarchy=new r(t),e.attribute.style.extrudedHeight){var i=n.getMaxHeightForPositions(t);e.polygon.extrudedHeight=i+Number(e.attribute.style.extrudedHeight)}},getPositions:function(e){var t=e.polygon.hierarchy._value;return t.positions&&this.isArray(t.positions)?t.positions:t},isArray:function(e){return"object"==typeof e&&e.constructor==Array},getCoordinates:function(e){var t=this.getPositions(e);return n.getCoordinates(t)},toGeoJSON:function(e){var t=this.getCoordinates(e);if(t.length>0){var i=t[0],r=t[t.length-1];i[0]==r[0]&&i[1]==r[1]&&i[2]==r[2]||t.push(i)}return{type:"Feature",properties:e.attribute,geometry:{type:"Polygon",coordinates:[t]}}}};t.default=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(1).default,n=i(0).default,a=i(32).default,o={typename:"polyline",startDraw:function(e,t){var i=this.attribute2Entity(t);return e.entities.add({polyline:i,attribute:t})},attribute2Entity:function(e,t){e=e||{},e.style=e.style||{},null==t&&(t={followSurface:!0,positions:new r([])});for(var i in e.style){var n=e.style[i];switch(i){default:t[i]=n;break;case"lineType":case"color":case"opacity":case"outline":case"outlineWidth":case"outlineColor":case"outlineOpacity":}}var a=new Cesium.Color.fromCssColorString(e.style.color||"#FFFF00").withAlpha(Number(e.style.opacity||1));switch(e.style.lineType){default:case"solid":e.style.outline?t.material=new Cesium.PolylineOutlineMaterialProperty({color:a,outlineWidth:Number(e.style.outlineWidth||1),outlineColor:new Cesium.Color.fromCssColorString(e.style.outlineColor||"#FFFF00").withAlpha(Number(e.style.outlineOpacity||e.style.opacity||1))}):t.material=a;break;case"dash":e.style.outline?t.material=new Cesium.PolylineDashMaterialProperty({dashLength:e.style.dashLength||e.style.outlineWidth||16,color:a,gapColor:new Cesium.Color.fromCssColorString(e.style.outlineColor||"#FFFF00").withAlpha(Number(e.style.outlineOpacity||e.style.opacity||1))}):t.material=new Cesium.PolylineDashMaterialProperty({dashLength:e.style.dashLength||16,color:a});break;case"glow":t.material=new Cesium.PolylineGlowMaterialProperty({glowPower:e.style.glowPower||.1,color:a});break;case"arrow":t.material=new Cesium.PolylineArrowMaterialProperty(a)}return t},getEditor:function(e,t,i){return new a(e,t,i)},setPositions:function(e,t){e.polyline.positions.setValue(t)},getPositions:function(e){return e.polyline.positions._value},getCoordinates:function(e){var t=this.getPositions(e);return n.getCoordinates(t)},toGeoJSON:function(e){var t=this.getCoordinates(e);return{type:"Feature",properties:e.attribute,geometry:{type:"LineString",coordinates:t}}}};t.default=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(0).default,n=function(e,t,i){this.dataSource=e,this.entity=t,this.draggers=[];r.createDragger(this.dataSource,{dragger:t,onDrag:function(e,i){var r=new Cesium.Cartesian3;Cesium.Cartesian3.subtract(i,t.position._value,r),t.position._value=i,t.changeEditing()}})};n.prototype.updateDraggers=function(){},n.prototype.destroy=function(){this.draggers=[]},t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(5),n=i(2).default,a=i(6).default,o=i(3).default,s=i(8).default,l=i(7).default,u=n.extend({dataSource:null,add:function(){this.dataSource?this.viewer.dataSources.add(this.dataSource):this.queryData()},remove:function(){this.viewer.dataSources.remove(this.dataSource)},centerAt:function(e){if(this.config.extent||this.config.center)this.viewer.mars.centerAt(this.config.extent||this.config.center,{duration:e,isWgs84:!0});else{if(null==this.dataSource)return;this.viewer.flyTo(this.dataSource.entities.values,{duration:e})}},hasOpacity:!0,_opacity:.9,setOpacity:function(e){if(this._opacity=e,null!=this.dataSource)for(var t=this.dataSource.entities.values,i=0;i<t.length;i++){var r=t[i];r.polygon&&r.polygon.material&&r.polygon.material.color&&(this._updatEntityAlpha(r.polygon.material.color,this._opacity),r.polygon.outlineColor&&this._updatEntityAlpha(r.polygon.outlineColor,this._opacity)),r.polyline&&r.polyline.material&&r.polyline.material.color&&this._updatEntityAlpha(r.polyline.material.color,this._opacity),r.billboard&&(r.billboard.color=new Cesium.Color.fromCssColorString("#FFFFFF").withAlpha(this._opacity)),r.model&&(r.model.color=new Cesium.Color.fromCssColorString("#FFFFFF").withAlpha(this._opacity)),r.label&&(r.label.fillColor&&this._updatEntityAlpha(r.label.fillColor,this._opacity),r.label.outlineColor&&this._updatEntityAlpha(r.label.outlineColor,this._opacity),r.label.backgroundColor&&this._updatEntityAlpha(r.label.backgroundColor,this._opacity))}},_updatEntityAlpha:function(e,t){var i=e.getValue().withAlpha(t);e.setValue(i)},queryData:function(){var e=this;Cesium.GeoJsonDataSource.load(this.config.url,{clampToGround:!0}).then(function(t){e.showResult(t)}).otherwise(function(t){e.showError("服务出错",t)})},showResult:function(e){var t=this;this.dataSource=e,this.viewer.dataSources.add(e),this.config.flyTo&&this.centerAt();for(var i=e.entities.values,n=0;n<i.length;n++){var a=i[n];this.config.symbol&&("default"==this.config.symbol?this.setDefSymbol(a):this.setConfigSymbol(a,this.config.symbol)),(this.config.columns||this.config.popup)&&(a.popup={html:function(e){var i=t.getEntityAttr(e);return r.isString(i)?i:t.viewer.mars.popup.getPopupForConfig(t.config,i)},anchor:this.config.popupAnchor||[0,-15]}),this.config.tooltip&&(a.tooltip={html:function(e){var i=t.getEntityAttr(e);return r.isString(i)?i:t.viewer.mars.popup.getPopupForConfig({popup:t.config.tooltip},i)},anchor:this.config.tooltipAnchor||[0,-15]})}},getEntityAttr:function(e){return e.properties},colorHash:{},setDefSymbol:function(e){if(e.polygon){var t=e.properties.OBJECTID,i=this.colorHash[t];i||(i=Cesium.Color.fromRandom({minimumGreen:.75,maximumBlue:.75,alpha:this._opacity}),this.colorHash[t]=i),e.polygon.material=i,e.polygon.outline=!0,e.polygon.outlineColor=Cesium.Color.WHITE}else if(e.polyline){var t=e.properties.OBJECTID,i=this.colorHash[t];i||(i=Cesium.Color.fromRandom({minimumGreen:.75,maximumBlue:.75,alpha:this._opacity}),this.colorHash[t]=i),e.polyline.material=i,e.polyline.width=2}else e.billboard&&(e.billboard.scale=.5,e.billboard.horizontalOrigin=Cesium.HorizontalOrigin.CENTER,e.billboard.verticalOrigin=Cesium.VerticalOrigin.BOTTOM)},setConfigSymbol:function(e,t){var i=e.properties,r=t.styleOptions;if(t.styleField){var n=i[t.styleField],u=t.styleFieldOptions[n];null!=u&&(r=haoutil.system.clone(r),r=$.extend(r,u))}if(r=r||{},this._opacity=r.opacity||1,e.polygon){if(l.attribute2Entity({style:r},e.polygon),r.outlineWidth&&r.outlineWidth>1){e.polygon.outline=!1;var c={color:r.outlineColor,width:r.outlineWidth,opacity:r.outlineOpacity,lineType:"solid",clampToGround:!0,outline:!1},h=s.attribute2Entity({style:c});h.positions=e.polygon.hierarchy._value.positions,this.dataSource._entityCollection.add({polyline:h})}}else e.polyline?s.attribute2Entity({style:r},e.polyline):e.billboard&&(e.billboard.heightReference=Cesium.HeightReference.RELATIVE_TO_GROUND,a.attribute2Entity({style:r},e.billboard),r.label&&r.label.field&&(r.label.heightReference=Cesium.HeightReference.RELATIVE_TO_GROUND,e.label=o.attribute2Entity({style:r.label}),e.label.text=i[r.label.field]));e.attribute=r}});t.default=u},function(e,t,i){var r,n,a;!function(i,o){n=[],r=o,void 0!==(a="function"==typeof r?r.apply(t,n):r)&&(e.exports=a)}(0,function(){var e=52.35987755982988,t=3.141592653589793,i=6378245,r=.006693421622965943,n=function(e){var t=Number(e[0]),i=Number(e[1]),r=52.35987755982988,n=t-.0065,a=i-.006,o=Math.sqrt(n*n+a*a)-2e-5*Math.sin(a*r),s=Math.atan2(a,n)-3e-6*Math.cos(n*r),l=o*Math.cos(s),u=o*Math.sin(s);return l=Number(l.toFixed(6)),u=Number(u.toFixed(6)),[l,u]},a=function(t){var i=Number(t[0]),r=Number(t[1]),n=Math.sqrt(i*i+r*r)+2e-5*Math.sin(r*e),a=Math.atan2(r,i)+3e-6*Math.cos(i*e),o=n*Math.cos(a)+.0065,s=n*Math.sin(a)+.006;return o=Number(o.toFixed(6)),s=Number(s.toFixed(6)),[o,s]},o=function(e){var n=Number(e[0]),a=Number(e[1]);if(d(n,a))return[n,a];var o=c(n-105,a-35),s=h(n-105,a-35),l=a/180*t,u=Math.sin(l);u=1-r*u*u;var p=Math.sqrt(u);o=180*o/(i*(1-r)/(u*p)*t),s=180*s/(i/p*Math.cos(l)*t);var g=a+o,f=n+s;return f=Number(f.toFixed(6)),g=Number(g.toFixed(6)),[f,g]},s=function(e){var n=Number(e[0]),a=Number(e[1]);if(d(n,a))return[n,a];var o=c(n-105,a-35),s=h(n-105,a-35),l=a/180*t,u=Math.sin(l);u=1-r*u*u;var p=Math.sqrt(u);o=180*o/(i*(1-r)/(u*p)*t),s=180*s/(i/p*Math.cos(l)*t),mglat=a+o,mglng=n+s;var g=2*n-mglng,f=2*a-mglat;return g=Number(g.toFixed(6)),f=Number(f.toFixed(6)),[g,f]},l=function(e){return s(n(e))},u=function(e){return a(o(e))},c=function(e,i){var r=2*e-100+3*i+.2*i*i+.1*e*i+.2*Math.sqrt(Math.abs(e));return r+=2*(20*Math.sin(6*e*t)+20*Math.sin(2*e*t))/3,r+=2*(20*Math.sin(i*t)+40*Math.sin(i/3*t))/3,r+=2*(160*Math.sin(i/12*t)+320*Math.sin(i*t/30))/3},h=function(e,i){var r=300+e+2*i+.1*e*e+.1*e*i+.1*Math.sqrt(Math.abs(e));return r+=2*(20*Math.sin(6*e*t)+20*Math.sin(2*e*t))/3,r+=2*(20*Math.sin(e*t)+40*Math.sin(e/3*t))/3,r+=2*(150*Math.sin(e/12*t)+300*Math.sin(e/30*t))/3},d=function(e,t){return e<72.004||e>137.8347||t<.8293||t>55.8271||!1};return{jwd2mct:function(e){var i=Number(e[0]),r=Number(e[1]),n=20037508.34*i/180,a=Math.log(Math.tan((90+r)*t/360))/(t/180);return a=20037508.34*a/180,n=Number(n.toFixed(2)),a=Number(a.toFixed(2)),[n,a]},mct2jwd:function(e){var i=Number(e[0]),r=Number(e[1]),n=i/20037508.34*180,a=r/20037508.34*180;return a=180/t*(2*Math.atan(Math.exp(a*t/180))-t/2),n=Number(n.toFixed(6)),a=Number(a.toFixed(6)),[n,a]},bd2gcj:n,gcj2bd:a,bd2wgs:l,wgs2bd:u,wgs2gcj:o,gcj2wgs:s}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(1).default,n=i(0).default,a=i(9).default,o={typename:"point",startDraw:function(e,t){var i=this.attribute2Entity(t);return e.entities.add({point:i,attribute:t})},attribute2Entity:function(e,t){e=e||{},e.style=e.style||{},null==t&&(t={});for(var i in e.style){var r=e.style[i];switch(i){default:t[i]=r;break;case"opacity":case"outlineOpacity":case"scaleByDistance_near":case"scaleByDistance_nearValue":case"scaleByDistance_far":case"scaleByDistance_farValue":case"distanceDisplayCondition_far":case"distanceDisplayCondition_near":break;case"outlineColor":t.outlineColor=new Cesium.Color.fromCssColorString(r||"#FFFF00").withAlpha(e.style.outlineOpacity||e.style.opacity||1);break;case"color":t.color=new Cesium.Color.fromCssColorString(r||"#FFFF00").withAlpha(Number(e.style.opacity||1));break;case"scaleByDistance":t.scaleByDistance=r?new Cesium.NearFarScalar(Number(e.style.scaleByDistance_near||1e3),Number(e.style.scaleByDistance_nearValue||1),Number(e.style.scaleByDistance_far||1e6),Number(e.style.scaleByDistance_farValue||.1)):null;break;case"distanceDisplayCondition":t.distanceDisplayCondition=r?new Cesium.DistanceDisplayCondition(Number(e.style.distanceDisplayCondition_near||0),Number(e.style.distanceDisplayCondition_far||1e5)):null}}return e.style.outline||(t.outlineWidth=0),t},getEditor:function(e,t,i){return new a(e,t,i)},setPositions:function(e,t){e.position=new r(t)},getPositions:function(e){return[e.position._value]},getCoordinates:function(e){var t=this.getPositions(e);return n.getCoordinates(t)},toGeoJSON:function(e){var t=this.getCoordinates(e);return{type:"Feature",properties:e.attribute,geometry:{type:"Point",coordinates:t[0]}}}};t.default=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(46).default,n=i(6).default,a=i(3).default,o=i(8).default,s=i(7).default,l=r.extend({_cacheGrid:{},_cacheFeature:{},_addImageryCache:function(e){this._cacheGrid[e.key]={opts:e,isLoading:!0};var t=this;this.getDataForGrid(e,function(i){t._visible&&t._showData(e,i)})},getDataForGrid:function(e,t){this.config.getDataForGrid&&this.config.getDataForGrid(e,t)},checkHasBreak:function(e){return!this._visible||!this._cacheGrid[e]},_showData:function(e,t){function i(e){n._cacheFeature[u]={grid:[r],entity:e}}var r=e.key;if(!this.checkHasBreak[r]){for(var n=this,a=[],o=0,s=t.length;o<s;o++){var l=t[o],u=l[this.config.IdName||"id"],c=this._cacheFeature[u];if(c)c.grid.push(r),this.updateEntity(c.entity,l);else{var h=this.createEntity(e,l,i);null!=h&&i(h)}a.push(u)}this._cacheGrid[r]=this._cacheGrid[r]||{},this._cacheGrid[r].ids=a,this._cacheGrid[r].isLoading=!1}},createEntity:function(e,t){return this.config.createEntity?this.config.createEntity(e,t):null},updateEntity:function(e,t){this.config.updateEntity&&this.config.updateEntity(e,t)},_removeImageryCache:function(e){var t=e.key,i=this._cacheGrid[t];if(i){if(i.ids)for(var r=0;r<i.ids.length;r++){var n=i.ids[r],a=this._cacheFeature[n];a&&(a.grid.remove(t),0==a.grid.length&&(this.dataSource.entities.remove(a.entity),delete this._cacheFeature[n]))}delete this._cacheGrid[t]}},removeEx:function(){this.dataSource.entities.removeAll(),this._cacheFeature={},this._cacheGrid={},this.viewer.dataSources.remove(this.dataSource)},reload:function(){var e=this;for(var t in this._cacheGrid){var i=this._cacheGrid[t];if(null!=i&&null!=i.opts&&!i.isLoading){var r=i.opts;this.getDataForGrid(r,function(t){e._showData(r,t)})}}},hasOpacity:!0,_opacity:1,setOpacity:function(e){this._opacity=e;for(var t in this._cacheFeature){var i=this._cacheFeature[t].entity;i.polygon&&i.polygon.material&&i.polygon.material.color?(this._updatEntityAlpha(i.polygon.material.color,this._opacity),i.polygon.outlineColor&&this._updatEntityAlpha(i.polygon.outlineColor,this._opacity)):i.polyline&&i.polyline.material&&i.polyline.material.color?this._updatEntityAlpha(i.polyline.material.color,this._opacity):i.billboard&&(i.billboard.color=new Cesium.Color.fromCssColorString("#FFFFFF").withAlpha(this._opacity),i.label&&(i.label.fillColor&&this._updatEntityAlpha(i.label.fillColor,this._opacity),i.label.outlineColor&&this._updatEntityAlpha(i.label.outlineColor,this._opacity),i.label.backgroundColor&&this._updatEntityAlpha(i.label.backgroundColor,this._opacity)))}},_updatEntityAlpha:function(e,t){var i=e.getValue().withAlpha(t);e.setValue(i)},colorHash:{},setDefSymbol:function(e){if(e.polygon){var t=e.properties.OBJECTID,i=this.colorHash[t];i||(i=Cesium.Color.fromRandom({minimumGreen:.75,maximumBlue:.75,alpha:this._opacity}),this.colorHash[t]=i),e.polygon.material=i,e.polygon.outline=!0,e.polygon.outlineColor=Cesium.Color.WHITE}else if(e.polyline){var t=e.properties.OBJECTID,i=this.colorHash[t];i||(i=Cesium.Color.fromRandom({minimumGreen:.75,maximumBlue:.75,alpha:this._opacity}),this.colorHash[t]=i),e.polyline.material=i,e.polyline.width=2}else e.billboard&&(e.billboard.scale=.5,e.billboard.horizontalOrigin=Cesium.HorizontalOrigin.CENTER,e.billboard.verticalOrigin=Cesium.VerticalOrigin.BOTTOM)},setConfigSymbol:function(e,t){var i=e.properties,r=t.styleOptions;if(t.styleField){var l=i[t.styleField],u=t.styleFieldOptions[l];null!=u&&(r=haoutil.system.clone(r),r=$.extend(r,u))}if(r=r||{},this._opacity=r.opacity||1,e.polygon){if(s.attribute2Entity({style:r},e.polygon),r.outlineWidth&&r.outlineWidth>1){e.polygon.outline=!1;var c={color:r.outlineColor,width:r.outlineWidth,opacity:r.outlineOpacity,lineType:"solid",outline:!1},h=o.attribute2Entity({style:c});h.positions=e.polygon.hierarchy._value.positions,this.dataSource.entities.add({polyline:h})}if(this.config.buildings){var d=Number(i[this.config.buildings.cloumn]||1),p=Number(this.config.buildings.height||5);e.polygon.extrudedHeight=d*p}}else e.polyline?o.attribute2Entity({style:r},e.polyline):e.billboard&&(e.billboard.heightReference=Cesium.HeightReference.RELATIVE_TO_GROUND,n.attribute2Entity({style:r},e.billboard),r.label&&r.label.field&&(r.label.heightReference=Cesium.HeightReference.RELATIVE_TO_GROUND,e.label=a.attribute2Entity({style:r.label}),e.label.text=i[r.label.field]))}});t.default=l},function(t,i,r){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=r(6).default,a=r(3).default,o=r(15).default,s=r(8).default,l=r(18).default,u=r(7).default,c=r(16).default,h=r(12).default,d=r(19).default,p=r(17).default,g=r(20).default,f=r(37).default,m=r(5),y=r(0).default,v=function(t){function i(e){null!=W&&W==e||(W=e,e?(J.createEditSelectHandler(function(e){if(!U||!U.inProgress)return null==e?(v(),void(t.onStopEditing&&"function"==typeof t.onStopEditing&&t.onStopEditing(null))):void(e!==U&&(U&&U.stopEditing&&(U.stopEditing(),U=null),(U=e)&&U.startEditing&&U.startEditing()))}),J.createEditDraggerHandler()):(v(),J.destroyEditHandler()))}function r(e){if(v(),null==e||null==e.type)throw"请传入需要绘制的类型参数";var t=e.type;if(null==j[t])throw"传入的["+t+"]类型参数有误";e.style=e.style||{},e.attr=e.attr||{},e=R(e);var i=j[t].startDraw(V,e);switch(t){case"label":case"point":case"billboard":case"model":case"ellipse":case"ellipsoid":J.createDrawPointHandler(i);break;case"polyline":case"polylineVolume":J.createDrawPolylineHandler(i,j[t].getPositions(i));break;case"polygon":J.createDrawPolygonHandler(i,j[t].getPositions(i));break;case"rectangle":case"extrudedRectangle":case"measureHeight":J.createTwoPointsModelHandler(i,j[t].getPositions(i));break;case"wall":var r=j[t].getPositions(i),n=j[t].getMinimumHeights(i),a=j[t].getMaximumHeights(i);J.createDrawWallHandler(i,r,n,a)}return w(i),Z.push(i),i.startDrawing(),U=i,i}function v(e){return J.destroyDrawHandler(),U&&U.inProgress&&(U.stopDrawing(e),V.entities.remove(U),G(Z,U)),U&&U.stopEditing&&(U.stopEditing(e),U=null),this}function b(e,i){if(null!=i&&(U=i),null!=U&&null!=e){e.style=e.style||{},e.attr=e.attr||{};var r=U.attribute.type;return j[r].attribute2Entity(e,U[r]),"model"==r&&j[r].attribute2Model(e,U),U.attribute=e,"ellipse"!=r&&"polygon"!=r&&"wall"!=r&&"rectangle"!=r||U.editor.updateDraggers(),t.tooltip&&(U.attribute.attr&&U.attribute.attr.name?U.tooltip=U.attribute.attr.name:U.tooltip=null),U}}function C(e,t){if(null==t&&(t=U),null!=t&&null!=e){var i=t.attribute.type;if(j[i].setPositions(t,e),t.editor&&t.editor.destroy){t.editor.destroy();var i=t.attribute.type;t.editor=j[i].getEditor(V,t,{dragIcon:z})}return t}}function w(e){e.startDrawing=function(){$(".cesium-viewer").css("cursor","crosshair");var e=this;t.onStartDrawing&&"function"==typeof t.onStartDrawing&&t.onStartDrawing(e)},e.changeDrawing=function(){var e=this;t.onChangeDrawing&&"function"==typeof t.onChangeDrawing&&t.onChangeDrawing(e)},e.moveDrawing=function(){var e=this;t.onMoveDrawing&&"function"==typeof t.onMoveDrawing&&t.onMoveDrawing(e)},e.stopDrawing=function(){$(".cesium-viewer").css("cursor","");var e=this;t.onStopDrawing&&"function"==typeof t.onStopDrawing&&t.onStopDrawing(e)},e.startEditing=function(){if(W){var e=this;if(U=e,null==e.editor){var i=e.attribute.type;e.editor=j[i].getEditor(V,e,{dragIcon:z})}t.onStartEditing&&"function"==typeof t.onStartEditing&&t.onStartEditing(e)}},e.stopEditing=function(e){var i=this;i.editor&&(i.editor.destroy(),i.editor=null),!e&&t.onStopEditing&&"function"==typeof t.onStopEditing&&t.onStopEditing(i)},e.changeEditing=function(){var e=this;t.onChangeEditing&&"function"==typeof t.onChangeEditing&&t.onChangeEditing(e)},e.updatePositions=function(e){var t=this,i=t.attribute.type;if("ellipse"==i&&!t.attribute.style.clampToGround){var r=Cesium.Cartographic.fromCartesian(e).height;if(t.attribute.style.height=Number(r.toFixed(2)),t.ellipse.height?t.ellipse.height._value=t.attribute.style.height:t.ellipse.height=t.attribute.style.height,t.attribute.style.extrudedHeight){var n=Number(r)+Number(t.attribute.style.extrudedHeight);t.ellipse.extrudedHeight._value=Number(n.toFixed(2)),t.attribute.style.extrudedHeight=Number(n.toFixed(2))}}j[i].setPositions(U,e)}}function _(e){null!=e&&(e.stopEditing(!0),G(Z,e),V.entities.remove(e))}function x(){U&&(U.stopEditing(!0),G(Z,U),V.entities.remove(U),U=null)}function M(){v(),V.entities.removeAll(),Z=[]}function E(e){$(Z).each(function(t,i){e?V.entities.contains(i)||V.entities.add(i):V.entities.contains(i)&&V.entities.remove(i)})}function S(e){var t=e.attribute.type;return j[t].getCoordinates(e)}function P(e){var t=e.attribute.type;return j[t].getPositions(e)}function L(e,t){var i=e.attribute.type,t=j[i].setPositions(e,t)}function D(){return Z.length>0}function T(){return Z}function k(){return V}function O(e){for(var t=0;t<Z.length;t++){var i=Z[t];if(e==i.attribute.attr.id)return i}return null}function A(){return U}function N(e){if(!e.properties||!e.properties.type)return e;var t=e.properties.edittype||e.properties.type,i=q[t];if(!i)return e;var r=m.clone(e);if(e.properties.style){var n={};for(var a in e.properties.style){var o=e.properties.style[a];if(null!=o&&""!=o){var s=i.style[a];s!=o&&(n[a]=o)}}r.properties.style=n}if(e.properties.attr){var l={};for(var a in e.properties.attr){var o=e.properties.attr[a];if(null!=o&&""!=o){var s=i.attr[a];s!=o&&(l[a]=o)}}r.properties.attr=l}return r}function R(e){var t=q[e.edittype||e.type];if(t){e.style=e.style||{};for(var i in t.style){var r=e.style[i];null==r&&(e.style[i]=t.style[i])}e.attr=e.attr||{};for(var i in t.attr){var r=e.attr[i];null==r&&(e.attr[i]=t.attr[i])}}return e}function F(e){if(null==e){if(0==Z.length)return null;for(var t=[],i=0;i<Z.length;i++){var e=Z[i],r=e.attribute.type,n=j[r].toGeoJSON(e);n=N(n),t.push(n)}var n={type:"FeatureCollection",features:t};return n}var r=e.attribute.type,n=j[r].toGeoJSON(e);return n=N(n)}function I(e,i,r){var n=e;try{m.isString(e)&&(n=JSON.parse(e))}catch(e){return void haoutil.alert(e.name+": "+e.message+" \n请确认json文件格式正确!!!")}i&&M();for(var a=[],o=n.features,s=0;s<o.length;s++){var l=o[s];if(!l.properties||!l.properties.type)switch(l.properties=l.properties||{},l.geometry.type){case"MultiPolygon":case"Polygon":l.properties.type="polygon";break;case"MultiLineString":case"LineString":l.properties.type="polyline";break;case"MultiPoint":case"Point":l.properties.type="point"}var u=l.properties.type;if(null==j[u])throw"数据无法识别或者数据的["+u+"]类型参数有误";l.properties.style=l.properties.style||{},l.properties=R(l.properties);var c=j[u].startDraw(V,l.properties),h=y.getPositionsFromJson(l.geometry);j[u].setPositions(c,h),w(c),t.tooltip&&(c.attribute.attr&&c.attribute.attr.name?c.tooltip=c.attribute.attr.name:c.tooltip=null),Z.push(c),a.push(c)}return r&&B.flyTo(a),a}function H(t,i,r){var n=t;try{m.isString(t)&&(n=JSON.parse(t))}catch(e){return void haoutil.alert(e.name+": "+e.message+" \n请确认json文件格式正确!!!")}if(!(n instanceof Array))return void haoutil.alert("请确认json文件格式正确!!!");r&&M();for(var a=0;a<n.length;a++){var o=n[a];if(!o.x||!o.y)return void haoutil.alert(e.name+": "+e.message+" \n请确认json文件格式正确!!!");var s={id:o.id||o.ID||"",name:o.name||o.NAME||"",remark:o.remark||o.REMA||""},l={type:i.type||"billboard",attr:s,style:i.style},u=Cesium.Cartesian3.fromDegrees(o.x,o.y,o.z||0),c=j[l.type].startDraw(V,l);j[l.type].setPositions(c,u),w(c),Z.push(c)}return Z}function G(e,t){for(var i=0;i<e.length;i++)if(e[i]==t){e.splice(i,1);break}}var j={billboard:n,label:a,ellipse:o,polyline:s,polylineVolume:l,polygon:u,ellipsoid:c,wall:g,point:h,rectangle:d,model:p},B=t.viewer,z=(B.scene,t.dragIcon),V=new Cesium.CustomDataSource;B.dataSources.add(V);var W,U=null,Z=[],J=new f(B);i(t.hasEdit);var q={label:{edittype:"label",name:"文字",style:{text:"文字",color:"#ffffff",opacity:1,font_family:"楷体",font_size:30,border:!0,border_color:"#000000",border_width:3,background:!1,background_color:"#000000",background_opacity:.5,font_weight:"normal",font_style:"normal",scaleByDistance:!1,scaleByDistance_far:1e6,scaleByDistance_farValue:.1,scaleByDistance_near:1e3,scaleByDistance_nearValue:1,distanceDisplayCondition:!1,distanceDisplayCondition_far:1e4,distanceDisplayCondition_near:0},attr:{id:"",name:"",remark:""}},point:{edittype:"point",name:"像素点",style:{pixelSize:10,color:"#3388ff",opacity:1,outline:!0,outlineColor:"#ffffff",outlineOpacity:1,outlineWidth:2,scaleByDistance:!1,scaleByDistance_far:1e6,scaleByDistance_farValue:.1,scaleByDistance_near:1e3,scaleByDistance_nearValue:1,distanceDisplayCondition:!1,distanceDisplayCondition_far:1e4,distanceDisplayCondition_near:0},attr:{id:"",name:"",remark:""}},imagepoint:{edittype:"imagepoint",name:"图标点标记",style:{image:"",opacity:1,scale:1,rotation:0,scaleByDistance:!1,scaleByDistance_far:1e6,scaleByDistance_farValue:.1,scaleByDistance_near:1e3,scaleByDistance_nearValue:1,distanceDisplayCondition:!1,distanceDisplayCondition_far:1e4,distanceDisplayCondition_near:0},attr:{id:"",name:"",remark:""}},model:{edittype:"model",name:"模型",style:{modelUrl:"",scale:1,heading:0,pitch:0,roll:0,fill:!1,color:"#3388ff",opacity:1,silhouette:!1,silhouetteColor:"#ffffff",silhouetteSize:2,silhouetteAlpha:.8},attr:{id:"",name:"",remark:""}},polyline:{edittype:"polyline",name:"线",position:{minCount:2},style:{lineType:"solid",color:"#3388ff",width:4,clampToGround:!1,outline:!1,outlineColor:"#ffffff",outlineWidth:2,opacity:1},attr:{id:"",name:"",remark:""}},polylineVolume:{edittype:"polylineVolume",name:"管道线",position:{height:!0,minCount:2},style:{color:"#00FF00",radius:10,shape:"pipeline",outline:!1,outlineColor:"#ffffff",opacity:1},attr:{id:"",name:"",remark:""}},polygon:{edittype:"polygon",name:"面",position:{height:!0,minCount:3},style:{color:"#3388ff",opacity:.6,outline:!0,outlineColor:"#ffffff",outlineOpacity:1,clampToGround:!1},attr:{id:"",name:"",remark:""}},polygon_clampToGround:{edittype:"polygon_clampToGround",name:"贴地面",position:{height:!1,minCount:3},style:{color:"#ffff00",opacity:.6,outline:!0,outlineColor:"#ffffff",outlineOpacity:1,clampToGround:!0},attr:{id:"",name:"",remark:""}},extrudedPolygon:{edittype:"extrudedPolygon",name:"拉伸面",position:{height:!0,minCount:3},style:{color:"#00FF00",opacity:.6,outline:!0,outlineColor:"#ffffff",outlineOpacity:1,extrudedHeight:100,perPositionHeight:!0},attr:{id:"",name:"",remark:""}},rectangle:{edittype:"rectangle",name:"矩形",position:{height:!1,minCount:2,maxCount:2},style:{height:0,color:"#3388ff",rotation:0,opacity:.6,clampToGround:!1},attr:{id:"",name:"",remark:""}},rectangle_clampToGround:{edittype:"rectangle_clampToGround",name:"贴地矩形",position:{height:!1,minCount:2,maxCount:2},style:{color:"#ffff00",rotation:0,opacity:.6,clampToGround:!0},attr:{id:"",name:"",remark:""}},rectangleImg:{edittype:"rectangleImg",name:"贴地图片",position:{height:!1,minCount:2,maxCount:2},style:{image:"",rotation:0,opacity:1,clampToGround:!0},attr:{id:"",name:"",remark:""}},extrudedRectangle:{edittype:"extrudedRectangle",name:"拉伸矩形",position:{height:!1,minCount:2,maxCount:2},style:{color:"#00FF00",outline:!0,outlineColor:"#ffffff",rotation:0,opacity:.6,extrudedHeight:40,height:0},attr:{id:"",name:"",remark:""}},ellipse:{edittype:"ellipse",name:"椭圆",position:{height:!1},style:{semiMinorAxis:500,semiMajorAxis:500,height:0,opacity:.6,fill:!0,color:"#3388ff",outline:!0,outlineColor:"#ffffff",rotation:0,clampToGround:!1},attr:{id:"",name:"",remark:""}},ellipse_clampToGround:{edittype:"ellipse_clampToGround",name:"椭圆",position:{height:!1},style:{semiMinorAxis:500,semiMajorAxis:500,opacity:.6,fill:!0,color:"#ffff00",outline:!0,outlineColor:"#ffffff",rotation:0,clampToGround:!0},attr:{id:"",name:"",remark:""}},extrudedEllipse:{edittype:"extrudedEllipse",name:"圆柱体",position:{height:!1},style:{semiMinorAxis:100,semiMajorAxis:100,opacity:.6,fill:!0,color:"#00FF00",outline:!0,outlineColor:"#ffffff",extrudedHeight:100,height:0,rotation:0},attr:{id:"",name:"",remark:""}},ellipsoid:{edittype:"ellipsoid",name:"球体",style:{extentRadii:100,widthRadii:100,heightRadii:100,color:"#00FF00",outline:!0,outlineColor:"#ffffff",fill:!0,opacity:.6},attr:{id:"",name:"",remark:""}},wall:{edittype:"wall",name:"墙体",position:{height:!0,minCount:2},style:{color:"#00FF00",outline:!0,outlineColor:"#ffffff",opacity:.6,extrudedHeight:40},attr:{id:"",name:"",remark:""}}};return{startDraw:r,stopDraw:v,updateAttribute:b,updateGeometry:C,toGeoJSON:F,jsonToEntity:I,markersInfoToEntity:H,deleteEntity:_,deleteCurrentEntity:x,deleteAll:M,setVisible:E,hasDraw:D,hasEdit:i,getEntitys:T,getDataSource:k,getEntityById:O,getCurrentEntity:A,getCoordinates:S,getPositions:P,setPositions:L}};i.default=v},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(1).default,n=i(0).default,a=i(28).default,o={typename:"ellipse",startDraw:function(e,t){var i=this.attribute2Entity(t);return e.entities.add({ellipse:i,attribute:t})},attribute2Entity:function(e,t){e=e||{},e.style=e.style||{},null==t&&(t={fill:!0}),e.style.clampToGround&&(e.style.hasOwnProperty("height")&&delete e.style.height,e.style.hasOwnProperty("extrudedHeight")&&delete e.style.extrudedHeight);for(var i in e.style){var r=e.style[i];switch(i){default:t[i]=r;break;case"opacity":case"outlineOpacity":break;case"outlineColor":t.outlineColor=new Cesium.Color.fromCssColorString(r||"#FFFF00").withAlpha(e.style.outlineOpacity||e.style.opacity||1);break;case"color":t.material=new Cesium.Color.fromCssColorString(r||"#FFFF00").withAlpha(Number(e.style.opacity||1));break;case"rotation":t.rotation=Cesium.Math.toRadians(r);break;case"radius":t.semiMinorAxis=Number(r),t.semiMajorAxis=Number(r)}}return t},getEditor:function(e,t,i){return new a(e,t,i)},setPositions:function(e,t){e.position=new r(t)},getPositions:function(e){return[e.position._value]},getCoordinates:function(e){var t=this.getPositions(e);return n.getCoordinates(t)},toGeoJSON:function(e){var t=this.getCoordinates(e);return{type:"Feature",properties:e.attribute,geometry:{type:"Point",coordinates:t[0]}}}};t.default=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(1).default,n=i(0).default,a=i(29).default,o={typename:"ellipsoid",startDraw:function(e,t){var i=this.attribute2Entity(t);return e.entities.add({ellipsoid:i,attribute:t})},attribute2Entity:function(e,t){e=e||{},e.style=e.style||{},null==t&&(t={fill:!0});for(var i in e.style){var r=e.style[i];switch(i){default:t[i]=r;break;case"opacity":case"outlineOpacity":case"widthRadii":case"heightRadii":break;case"outlineColor":t.outlineColor=new Cesium.Color.fromCssColorString(r||"#FFFF00").withAlpha(e.style.outlineOpacity||e.style.opacity||1);break;case"color":t.material=new Cesium.Color.fromCssColorString(r||"#FFFF00").withAlpha(Number(e.style.opacity||1));break;case"extentRadii":var n=e.style.extentRadii||100,a=e.style.widthRadii||100,o=e.style.heightRadii||100;t.radii=new Cesium.Cartesian3(n,a,o)}}return t},getEditor:function(e,t,i){return new a(e,t,i)},setPositions:function(e,t){e.position=new r(t)},getPositions:function(e){return[e.position._value]},getCoordinates:function(e){var t=this.getPositions(e);return n.getCoordinates(t)},toGeoJSON:function(e){var t=this.getCoordinates(e);return{type:"Feature",properties:e.attribute,geometry:{type:"Point",coordinates:t[0]}}}};t.default=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(1).default,n=i(0).default,a=i(9).default,o={typename:"model",startDraw:function(e,t){var i=this.attribute2Entity(t);return e.entities.add({model:i,attribute:t})},attribute2Entity:function(e,t){e=e||{},e.style=e.style||{},null==t&&(t={});for(var i in e.style){var r=e.style[i];switch(i){default:t[i]=r;break;case"silhouette":case"silhouetteColor":case"silhouetteAlpha":case"silhouetteSize":case"fill":case"color":case"opacity":break;case"modelUrl":t.uri=r}}e.style.silhouette?(t.silhouetteColor=new Cesium.Color.fromCssColorString(e.style.silhouetteColor||"#FFFFFF").withAlpha(Number(e.style.silhouetteAlpha||1)),t.silhouetteSize=Number(e.style.silhouetteSize||1)):t.silhouetteSize=0;var n=e.style.hasOwnProperty("opacity")?Number(e.style.opacity):1;return e.style.fill?t.color=new Cesium.Color.fromCssColorString(e.style.color||"#FFFFFF").withAlpha(n):t.color=new Cesium.Color.fromCssColorString("#FFFFFF").withAlpha(n),t},attribute2Model:function(e,t){var i=Cesium.Math.toRadians(Number(t.attribute.style.heading||0)),r=Cesium.Math.toRadians(Number(t.attribute.style.pitch||0)),n=Cesium.Math.toRadians(Number(t.attribute.style.roll||0)),a=new Cesium.HeadingPitchRoll(i,r,n);t.orientation&&(t.orientation=Cesium.Transforms.headingPitchRollQuaternion(t.position._value,a))},getEditor:function(e,t,i){return new a(e,t,i)},setPositions:function(e,t){e.position=new r(t);var i=Cesium.Math.toRadians(Number(e.attribute.style.heading||0)),n=Cesium.Math.toRadians(Number(e.attribute.style.pitch||0)),a=Cesium.Math.toRadians(Number(e.attribute.style.roll||0)),o=new Cesium.HeadingPitchRoll(i,n,a);e.orientation=Cesium.Transforms.headingPitchRollQuaternion(e.position._value,o)},getPositions:function(e){return[e.position._value]},getCoordinates:function(e){var t=this.getPositions(e);return n.getCoordinates(t)},toGeoJSON:function(e){var t=this.getCoordinates(e);return{type:"Feature",properties:e.attribute,geometry:{type:"Point",coordinates:t[0]}}}};t.default=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(1).default,n=i(0).default,a=i(33).default,o={typename:"polylineVolume",startDraw:function(e,t){var i=this.attribute2Entity(t);return e.entities.add({polylineVolume:i,attribute:t})},attribute2Entity:function(e,t){e=e||{},e.style=e.style||{},null==t&&(t={positions:new r([])});for(var i in e.style){var n=e.style[i];switch(i){default:t[i]=n;break;case"opacity":case"outlineOpacity":case"radius":case"shape":break;case"outlineColor":t.outlineColor=new Cesium.Color.fromCssColorString(n||"#FFFF00").withAlpha(e.style.outlineOpacity||e.style.opacity||1);break;case"color":t.material=new Cesium.Color.fromCssColorString(n||"#FFFF00").withAlpha(Number(e.style.opacity||1))}}switch(e.style.radius=e.style.radius||10,e.style.shape){default:case"pipeline":t.shape=this._getCorridorShape1(e.style.radius);break;case"circle":t.shape=this._getCorridorShape2(e.style.radius);break;case"star":t.shape=this._getCorridorShape3(e.style.radius)}return t},_getCorridorShape1:function(e){for(var t=e/3,i=[],r=0;r<=360;r++){var n=Cesium.Math.toRadians(r);i.push(new Cesium.Cartesian2(e*Math.cos(n),e*Math.sin(n)))}for(var r=360;r>=0;r--){var n=Cesium.Math.toRadians(r);i.push(new Cesium.Cartesian2((e-t)*Math.cos(n),(e-t)*Math.sin(n)))}return i},_getCorridorShape2:function(e){for(var t=[],i=0;i<=360;i++){var r=Cesium.Math.toRadians(i);t.push(new Cesium.Cartesian2(e*Math.cos(r),e*Math.sin(r)))}return t},_getCorridorShape3:function(e,t){for(var t=t||6,i=Math.PI/t,r=2*t,n=new Array(r),a=0;a<r;a++){var o=a%2==0?e:e/3;n[a]=new Cesium.Cartesian2(Math.cos(a*i)*o,Math.sin(a*i)*o)}return n},getEditor:function(e,t,i){return new a(e,t,i)},setPositions:function(e,t){e.polylineVolume.positions.setValue(t)},getPositions:function(e){return e.polylineVolume.positions.getValue()},getCoordinates:function(e){var t=this.getPositions(e);return n.getCoordinates(t)},toGeoJSON:function(e){var t=this.getCoordinates(e);return{type:"Feature",properties:e.attribute,geometry:{type:"LineString",coordinates:t}}}};t.default=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(i(1).default,i(0).default),n=i(35).default,a=i(34).default,o={typename:"rectangle",startDraw:function(e,t){var i=this.attribute2Entity(t);return e.entities.add({rectangle:i,attribute:t})},attribute2Entity:function(e,t){if(e=e||{},e.style=e.style||{},!t){t={fill:!0,closeTop:!0,closeBottom:!0,coordinates:Cesium.Rectangle.fromDegrees(78.654473,34.878143,78.654673,34.878316)}}e.style.clampToGround&&(e.style.hasOwnProperty("height")&&delete e.style.height,e.style.hasOwnProperty("extrudedHeight")&&delete e.style.extrudedHeight);for(var i in e.style){var r=e.style[i];switch(i){default:t[i]=r;break;case"opacity":case"outlineOpacity":break;case"outlineColor":t.outlineColor=new Cesium.Color.fromCssColorString(r||"#FFFF00").withAlpha(e.style.outlineOpacity||e.style.opacity||1);break;case"height":t.height=Number(r),e.style.extrudedHeight&&(t.extrudedHeight=Number(e.style.extrudedHeight)+Number(r));break;case"extrudedHeight":t.extrudedHeight=Number(t.height)+Number(r);break;case"color":t.material=new Cesium.Color.fromCssColorString(r||"#FFFF00").withAlpha(Number(e.style.opacity||1));break;case"image":t.material=new Cesium.ImageMaterialProperty({image:e.style.image,color:new Cesium.Color.fromCssColorString("#FFFFFF").withAlpha(Number(e.style.opacity||1))});break;case"rotation":t.rotation=Cesium.Math.toRadians(r),e.style.stRotation||(t.stRotation=Cesium.Math.toRadians(r));break;case"stRotation":t.stRotation=Cesium.Math.toRadians(r)}}return null==t.material&&(t.material=Cesium.Color.fromRandom({minimumGreen:.75,maximumBlue:.75,alpha:Number(e.style.opacity||1)})),t},getEditor:function(e,t,i){return t.rectangle.extrudedHeight?new n(e,t,i):new a(e,t,i)},setPositions:function(e,t){t instanceof Array&&(t=Cesium.Rectangle.fromCartesianArray(t)),e.rectangle.coordinates.setValue(t)},getPositions:function(e){return e.rectangle.coordinates},getCoordinates:function(e){var t=this.getDiagonalPositions(e);return r.getCoordinates(t)},getDiagonalPositions:function(e){var t=e.rectangle.coordinates._value,i=Cesium.Rectangle.northwest(t),r=Cesium.Rectangle.southeast(t);return Cesium.Cartesian3.fromRadiansArray([i.longitude,i.latitude,r.longitude,r.latitude])},toGeoJSON:function(e){var t=this.getCoordinates(e);return{type:"Feature",properties:e.attribute,geometry:{type:"MultiPoint",coordinates:t}}}};t.default=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(1).default,n=i(0).default,a=i(36).default,o={typename:"wall",startDraw:function(e,t){var i=this.attribute2Entity(t);return e.entities.add({wall:i,attribute:t})},attribute2Entity:function(e,t){e=e||{},e.style=e.style||{},t||(t={fill:!0,minimumHeights:[],maximumHeights:[],positions:new r([])});for(var i in e.style){var n=e.style[i];switch(i){default:t[i]=n;break;case"opacity":case"outlineOpacity":break;case"outlineColor":t.outlineColor=new Cesium.Color.fromCssColorString(n||"#FFFF00").withAlpha(e.style.outlineOpacity||e.style.opacity||1);break;case"color":t.material=new Cesium.Color.fromCssColorString(n||"#FFFF00").withAlpha(Number(e.style.opacity||1))}}return null==t.material&&(t.material=Cesium.Color.fromRandom({minimumGreen:.75,maximumBlue:.75,alpha:Number(e.style.opacity||1)})),t},getEditor:function(e,t,i){return new a(e,t,i)},setPositions:function(e,t){if(e.wall.positions=new r(t),e.wall.maximumHeights&&e.wall.minimumHeights)for(var i=0;i<t.length;i++){var n=Cesium.Cartographic.fromCartesian(t[i]);e.wall.minimumHeights._value[i]=Number(n.height),e.wall.maximumHeights._value[i]=Number(n.height)+Number(e.attribute.style.extrudedHeight)}},getPositions:function(e){return e.wall.positions._value},setMaximumHeights:function(e,t){e.wall.maximumHeights=new r(t)},getMaximumHeights:function(e){return e.wall.maximumHeights._value},setMinimumHeights:function(e,t){e.wall.minimumHeights=new r(t)},getMinimumHeights:function(e){return e.wall.minimumHeights._value},getCoordinates:function(e){var t=this.getPositions(e);return n.getCoordinates(t)},toGeoJSON:function(e){var t=this.getCoordinates(e);return{type:"Feature",properties:e.attribute,geometry:{type:"LineString",coordinates:t}}}};t.default=o},function(e,t,i){function r(e,t,i,n){var a;switch(e.url&&(i&&(e.url=e.url.replace("$serverURL$",i)),e.url=e.url.replace("$hostname$",location.hostname).replace("$host$",location.host)),e.type){case"group":if(e.layers&&e.layers.length>0){for(var b=[],C=0;C<e.layers.length;C++){var w=r(e.layers[C],t,i,n);null!=w&&b.push(w)}e._layers=b,a=new o(e,t)}break;case"www_bing":case"www_osm":case"www_google":case"www_gaode":case"www_tdt":case"arcgis_cache":case"arcgis":case"arcgis_tile":case"arcgis_dynamic":case"wmts":case"tms":case"wms":case"xyz":case"tile":case"single":case"image":case"custom_tilecoord":case"custom_grid":a=new s(e,t);break;case"www_poi":a=new h(e,t);break;case"custom_featuregrid":a=new u(e,t);break;case"custom_graticule":a=new l(e,t);break;case"3dtiles":a=new f(e,t);break;case"gltf":a=new g(e,t);break;case"arcgis_feature":a=new c(e,t);break;case"arcgis_feature2":a=new p(e,t);break;case"geojson":a=new d(e,t);break;case"kml":a=new m(e,t);break;case"czml":a=new y(e,t);break;case"terrain":a=new v(e,t)}if(n){var _=n(e,t,a);_&&(a=_)}return null==a?"group"!=e.type&&console.log("配置中的图层未处理："+JSON.stringify(e)):e._layer=a,a}function n(e,t){e.url&&(t&&(e.url=e.url.replace("$serverURL$",t)),e.url=e.url.replace("$hostname$",location.hostname).replace("$host$",location.host));var i={};for(var r in e){var n=e[r];if(null!=n)switch(r){default:i[r]=n;break;case"crs":"4326"==n||"EPSG4326"==n.toUpperCase()?i.tilingScheme=new Cesium.GeographicTilingScheme({numberOfLevelZeroTilesX:e.numberOfLevelZeroTilesX||2,numberOfLevelZeroTilesY:e.numberOfLevelZeroTilesY||1}):i.tilingScheme=new Cesium.WebMercatorTilingScheme({numberOfLevelZeroTilesX:e.numberOfLevelZeroTilesX||1,numberOfLevelZeroTilesY:e.numberOfLevelZeroTilesY||1});break;case"proxy":i.proxy=new Cesium.DefaultProxy(n);break;case"rectangle":i.rectangle=Cesium.Rectangle.fromDegrees(n.xmin,n.ymin,n.xmax,n.ymax)}}i.proxy&&(i.url=new Cesium.Resource({url:i.url,proxy:i.proxy}));var a;switch(i.type_new||i.type){case"single":case"image":a=new Cesium.SingleTileImageryProvider(i);break;case"xyz":case"tile":i.customTags={"z&1":function(e,t,i,r){return r+1}},a=new Cesium.UrlTemplateImageryProvider(i);break;case"wms":a=new Cesium.WebMapServiceImageryProvider(i);break;case"tms":i.url||(i.url=Cesium.buildModuleUrl("Assets/Textures/NaturalEarthII")),a=new Cesium.createTileMapServiceImageryProvider(i);break;case"wmts":a=new Cesium.WebMapTileServiceImageryProvider(i);break;case"arcgis":case"arcgis_tile":case"arcgis_dynamic":a=new Cesium.ArcGisMapServerImageryProvider(i);break;case"arcgis_cache":Cesium.UrlTemplateImageryProvider.prototype.padLeft0||(Cesium.UrlTemplateImageryProvider.prototype.padLeft0=function(e,t){e=String(e);for(var i=e.length;i<t;)e="0"+e,i++;return e}),i.customTags={arc_x:function(e,t,i,r){return e.padLeft0(t.toString(16),8)},arc_y:function(e,t,i,r){return e.padLeft0(i.toString(16),8)},arc_z:function(e,t,i,r){return e.padLeft0(r.toString(),2)},arc_X:function(e,t,i,r){return e.padLeft0(t.toString(16),8).toUpperCase()},arc_Y:function(e,t,i,r){return e.padLeft0(i.toString(16),8).toUpperCase()},arc_Z:function(e,t,i,r){return e.padLeft0(r.toString(),2).toUpperCase()}},a=new Cesium.UrlTemplateImageryProvider(i);break;case"www_tdt":var o;switch(i.layer){default:case"vec_d":o="vec";break;case"vec_z":o="cva";break;case"img_d":o="img";break;case"img_z":o="cia";break;case"ter_d":o="ter";break;case"ter_z":o="cta"};if("4326"==e.crs){for(var s=new Array(18),l=0;l<=18;l++)s[l]=(l+1).toString();var u="http://t{s}.tianditu.com/"+o+"_c/wmts?service=WMTS&version=1.0.0&request=GetTile&tilematrix={TileMatrix}&layer="+o+"&style={style}&tilerow={TileRow}&tilecol={TileCol}&tilematrixset={TileMatrixSet}&format=tiles";a=new Cesium.WebMapTileServiceImageryProvider({url:i.proxy?new Cesium.Resource({url:u,proxy:i.proxy}):u,layer:o,style:"default",format:"tiles",tileMatrixSetID:"c",subdomains:["0","1","2","3","4","5","6","7"],tileMatrixLabels:s,tilingScheme:new Cesium.GeographicTilingScheme,maximumLevel:18})}else{for(var s=new Array(18),l=0;l<=18;l++)s[l]=l.toString();var u="http://t{s}.tianditu.com/"+o+"_w/wmts?service=WMTS&version=1.0.0&request=GetTile&tilematrix={TileMatrix}&layer="+o+"&style={style}&tilerow={TileRow}&tilecol={TileCol}&tilematrixset={TileMatrixSet}&format=tiles";a=new Cesium.WebMapTileServiceImageryProvider({url:i.proxy?new Cesium.Resource({url:u.replace("{s}","0"),proxy:i.proxy}):u,layer:o,style:"default",format:"tiles",tileMatrixSetID:"w",subdomains:["0","1","2","3","4","5","6","7"],tileMatrixLabels:s,tilingScheme:new Cesium.WebMercatorTilingScheme,maximumLevel:18})}break;case"www_gaode":var u;switch(i.layer){case"vec":default:u="http://"+(i.bigfont?"wprd":"webrd")+"0{s}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=7&x={x}&y={y}&z={z}";break;case"img_d":u="http://webst0{s}.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}";break;case"img_z":u="http://webst0{s}.is.autonavi.com/appmaptile?x={x}&y={y}&z={z}&lang=zh_cn&size=1&scale=1&style=8";break;case"time":u="http://tm.amap.com/trafficengine/mapabc/traffictile?v=1.0&;t=1&x={x}&y={y}&z={z}&&t="+(new Date).getTime()}a=new Cesium.UrlTemplateImageryProvider({url:i.proxy?new Cesium.Resource({url:u,proxy:i.proxy}):u,subdomains:["1","2","3","4"],maximumLevel:18});break;case"www_google":var u;if("4326"==e.crs||"wgs84"==e.crs)switch(i.layer){default:case"img_d":u="http://www.google.cn/maps/vt?lyrs=s&x={x}&y={y}&z={z}"}else switch(i.layer){case"vec":default:u="http://mt{s}.google.cn/vt/lyrs=m@207000000&hl=zh-CN&gl=CN&src=app&x={x}&y={y}&z={z}&s=Galile";break;case"img_d":u="http://mt{s}.google.cn/vt/lyrs=s&hl=zh-CN&gl=CN&x={x}&y={y}&z={z}&s=Gali";break;case"img_z":u="http://mt{s}.google.cn/vt/imgtp=png32&lyrs=h@207000000&hl=zh-CN&gl=cn&x={x}&y={y}&z={z}&s=Galil";break;case"ter":u="http://mt{s}.google.cn/vt/lyrs=t@131,r@227000000&hl=zh-CN&gl=cn&x={x}&y={y}&z={z}&s=Galile"}a=new Cesium.UrlTemplateImageryProvider({url:i.proxy?new Cesium.Resource({url:u,proxy:i.proxy}):u,subdomains:["1","2","3"],maximumLevel:20});break;case"www_osm":var u="http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png";a=new Cesium.UrlTemplateImageryProvider({url:i.proxy?new Cesium.Resource({url:u,proxy:i.proxy}):u,subdomains:"abc",maximumLevel:18});break;case"www_bing":var u="https://dev.virtualearth.net",c=i.layer||Cesium.BingMapsStyle.Aerial;a=new Cesium.BingMapsImageryProvider({url:i.proxy?new Cesium.Resource({url:u,proxy:i.proxy}):u,key:i.key||"AtkX3zhnRe5fyGuLU30uZw8r3sxdBDnpQly7KfFTCB2rGlDgXBG3yr-qEiQEicEc",mapStyle:c});break;case"custom_grid":a=new Cesium.GridImageryProvider;break;case"custom_tilecoord":a=new Cesium.TileCoordinatesImageryProvider;break;case"custom_featuregrid":a=new b(i);break;default:console.log("config配置图层未处理:"+e)}return a.config=i,a}var a=i(2).default,o=i(44).default,s=i(22).default,l=i(49).default,u=i(13).default,c=i(45).default,h=i(47).default,d=i(10).default,p=i(38).default,g=i(40).default,f=i(43).default,m=i(41).default,y=i(39).default,v=i(42).default,b=i(48).default;t.createLayer=r,t.createImageryProvider=n,t.BaseLayer=a,t.GroupLayer=o,t.TileLayer=s,t.GltfLayer=g,t.Tiles3dLayer=f,t.GeoJsonLayer=d,t.ArcFeatureLayer=p,t.CustomFeatureGridLayer=u,t.ArcFeatureGridLayer=c,t.POILayer=h,t.KmlLayer=m,t.CzmlLayer=y},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(2).default,n=i(21),a=r.extend({layer:null,add:function(){null!=this.layer&&this.remove(),this.addEx();var e=n.createImageryProvider(this.config);if(null!=e){var t=this.config,i={show:!0,alpha:this._opacity};if(t.rectangle&&t.rectangle.xmin&&t.rectangle.xmax&&t.rectangle.ymin&&t.rectangle.ymax){var r=t.rectangle.xmin,a=t.rectangle.xmax,o=t.rectangle.ymin,s=t.rectangle.ymax;i.rectangle=Cesium.Rectangle.fromDegrees(r,o,a,s)}t.brightness&&(i.brightness=t.brightness),t.contrast&&(i.contrast=t.contrast),t.hue&&(i.hue=t.hue),t.saturation&&(i.saturation=t.saturation),t.gamma&&(i.gamma=t.gamma),t.maximumAnisotropy&&(i.maximumAnisotropy=t.maximumAnisotropy),t.minimumTerrainLevel&&(i.minimumTerrainLevel=t.minimumTerrainLevel),t.maximumTerrainLevel&&(i.maximumTerrainLevel=t.maximumTerrainLevel),this.layer=new Cesium.ImageryLayer(e,i),this.layer.config=this.config,this.viewer.imageryLayers.add(this.layer),this.setZIndex(this.config.order)}},addEx:function(){},remove:function(){null!=this.layer&&(this.removeEx(),this.viewer.imageryLayers.remove(this.layer,!0),this.layer=null)},removeEx:function(){},hasOpacity:!0,_opacity:1,setOpacity:function(e){this._opacity=e,null!=this.layer&&(this.layer.alpha=e)},hasZIndex:!0,setZIndex:function(e){if(null!=this.layer&&null!=e){this.viewer.imageryLayers.raiseToTop(this.layer);for(var t=this.viewer.imageryLayers._layers,i=t.length-1;i>=0;i--)if(t[i]!=this.layer){var r=t[i].config;r&&r.order&&e<r.order&&this.viewer.imageryLayers.lower(this.layer)}}}});t.default=a},function(e,t,i){i(27),i(26),i(24);var r=i(50);i(58),i(25),r.widget=i(59).default,r.widget.BaseWidget=i(57).default;var n="undefined"!=typeof window?window:"undefined"!=typeof self?self:{};n.mars3d=r,console.log("当前Cesium版本："+(n.Cesium&&n.Cesium.VERSION?Cesium.VERSION:"未知")+" ， MarsGIS版本："+r.version)},function(e,t){},function(e,t){},function(e,t){!function(){"use strict";function e(e){var t="";e.f=e.f||"json";for(var i in e)if(e.hasOwnProperty(i)){var r,n=e[i],a=Object.prototype.toString.call(n);t.length&&(t+="&"),r="[object Array]"===a?"[object Object]"===Object.prototype.toString.call(n[0])?JSON.stringify(n):n.join(","):"[object Object]"===a?JSON.stringify(n):"[object Date]"===a?n.valueOf():n,t+=encodeURIComponent(i)+"="+encodeURIComponent(r)}return t}function t(e,t){var i=new window.XMLHttpRequest;return i.onerror=function(r){i.onreadystatechange=H.Util.falseFn,e.call(t,{error:{code:500,message:"XMLHttpRequest error"}},null)},i.onreadystatechange=function(){var r,n;if(4===i.readyState){try{r=JSON.parse(i.responseText)}catch(e){r=null,n={code:500,message:"Could not parse response as JSON. This could also be caused by a CORS or XMLHttpRequest error."}}!n&&r.error&&(n=r.error,r=null),i.onerror=H.Util.falseFn,e.call(t,n,r)}},i.ontimeout=function(){this.onerror()},i}function i(i,r,n,a){var o=t(n,a);return o.open("POST",i),void 0!==a&&null!==a&&void 0!==a.options&&(o.timeout=a.options.timeout),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.send(e(r)),o}function r(i,r,n,a){var o=t(n,a);return o.open("GET",i+"?"+e(r),!0),void 0!==a&&null!==a&&void 0!==a.options&&(o.timeout=a.options.timeout),o.send(null),o}function n(i,r,n,o){var s=e(r),l=t(n,o),u=(i+"?"+s).length;if(u<=2e3&&B.cors?l.open("GET",i+"?"+s):u>2e3&&B.cors&&(l.open("POST",i),l.setRequestHeader("Content-Type","application/x-www-form-urlencoded")),void 0!==o&&null!==o&&void 0!==o.options&&(l.timeout=o.options.timeout),u<=2e3&&B.cors)l.send(null);else{if(!(u>2e3&&B.cors))return u<=2e3&&!B.cors?a(i,r,n,o):void D("a request to "+i+" was longer then 2000 characters and this browser cannot make a cross-domain post request. Please use a proxy http://esri.github.io/esri-leaflet/api-reference/request.html");l.send(s)}return l}function a(t,i,r,n){window._EsriLeafletCallbacks=window._EsriLeafletCallbacks||{};var a="c"+V;i.callback="window._EsriLeafletCallbacks."+a,window._EsriLeafletCallbacks[a]=function(e){if(!0!==window._EsriLeafletCallbacks[a]){var t,i=Object.prototype.toString.call(e);"[object Object]"!==i&&"[object Array]"!==i&&(t={error:{code:500,message:"Expected array or object as JSONP response"}},e=null),!t&&e.error&&(t=e,e=null),r.call(n,t,e),window._EsriLeafletCallbacks[a]=!0}};var o=H.DomUtil.create("script",null,document.body);return o.type="text/javascript",o.src=t+"?"+e(i),o.id=a,V++,{id:a,url:o.src,abort:function(){window._EsriLeafletCallbacks._callback[a]({code:0,message:"Request aborted."})}}}function o(e,t){for(var i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}function s(e){return o(e[0],e[e.length-1])||e.push(e[0]),e}function l(e){var t,i=0,r=0,n=e.length,a=e[r];for(r;r<n-1;r++)t=e[r+1],i+=(t[0]-a[0])*(t[1]+a[1]),a=t;return i>=0}function u(e,t,i,r){var n=(r[0]-i[0])*(e[1]-i[1])-(r[1]-i[1])*(e[0]-i[0]),a=(t[0]-e[0])*(e[1]-i[1])-(t[1]-e[1])*(e[0]-i[0]),o=(r[1]-i[1])*(t[0]-e[0])-(r[0]-i[0])*(t[1]-e[1]);if(0!==o){var s=n/o,l=a/o;if(s>=0&&s<=1&&l>=0&&l<=1)return!0}return!1}function c(e,t){for(var i=0;i<e.length-1;i++)for(var r=0;r<t.length-1;r++)if(u(e[i],e[i+1],t[r],t[r+1]))return!0;return!1}function h(e,t){for(var i=!1,r=-1,n=e.length,a=n-1;++r<n;a=r)(e[r][1]<=t[1]&&t[1]<e[a][1]||e[a][1]<=t[1]&&t[1]<e[r][1])&&t[0]<(e[a][0]-e[r][0])*(t[1]-e[r][1])/(e[a][1]-e[r][1])+e[r][0]&&(i=!i);return i}function d(e,t){var i=c(e,t),r=h(e,t[0]);return!(i||!r)}function p(e){for(var t,i,r,n=[],a=[],o=0;o<e.length;o++){var u=s(e[o].slice(0));if(!(u.length<4))if(l(u)){var h=[u];n.push(h)}else a.push(u)}for(var p=[];a.length;){r=a.pop();var g=!1;for(t=n.length-1;t>=0;t--)if(i=n[t][0],d(i,r)){n[t].push(r),g=!0;break}g||p.push(r)}for(;p.length;){r=p.pop();var f=!1;for(t=n.length-1;t>=0;t--)if(i=n[t][0],c(i,r)){n[t].push(r),f=!0;break}f||n.push([r.reverse()])}return 1===n.length?{type:"Polygon",coordinates:n[0]}:{type:"MultiPolygon",coordinates:n}}function g(e){var t=[],i=e.slice(0),r=s(i.shift().slice(0));if(r.length>=4){l(r)||r.reverse(),t.push(r);for(var n=0;n<i.length;n++){var a=s(i[n].slice(0));a.length>=4&&(l(a)&&a.reverse(),t.push(a))}}return t}function f(e){for(var t=[],i=0;i<e.length;i++)for(var r=g(e[i]),n=r.length-1;n>=0;n--){var a=r[n].slice(0);t.push(a)}return t}function m(e){var t={};for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t}function y(e,t){var i={};return"number"==typeof e.x&&"number"==typeof e.y&&(i.type="Point",i.coordinates=[e.x,e.y]),e.points&&(i.type="MultiPoint",i.coordinates=e.points.slice(0)),e.paths&&(1===e.paths.length?(i.type="LineString",i.coordinates=e.paths[0].slice(0)):(i.type="MultiLineString",i.coordinates=e.paths.slice(0))),e.rings&&(i=p(e.rings.slice(0))),(e.geometry||e.attributes)&&(i.type="Feature",i.geometry=e.geometry?y(e.geometry):null,i.properties=e.attributes?m(e.attributes):null,e.attributes&&(i.id=e.attributes[t]||e.attributes.OBJECTID||e.attributes.FID)),i}function v(e,t){t=t||"OBJECTID";var i,r={wkid:4326},n={};switch(e.type){case"Point":n.x=e.coordinates[0],n.y=e.coordinates[1],n.spatialReference=r;break;case"MultiPoint":n.points=e.coordinates.slice(0),n.spatialReference=r;break;case"LineString":n.paths=[e.coordinates.slice(0)],n.spatialReference=r;break;case"MultiLineString":n.paths=e.coordinates.slice(0),n.spatialReference=r;break;case"Polygon":n.rings=g(e.coordinates.slice(0)),n.spatialReference=r;break;case"MultiPolygon":n.rings=f(e.coordinates.slice(0)),n.spatialReference=r;break;case"Feature":e.geometry&&(n.geometry=v(e.geometry,t)),n.attributes=e.properties?m(e.properties):{},e.id&&(n.attributes[t]=e.id);break;case"FeatureCollection":for(n=[],i=0;i<e.features.length;i++)n.push(v(e.features[i],t));break;case"GeometryCollection":for(n=[],i=0;i<e.geometries.length;i++)n.push(v(e.geometries[i],t))}return n}function b(e,t){return v(e,t)}function C(e,t){return y(e,t)}function w(e){var t={};for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t}function _(e){if("NaN"!==e.xmin&&"NaN"!==e.ymin&&"NaN"!==e.xmax&&"NaN"!==e.ymax){var t=H.latLng(e.ymin,e.xmin),i=H.latLng(e.ymax,e.xmax);return H.latLngBounds(t,i)}return null}function x(e){return e=H.latLngBounds(e),{xmin:e.getSouthWest().lng,ymin:e.getSouthWest().lat,xmax:e.getNorthEast().lng,ymax:e.getNorthEast().lat,spatialReference:{wkid:4326}}}function M(e,t){var i,r=e.features||e.results,n=r.length;if(t)i=t;else if(e.objectIdFieldName)i=e.objectIdFieldName;else if(e.fields){for(var a=0;a<=e.fields.length-1;a++)if("esriFieldTypeOID"===e.fields[a].type){i=e.fields[a].name;break}}else if(n)for(var o in r[0].attributes)if(o.match(/^(OBJECTID|FID|OID|ID)$/i)){i=o;break}var s={type:"FeatureCollection",features:[]};if(n)for(var l=r.length-1;l>=0;l--){var u=C(r[l],i);s.features.push(u)}return s}function E(e){return e=H.Util.trim(e),"/"!==e[e.length-1]&&(e+="/"),e}function S(e){return/^(?!.*utility\.arcgis\.com).*\.arcgis\.com.*FeatureServer/i.test(e)}function P(e){var t;switch(e){case"Point":t="esriGeometryPoint";break;case"MultiPoint":t="esriGeometryMultipoint";break;case"LineString":case"MultiLineString":t="esriGeometryPolyline";break;case"Polygon":case"MultiPolygon":t="esriGeometryPolygon"}return t}function D(){console&&console.warn&&console.warn.apply(console,arguments)}function T(e){return e.getSize().x-z.attributionWidthOffset+"px"}function k(e){if(e.attributionControl&&!e.attributionControl._esriAttributionAdded){e.attributionControl.setPrefix('<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a> | Powered by <a href="https://www.esri.com">Esri</a>');var t=document.createElement("style");t.type="text/css",t.innerHTML=".esri-truncated-attribution:hover {white-space: normal;}",document.getElementsByTagName("head")[0].appendChild(t),H.DomUtil.addClass(e.attributionControl._container,"esri-truncated-attribution:hover");var i=document.createElement("style");i.type="text/css",i.innerHTML=".esri-truncated-attribution {vertical-align: -3px;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;display: inline-block;transition: 0s white-space;transition-delay: 1s;max-width: "+T(e)+";}",document.getElementsByTagName("head")[0].appendChild(i),H.DomUtil.addClass(e.attributionControl._container,"esri-truncated-attribution"),e.on("resize",function(t){e.attributionControl._container.style.maxWidth=T(t.target)}),e.attributionControl._esriAttributionAdded=!0}}function O(e,t){a(e,{},H.Util.bind(function(e,i){if(!e){t._esriAttributions=[];for(var r=0;r<i.contributors.length;r++)for(var n=i.contributors[r],a=0;a<n.coverageAreas.length;a++){var o=n.coverageAreas[a],s=H.latLng(o.bbox[0],o.bbox[1]),l=H.latLng(o.bbox[2],o.bbox[3]);t._esriAttributions.push({attribution:n.attribution,score:o.score,bounds:H.latLngBounds(s,l),minZoom:o.zoomMin,maxZoom:o.zoomMax})}t._esriAttributions.sort(function(e,t){return t.score-e.score});A({target:t})}},this))}function A(e){var t=e.target,i=t._esriAttributions;if(t&&t.attributionControl&&i){for(var r="",n=t.getBounds(),a=H.latLngBounds(n.getSouthWest().wrap(),n.getNorthEast().wrap()),o=t.getZoom(),s=0;s<i.length;s++){var l=i[s],u=l.attribution;!r.match(u)&&l.bounds.intersects(a)&&o>=l.minZoom&&o<=l.maxZoom&&(r+=", "+u)}r=r.substr(2);var c=t.attributionControl._container.querySelector(".esri-dynamic-attribution");c.innerHTML=r,c.style.maxWidth=T(t),t.fire("attributionupdated",{attribution:r})}}function N(e){return new J(e)}function R(e){return new q(e)}function F(e){return new Y(e)}function I(e){return new X(e)}var H=window.L,G=("default"in H&&H.default,window.XMLHttpRequest&&"withCredentials"in new window.XMLHttpRequest),j=""===document.documentElement.style.pointerEvents,B={cors:G,pointerEvents:j},z={attributionWidthOffset:55},V=0,W=B.cors?r:a;W.CORS=r,W.JSONP=a;var U={request:n,get:W,post:i},Z={shallowClone:w,warn:D,cleanUrl:E,isArcgisOnline:S,geojsonTypeToArcGIS:P,responseToFeatureCollection:M,geojsonToArcGIS:b,arcgisToGeoJSON:C,boundsToExtent:x,extentToBounds:_,calcAttributionWidth:T,setEsriAttribution:k,_getAttributionData:O,_updateMapAttribution:A},J=H.Class.extend({options:{proxy:!1,useCors:G},generateSetter:function(e,t){return H.Util.bind(function(t){return this.params[e]=t,this},t)},initialize:function(e){if(e.request&&e.options?(this._service=e,H.Util.setOptions(this,e.options)):(H.Util.setOptions(this,e),this.options.url=E(e.url)),this.params=H.Util.extend({},this.params||{}),this.setters)for(var t in this.setters){var i=this.setters[t];this[t]=this.generateSetter(i,this)}},token:function(e){return this._service?this._service.authenticate(e):this.params.token=e,this},request:function(e,t){return this._service?this._service.request(this.path,this.params,e,t):this._request("request",this.path,this.params,e,t)},_request:function(e,t,i,r,n){var a=this.options.proxy?this.options.proxy+"?"+this.options.url+t:this.options.url+t;return"get"!==e&&"request"!==e||this.options.useCors?U[e](a,i,r,n):U.get.JSONP(a,i,r,n)}}),q=J.extend({setters:{offset:"resultOffset",limit:"resultRecordCount",fields:"outFields",precision:"geometryPrecision",featureIds:"objectIds",returnGeometry:"returnGeometry",token:"token"},path:"query",params:{returnGeometry:!0,where:"1=1",outSr:4326,outFields:"*"},within:function(e){return this._setGeometry(e),this.params.spatialRel="esriSpatialRelContains",this},intersects:function(e){return this._setGeometry(e),this.params.spatialRel="esriSpatialRelIntersects",this},contains:function(e){return this._setGeometry(e),this.params.spatialRel="esriSpatialRelWithin",this},crosses:function(e){return this._setGeometry(e),this.params.spatialRel="esriSpatialRelCrosses",this},touches:function(e){return this._setGeometry(e),this.params.spatialRel="esriSpatialRelTouches",this},overlaps:function(e){return this._setGeometry(e),this.params.spatialRel="esriSpatialRelOverlaps",this},bboxIntersects:function(e){return this._setGeometry(e),this.params.spatialRel="esriSpatialRelEnvelopeIntersects",this},indexIntersects:function(e){return this._setGeometry(e),this.params.spatialRel="esriSpatialRelIndexIntersects",this},nearby:function(e,t){return e=H.latLng(e),this.params.geometry=[e.lng,e.lat],this.params.geometryType="esriGeometryPoint",this.params.spatialRel="esriSpatialRelIntersects",this.params.units="esriSRUnit_Meter",this.params.distance=t,this.params.inSr=4326,this},where:function(e){return this.params.where=e,this},between:function(e,t){return this.params.time=[e.valueOf(),t.valueOf()],this},simplify:function(e,t){var i=Math.abs(e.getBounds().getWest()-e.getBounds().getEast());return this.params.maxAllowableOffset=i/e.getSize().y*t,this},orderBy:function(e,t){return t=t||"ASC",this.params.orderByFields=this.params.orderByFields?this.params.orderByFields+",":"",this.params.orderByFields+=[e,t].join(" "),this},run:function(e,t){return this._cleanParams(),this.options.isModern||S(this.options.url)?(this.params.f="geojson",this.request(function(i,r){this._trapSQLerrors(i),e.call(t,i,r,r)},this)):this.request(function(i,r){this._trapSQLerrors(i),e.call(t,i,r&&M(r),r)},this)},count:function(e,t){return this._cleanParams(),this.params.returnCountOnly=!0,this.request(function(t,i){e.call(this,t,i&&i.count,i)},t)},ids:function(e,t){return this._cleanParams(),this.params.returnIdsOnly=!0,this.request(function(t,i){e.call(this,t,i&&i.objectIds,i)},t)},bounds:function(e,t){return this._cleanParams(),this.params.returnExtentOnly=!0,this.request(function(i,r){r&&r.extent&&_(r.extent)?e.call(t,i,_(r.extent),r):(i={message:"Invalid Bounds"},e.call(t,i,null,r))},t)},pixelSize:function(e){var t=H.point(e);return this.params.pixelSize=[t.x,t.y],this},layer:function(e){return this.path=e+"/query",this},_trapSQLerrors:function(e){e&&"400"===e.code&&D("one common syntax error in query requests is encasing string values in double quotes instead of single quotes")},_cleanParams:function(){delete this.params.returnIdsOnly,delete this.params.returnExtentOnly,delete this.params.returnCountOnly},_setGeometry:function(e){return this.params.inSr=4326,e instanceof H.LatLngBounds?(this.params.geometry=x(e),void(this.params.geometryType="esriGeometryEnvelope")):(e.getLatLng&&(e=e.getLatLng()),e instanceof H.LatLng&&(e={type:"Point",coordinates:[e.lng,e.lat]}),e instanceof H.GeoJSON&&(e=e.getLayers()[0].feature.geometry,this.params.geometry=b(e),this.params.geometryType=P(e.type)),e.toGeoJSON&&(e=e.toGeoJSON()),"Feature"===e.type&&(e=e.geometry),"Point"===e.type||"LineString"===e.type||"Polygon"===e.type||"MultiPolygon"===e.type?(this.params.geometry=b(e),void(this.params.geometryType=P(e.type))):void D("invalid geometry passed to spatial query. Should be L.LatLng, L.LatLngBounds, L.Marker or a GeoJSON Point, Line, Polygon or MultiPolygon object"))}}),Y=J.extend({setters:{contains:"contains",text:"searchText",fields:"searchFields",spatialReference:"sr",sr:"sr",layers:"layers",returnGeometry:"returnGeometry",maxAllowableOffset:"maxAllowableOffset",precision:"geometryPrecision",dynamicLayers:"dynamicLayers",returnZ:"returnZ",returnM:"returnM",gdbVersion:"gdbVersion",token:"token"},path:"find",params:{sr:4326,contains:!0,returnGeometry:!0,returnZ:!0,returnM:!1},layerDefs:function(e,t){return this.params.layerDefs=this.params.layerDefs?this.params.layerDefs+";":"",this.params.layerDefs+=[e,t].join(":"),this},simplify:function(e,t){var i=Math.abs(e.getBounds().getWest()-e.getBounds().getEast());return this.params.maxAllowableOffset=i/e.getSize().y*t,this},run:function(e,t){return this.request(function(i,r){e.call(t,i,r&&M(r),r)},t)}}),X=J.extend({path:"identify",between:function(e,t){return this.params.time=[e.valueOf(),t.valueOf()],this}});L.esri={},L.esri.VERSION="2.0.8",L.esri.Support=B,L.esri.options=z,L.esri.Util=Z,L.esri.get=W,L.esri.post=i,L.esri.request=n,L.esri.Task=J,L.esri.task=N,L.esri.Query=q,L.esri.query=R,L.esri.Find=Y,L.esri.find=F,L.esri.Identify=X,L.esri.identify=I}()},function(e,t,i){!function(e,i){i(t)}(0,function(e){"use strict";function t(e){var t,i,r,n;for(i=1,r=arguments.length;i<r;i++){n=arguments[i];for(t in n)e[t]=n[t]}return e}function i(e,t){var i=Array.prototype.slice;if(e.bind)return e.bind.apply(e,i.call(arguments,1));var r=i.call(arguments,2);return function(){return e.apply(t,r.length?r.concat(i.call(arguments)):arguments)}}function r(e){return e._leaflet_id=e._leaflet_id||++Ve,e._leaflet_id}function n(e,t,i){var r,n,a,o;return o=function(){r=!1,n&&(a.apply(i,n),n=!1)},a=function(){r?n=arguments:(e.apply(i,arguments),setTimeout(o,t),r=!0)}}function a(e,t,i){var r=t[1],n=t[0],a=r-n;return e===r&&i?e:((e-n)%a+a)%a+n}function o(){return!1}function s(e,t){var i=Math.pow(10,t||5);return Math.round(e*i)/i}function l(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function u(e){return l(e).split(/\s+/)}function c(e,t){e.hasOwnProperty("options")||(e.options=e.options?ze(e.options):{});for(var i in t)e.options[i]=t[i];return e.options}function h(e,t,i){var r=[];for(var n in e)r.push(encodeURIComponent(i?n.toUpperCase():n)+"="+encodeURIComponent(e[n]));return(t&&-1!==t.indexOf("?")?"&":"?")+r.join("&")}function d(e,t){if(null!=e&&null!=t)return e.replace(We,function(e,i){var r=t[i];if(void 0===r)throw new Error("No value provided for variable "+e);return"function"==typeof r&&(r=r(t)),r})}function p(e,t){for(var i=0;i<e.length;i++)if(e[i]===t)return i;return-1}function g(e){return window["webkit"+e]||window["moz"+e]||window["ms"+e]}function f(e){var t=+new Date,i=Math.max(0,16-(t-Ze));return Ze=t+i,window.setTimeout(e,i)}function m(e,t,r){if(!r||Je!==f)return Je.call(window,i(e,t));e.call(t)}function y(e){e&&qe.call(window,e)}function v(){}function b(e){if(L&&L.Mixin){e=Ue(e)?e:[e];for(var t=0;t<e.length;t++)e[t]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",(new Error).stack)}}function C(e,t,i){this.x=i?Math.round(e):e,this.y=i?Math.round(t):t}function w(e,t,i){return e instanceof C?e:Ue(e)?new C(e[0],e[1]):void 0===e||null===e?e:"object"==typeof e&&"x"in e&&"y"in e?new C(e.x,e.y):new C(e,t,i)}function _(e,t){if(e)for(var i=t?[e,t]:e,r=0,n=i.length;r<n;r++)this.extend(i[r])}function x(e,t){return!e||e instanceof _?e:new _(e,t)}function M(e,t){if(e)for(var i=t?[e,t]:e,r=0,n=i.length;r<n;r++)this.extend(i[r])}function E(e,t){return e instanceof M?e:new M(e,t)}function S(e,t,i){if(isNaN(e)||isNaN(t))throw new Error("Invalid LatLng object: ("+e+", "+t+")");this.lat=+e,this.lng=+t,void 0!==i&&(this.alt=+i)}function P(e,t,i){return e instanceof S?e:Ue(e)&&"object"!=typeof e[0]?3===e.length?new S(e[0],e[1],e[2]):2===e.length?new S(e[0],e[1]):null:void 0===e||null===e?e:"object"==typeof e&&"lat"in e?new S(e.lat,"lng"in e?e.lng:e.lon,e.alt):void 0===t?null:new S(e,t,i)}function D(e,t,i,r){if(Ue(e))return this._a=e[0],this._b=e[1],this._c=e[2],void(this._d=e[3]);this._a=e,this._b=t,this._c=i,this._d=r}function T(e,t,i,r){return new D(e,t,i,r)}function k(e){return navigator.userAgent.toLowerCase().indexOf(e)>=0}function O(e,t,i,r){return"touchstart"===t?N(e,i,r):"touchmove"===t?G(e,i,r):"touchend"===t&&j(e,i,r),this}function A(e,t,i){var r=e["_leaflet_"+t+i];return"touchstart"===t?e.removeEventListener(Ht,r,!1):"touchmove"===t?e.removeEventListener(Gt,r,!1):"touchend"===t&&(e.removeEventListener(jt,r,!1),e.removeEventListener(Bt,r,!1)),this}function N(e,t,r){var n=i(function(e){if("mouse"!==e.pointerType&&e.pointerType!==e.MSPOINTER_TYPE_MOUSE&&e.pointerType!==e.MSPOINTER_TYPE_MOUSE){if(!(zt.indexOf(e.target.tagName)<0))return;X(e)}H(e,t)});e["_leaflet_touchstart"+r]=n,e.addEventListener(Ht,n,!1),Wt||(document.documentElement.addEventListener(Ht,R,!0),document.documentElement.addEventListener(Gt,F,!0),document.documentElement.addEventListener(jt,I,!0),document.documentElement.addEventListener(Bt,I,!0),Wt=!0)}function R(e){Vt[e.pointerId]=e,Ut++}function F(e){Vt[e.pointerId]&&(Vt[e.pointerId]=e)}function I(e){delete Vt[e.pointerId],Ut--}function H(e,t){e.touches=[];for(var i in Vt)e.touches.push(Vt[i]);e.changedTouches=[e],t(e)}function G(e,t,i){var r=function(e){(e.pointerType!==e.MSPOINTER_TYPE_MOUSE&&"mouse"!==e.pointerType||0!==e.buttons)&&H(e,t)};e["_leaflet_touchmove"+i]=r,e.addEventListener(Gt,r,!1)}function j(e,t,i){var r=function(e){H(e,t)};e["_leaflet_touchend"+i]=r,e.addEventListener(jt,r,!1),e.addEventListener(Bt,r,!1)}function B(e,t,i){function r(e){var t;if(Dt){if(!ct||"mouse"===e.pointerType)return;t=Ut}else t=e.touches.length;if(!(t>1)){var i=Date.now(),r=i-(a||i);o=e.touches?e.touches[0]:e,s=r>0&&r<=l,a=i}}function n(e){if(s&&!o.cancelBubble){if(Dt){if(!ct||"mouse"===e.pointerType)return;var i,r,n={};for(r in o)i=o[r],n[r]=i&&i.bind?i.bind(o):i;o=n}o.type="dblclick",t(o),a=null}}var a,o,s=!1,l=250;return e[qt+Zt+i]=r,e[qt+Jt+i]=n,e[qt+"dblclick"+i]=t,e.addEventListener(Zt,r,!1),e.addEventListener(Jt,n,!1),e.addEventListener("dblclick",t,!1),this}function z(e,t){var i=e[qt+Zt+t],r=e[qt+Jt+t],n=e[qt+"dblclick"+t];return e.removeEventListener(Zt,i,!1),e.removeEventListener(Jt,r,!1),ct||e.removeEventListener("dblclick",n,!1),this}function V(e,t,i,r){if("object"==typeof t)for(var n in t)U(e,n,t[n],i);else{t=u(t);for(var a=0,o=t.length;a<o;a++)U(e,t[a],i,r)}return this}function W(e,t,i,r){if("object"==typeof t)for(var n in t)Z(e,n,t[n],i);else if(t){t=u(t);for(var a=0,o=t.length;a<o;a++)Z(e,t[a],i,r)}else{for(var s in e[Yt])Z(e,s,e[Yt][s]);delete e[Yt]}return this}function U(e,t,i,n){var a=t+r(i)+(n?"_"+r(n):"");if(e[Yt]&&e[Yt][a])return this;var o=function(t){return i.call(n||e,t||window.event)},s=o;Dt&&0===t.indexOf("touch")?O(e,t,o,a):!Tt||"dblclick"!==t||!B||Dt&&ft?"addEventListener"in e?"mousewheel"===t?e.addEventListener("onwheel"in e?"wheel":"mousewheel",o,!1):"mouseenter"===t||"mouseleave"===t?(o=function(t){t=t||window.event,ie(e,t)&&s(t)},e.addEventListener("mouseenter"===t?"mouseover":"mouseout",o,!1)):("click"===t&&dt&&(o=function(e){re(e,s)}),e.addEventListener(t,o,!1)):"attachEvent"in e&&e.attachEvent("on"+t,o):B(e,o,a),e[Yt]=e[Yt]||{},e[Yt][a]=o}function Z(e,t,i,n){var a=t+r(i)+(n?"_"+r(n):""),o=e[Yt]&&e[Yt][a];if(!o)return this;Dt&&0===t.indexOf("touch")?A(e,t,a):Tt&&"dblclick"===t&&z?z(e,a):"removeEventListener"in e?"mousewheel"===t?e.removeEventListener("onwheel"in e?"wheel":"mousewheel",o,!1):e.removeEventListener("mouseenter"===t?"mouseover":"mouseleave"===t?"mouseout":t,o,!1):"detachEvent"in e&&e.detachEvent("on"+t,o),e[Yt][a]=null}function J(e){return e.stopPropagation?e.stopPropagation():e.originalEvent?e.originalEvent._stopped=!0:e.cancelBubble=!0,te(e),this}function q(e){return U(e,"mousewheel",J),this}function Y(e){return V(e,"mousedown touchstart dblclick",J),U(e,"click",ee),this}function X(e){return e.preventDefault?e.preventDefault():e.returnValue=!1,this}function Q(e){return X(e),J(e),this}function $(e,t){if(!t)return new C(e.clientX,e.clientY);var i=t.getBoundingClientRect();return new C(e.clientX-i.left-t.clientLeft,e.clientY-i.top-t.clientTop)}function K(e){return ct?e.wheelDeltaY/2:e.deltaY&&0===e.deltaMode?-e.deltaY/Xt:e.deltaY&&1===e.deltaMode?20*-e.deltaY:e.deltaY&&2===e.deltaMode?60*-e.deltaY:e.deltaX||e.deltaZ?0:e.wheelDelta?(e.wheelDeltaY||e.wheelDelta)/2:e.detail&&Math.abs(e.detail)<32765?20*-e.detail:e.detail?e.detail/-32765*60:0}function ee(e){Qt[e.type]=!0}function te(e){var t=Qt[e.type];return Qt[e.type]=!1,t}function ie(e,t){var i=t.relatedTarget;if(!i)return!0;try{for(;i&&i!==e;)i=i.parentNode}catch(e){return!1}return i!==e}function re(e,t){var i=e.timeStamp||e.originalEvent&&e.originalEvent.timeStamp,r=tt&&i-tt;if(r&&r>100&&r<500||e.target._simulatedClick&&!e._simulated)return void Q(e);tt=i,t(e)}function ne(e){return"string"==typeof e?document.getElementById(e):e}function ae(e,t){var i=e.style[t]||e.currentStyle&&e.currentStyle[t];if((!i||"auto"===i)&&document.defaultView){var r=document.defaultView.getComputedStyle(e,null);i=r?r[t]:null}return"auto"===i?null:i}function oe(e,t,i){var r=document.createElement(e);return r.className=t||"",i&&i.appendChild(r),r}function se(e){var t=e.parentNode;t&&t.removeChild(e)}function le(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function ue(e){var t=e.parentNode;t.lastChild!==e&&t.appendChild(e)}function ce(e){var t=e.parentNode;t.firstChild!==e&&t.insertBefore(e,t.firstChild)}function he(e,t){if(void 0!==e.classList)return e.classList.contains(t);var i=fe(e);return i.length>0&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(i)}function de(e,t){if(void 0!==e.classList)for(var i=u(t),r=0,n=i.length;r<n;r++)e.classList.add(i[r]);else if(!he(e,t)){var a=fe(e);ge(e,(a?a+" ":"")+t)}}function pe(e,t){void 0!==e.classList?e.classList.remove(t):ge(e,l((" "+fe(e)+" ").replace(" "+t+" "," ")))}function ge(e,t){void 0===e.className.baseVal?e.className=t:e.className.baseVal=t}function fe(e){return void 0===e.className.baseVal?e.className:e.className.baseVal}function me(e,t){"opacity"in e.style?e.style.opacity=t:"filter"in e.style&&ye(e,t)}function ye(e,t){var i=!1,r="DXImageTransform.Microsoft.Alpha";try{i=e.filters.item(r)}catch(e){if(1===t)return}t=Math.round(100*t),i?(i.Enabled=100!==t,i.Opacity=t):e.style.filter+=" progid:"+r+"(opacity="+t+")"}function ve(e){for(var t=document.documentElement.style,i=0;i<e.length;i++)if(e[i]in t)return e[i];return!1}function be(e,t,i){var r=t||new C(0,0);e.style[Kt]=(wt?"translate("+r.x+"px,"+r.y+"px)":"translate3d("+r.x+"px,"+r.y+"px,0)")+(i?" scale("+i+")":"")}function Ce(e,t){e._leaflet_pos=t,Mt?be(e,t):(e.style.left=t.x+"px",e.style.top=t.y+"px")}function we(e){return e._leaflet_pos||new C(0,0)}function _e(){V(window,"dragstart",X)}function xe(){W(window,"dragstart",X)}function Me(e){for(;-1===e.tabIndex;)e=e.parentNode;e.style&&(Ee(),ri=e,ni=e.style.outline,e.style.outline="none",V(window,"keydown",Ee))}function Ee(){ri&&(ri.style.outline=ni,ri=void 0,ni=void 0,W(window,"keydown",Ee))}function Se(e,t){if(!t||!e.length)return e.slice();var i=t*t;return e=ke(e,i),e=De(e,i)}function Pe(e,t,i){return Math.sqrt(Fe(e,t,i,!0))}function Le(e,t,i){return Fe(e,t,i)}function De(e,t){var i=e.length,r=typeof Uint8Array!=void 0+""?Uint8Array:Array,n=new r(i);n[0]=n[i-1]=1,Te(e,n,t,0,i-1);var a,o=[];for(a=0;a<i;a++)n[a]&&o.push(e[a]);return o}function Te(e,t,i,r,n){var a,o,s,l=0;for(o=r+1;o<=n-1;o++)(s=Fe(e[o],e[r],e[n],!0))>l&&(a=o,l=s);l>i&&(t[a]=1,Te(e,t,i,r,a),Te(e,t,i,a,n))}function ke(e,t){for(var i=[e[0]],r=1,n=0,a=e.length;r<a;r++)Re(e[r],e[n])>t&&(i.push(e[r]),n=r);return n<a-1&&i.push(e[a-1]),i}function Oe(e,t,i,r,n){var a,o,s,l=r?ai:Ne(e,i),u=Ne(t,i);for(ai=u;;){if(!(l|u))return[e,t];if(l&u)return!1;a=l||u,o=Ae(e,t,a,i,n),s=Ne(o,i),a===l?(e=o,l=s):(t=o,u=s)}}function Ae(e,t,i,r,n){var a,o,s=t.x-e.x,l=t.y-e.y,u=r.min,c=r.max;return 8&i?(a=e.x+s*(c.y-e.y)/l,o=c.y):4&i?(a=e.x+s*(u.y-e.y)/l,o=u.y):2&i?(a=c.x,o=e.y+l*(c.x-e.x)/s):1&i&&(a=u.x,o=e.y+l*(u.x-e.x)/s),new C(a,o,n)}function Ne(e,t){var i=0;return e.x<t.min.x?i|=1:e.x>t.max.x&&(i|=2),e.y<t.min.y?i|=4:e.y>t.max.y&&(i|=8),i}function Re(e,t){var i=t.x-e.x,r=t.y-e.y;return i*i+r*r}function Fe(e,t,i,r){var n,a=t.x,o=t.y,s=i.x-a,l=i.y-o,u=s*s+l*l;return u>0&&(n=((e.x-a)*s+(e.y-o)*l)/u,n>1?(a=i.x,o=i.y):n>0&&(a+=s*n,o+=l*n)),s=e.x-a,l=e.y-o,r?s*s+l*l:new C(a,o)}function Ie(e){return!Ue(e[0])||"object"!=typeof e[0][0]&&void 0!==e[0][0]}function He(e){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),Ie(e)}function Ge(e,t,i){var r,n,a,o,s,l,u,c,h,d=[1,4,2,8];for(n=0,u=e.length;n<u;n++)e[n]._code=Ne(e[n],t);for(o=0;o<4;o++){for(c=d[o],r=[],n=0,u=e.length,a=u-1;n<u;a=n++)s=e[n],l=e[a],s._code&c?l._code&c||(h=Ae(l,s,c,t,i),h._code=Ne(h,t),r.push(h)):(l._code&c&&(h=Ae(l,s,c,t,i),h._code=Ne(h,t),r.push(h)),r.push(s));e=r}return e}function je(){return window.L=pi,this}var Be=Object.freeze;Object.freeze=function(e){return e};var ze=Object.create||function(){function e(){}return function(t){return e.prototype=t,new e}}(),Ve=0,We=/\{ *([\w_\-]+) *\}/g,Ue=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},Ze=0,Je=window.requestAnimationFrame||g("RequestAnimationFrame")||f,qe=window.cancelAnimationFrame||g("CancelAnimationFrame")||g("CancelRequestAnimationFrame")||function(e){window.clearTimeout(e)},Ye=(Object.freeze||Object)({freeze:Be,extend:t,create:ze,bind:i,lastId:Ve,stamp:r,throttle:n,wrapNum:a,falseFn:o,formatNum:s,trim:l,splitWords:u,setOptions:c,getParamString:h,template:d,isArray:Ue,indexOf:p,emptyImageUrl:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=",requestFn:Je,cancelFn:qe,requestAnimFrame:m,cancelAnimFrame:y});v.extend=function(e){var i=function(){this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},r=i.__super__=this.prototype,n=ze(r);n.constructor=i,i.prototype=n;for(var a in this)this.hasOwnProperty(a)&&"prototype"!==a&&"__super__"!==a&&(i[a]=this[a]);return e.statics&&(t(i,e.statics),delete e.statics),e.includes&&(b(e.includes),t.apply(null,[n].concat(e.includes)),delete e.includes),n.options&&(e.options=t(ze(n.options),e.options)),t(n,e),n._initHooks=[],n.callInitHooks=function(){if(!this._initHooksCalled){r.callInitHooks&&r.callInitHooks.call(this),this._initHooksCalled=!0;for(var e=0,t=n._initHooks.length;e<t;e++)n._initHooks[e].call(this)}},i},v.include=function(e){return t(this.prototype,e),this},v.mergeOptions=function(e){return t(this.prototype.options,e),this},v.addInitHook=function(e){var t=Array.prototype.slice.call(arguments,1),i="function"==typeof e?e:function(){this[e].apply(this,t)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(i),this};var Xe={on:function(e,t,i){if("object"==typeof e)for(var r in e)this._on(r,e[r],t);else{e=u(e);for(var n=0,a=e.length;n<a;n++)this._on(e[n],t,i)}return this},off:function(e,t,i){if(e)if("object"==typeof e)for(var r in e)this._off(r,e[r],t);else{e=u(e);for(var n=0,a=e.length;n<a;n++)this._off(e[n],t,i)}else delete this._events;return this},_on:function(e,t,i){this._events=this._events||{};var r=this._events[e];r||(r=[],this._events[e]=r),i===this&&(i=void 0);for(var n={fn:t,ctx:i},a=r,o=0,s=a.length;o<s;o++)if(a[o].fn===t&&a[o].ctx===i)return;a.push(n)},_off:function(e,t,i){var r,n,a;if(this._events&&(r=this._events[e])){if(!t){for(n=0,a=r.length;n<a;n++)r[n].fn=o;return void delete this._events[e]}if(i===this&&(i=void 0),r)for(n=0,a=r.length;n<a;n++){var s=r[n];if(s.ctx===i&&s.fn===t)return s.fn=o,this._firingCount&&(this._events[e]=r=r.slice()),void r.splice(n,1)}}},fire:function(e,i,r){if(!this.listens(e,r))return this;var n=t({},i,{type:e,target:this});if(this._events){var a=this._events[e];if(a){this._firingCount=this._firingCount+1||1;for(var o=0,s=a.length;o<s;o++){var l=a[o];l.fn.call(l.ctx||this,n)}this._firingCount--}}return r&&this._propagateEvent(n),this},listens:function(e,t){var i=this._events&&this._events[e];if(i&&i.length)return!0;if(t)for(var r in this._eventParents)if(this._eventParents[r].listens(e,t))return!0;return!1},once:function(e,t,r){if("object"==typeof e){for(var n in e)this.once(n,e[n],t);return this}var a=i(function(){this.off(e,t,r).off(e,a,r)},this);return this.on(e,t,r).on(e,a,r)},addEventParent:function(e){return this._eventParents=this._eventParents||{},this._eventParents[r(e)]=e,this},removeEventParent:function(e){return this._eventParents&&delete this._eventParents[r(e)],this},_propagateEvent:function(e){for(var i in this._eventParents)this._eventParents[i].fire(e.type,t({layer:e.target},e),!0)}};Xe.addEventListener=Xe.on,Xe.removeEventListener=Xe.clearAllEventListeners=Xe.off,Xe.addOneTimeEventListener=Xe.once,Xe.fireEvent=Xe.fire,Xe.hasEventListeners=Xe.listens;var Qe=v.extend(Xe);C.prototype={clone:function(){return new C(this.x,this.y)},add:function(e){return this.clone()._add(w(e))},_add:function(e){return this.x+=e.x,this.y+=e.y,this},subtract:function(e){return this.clone()._subtract(w(e))},_subtract:function(e){return this.x-=e.x,this.y-=e.y,this},divideBy:function(e){return this.clone()._divideBy(e)},_divideBy:function(e){return this.x/=e,this.y/=e,this},multiplyBy:function(e){return this.clone()._multiplyBy(e)},_multiplyBy:function(e){return this.x*=e,this.y*=e,this},scaleBy:function(e){return new C(this.x*e.x,this.y*e.y)},unscaleBy:function(e){return new C(this.x/e.x,this.y/e.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},distanceTo:function(e){e=w(e);var t=e.x-this.x,i=e.y-this.y;return Math.sqrt(t*t+i*i)},equals:function(e){return e=w(e),e.x===this.x&&e.y===this.y},contains:function(e){return e=w(e),Math.abs(e.x)<=Math.abs(this.x)&&Math.abs(e.y)<=Math.abs(this.y)},toString:function(){return"Point("+s(this.x)+", "+s(this.y)+")"}},_.prototype={extend:function(e){return e=w(e),this.min||this.max?(this.min.x=Math.min(e.x,this.min.x),this.max.x=Math.max(e.x,this.max.x),this.min.y=Math.min(e.y,this.min.y),this.max.y=Math.max(e.y,this.max.y)):(this.min=e.clone(),this.max=e.clone()),this},getCenter:function(e){return new C((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,e)},getBottomLeft:function(){return new C(this.min.x,this.max.y)},getTopRight:function(){return new C(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(e){var t,i;return e="number"==typeof e[0]||e instanceof C?w(e):x(e),e instanceof _?(t=e.min,i=e.max):t=i=e,t.x>=this.min.x&&i.x<=this.max.x&&t.y>=this.min.y&&i.y<=this.max.y},intersects:function(e){e=x(e);var t=this.min,i=this.max,r=e.min,n=e.max,a=n.x>=t.x&&r.x<=i.x,o=n.y>=t.y&&r.y<=i.y;return a&&o},overlaps:function(e){e=x(e);var t=this.min,i=this.max,r=e.min,n=e.max,a=n.x>t.x&&r.x<i.x,o=n.y>t.y&&r.y<i.y;return a&&o},isValid:function(){return!(!this.min||!this.max)}},M.prototype={extend:function(e){var t,i,r=this._southWest,n=this._northEast;if(e instanceof S)t=e,i=e;else{if(!(e instanceof M))return e?this.extend(P(e)||E(e)):this;if(t=e._southWest,i=e._northEast,!t||!i)return this}return r||n?(r.lat=Math.min(t.lat,r.lat),r.lng=Math.min(t.lng,r.lng),n.lat=Math.max(i.lat,n.lat),n.lng=Math.max(i.lng,n.lng)):(this._southWest=new S(t.lat,t.lng),this._northEast=new S(i.lat,i.lng)),this},pad:function(e){var t=this._southWest,i=this._northEast,r=Math.abs(t.lat-i.lat)*e,n=Math.abs(t.lng-i.lng)*e;return new M(new S(t.lat-r,t.lng-n),new S(i.lat+r,i.lng+n))},getCenter:function(){return new S((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new S(this.getNorth(),this.getWest())},getSouthEast:function(){return new S(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(e){e="number"==typeof e[0]||e instanceof S||"lat"in e?P(e):E(e);var t,i,r=this._southWest,n=this._northEast;return e instanceof M?(t=e.getSouthWest(),i=e.getNorthEast()):t=i=e,t.lat>=r.lat&&i.lat<=n.lat&&t.lng>=r.lng&&i.lng<=n.lng},intersects:function(e){e=E(e);var t=this._southWest,i=this._northEast,r=e.getSouthWest(),n=e.getNorthEast(),a=n.lat>=t.lat&&r.lat<=i.lat,o=n.lng>=t.lng&&r.lng<=i.lng;return a&&o},overlaps:function(e){e=E(e);var t=this._southWest,i=this._northEast,r=e.getSouthWest(),n=e.getNorthEast(),a=n.lat>t.lat&&r.lat<i.lat,o=n.lng>t.lng&&r.lng<i.lng;return a&&o},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(e,t){return!!e&&(e=E(e),this._southWest.equals(e.getSouthWest(),t)&&this._northEast.equals(e.getNorthEast(),t))},isValid:function(){return!(!this._southWest||!this._northEast)}},S.prototype={equals:function(e,t){return!!e&&(e=P(e),Math.max(Math.abs(this.lat-e.lat),Math.abs(this.lng-e.lng))<=(void 0===t?1e-9:t))},toString:function(e){return"LatLng("+s(this.lat,e)+", "+s(this.lng,e)+")"},distanceTo:function(e){return Ke.distance(this,P(e))},wrap:function(){return Ke.wrapLatLng(this)},toBounds:function(e){var t=180*e/40075017,i=t/Math.cos(Math.PI/180*this.lat);return E([this.lat-t,this.lng-i],[this.lat+t,this.lng+i])},clone:function(){return new S(this.lat,this.lng,this.alt)}};var $e={latLngToPoint:function(e,t){var i=this.projection.project(e),r=this.scale(t);return this.transformation._transform(i,r)},pointToLatLng:function(e,t){var i=this.scale(t),r=this.transformation.untransform(e,i);return this.projection.unproject(r)},project:function(e){return this.projection.project(e)},unproject:function(e){return this.projection.unproject(e)},scale:function(e){return 256*Math.pow(2,e)},zoom:function(e){return Math.log(e/256)/Math.LN2},getProjectedBounds:function(e){if(this.infinite)return null;var t=this.projection.bounds,i=this.scale(e);return new _(this.transformation.transform(t.min,i),this.transformation.transform(t.max,i))},infinite:!1,wrapLatLng:function(e){var t=this.wrapLng?a(e.lng,this.wrapLng,!0):e.lng;return new S(this.wrapLat?a(e.lat,this.wrapLat,!0):e.lat,t,e.alt)},wrapLatLngBounds:function(e){var t=e.getCenter(),i=this.wrapLatLng(t),r=t.lat-i.lat,n=t.lng-i.lng;if(0===r&&0===n)return e;var a=e.getSouthWest(),o=e.getNorthEast();return new M(new S(a.lat-r,a.lng-n),new S(o.lat-r,o.lng-n))}},Ke=t({},$e,{wrapLng:[-180,180],R:6371e3,distance:function(e,t){var i=Math.PI/180,r=e.lat*i,n=t.lat*i,a=Math.sin(r)*Math.sin(n)+Math.cos(r)*Math.cos(n)*Math.cos((t.lng-e.lng)*i);return this.R*Math.acos(Math.min(a,1))}}),et={R:6378137,MAX_LATITUDE:85.0511287798,project:function(e){var t=Math.PI/180,i=this.MAX_LATITUDE,r=Math.max(Math.min(i,e.lat),-i),n=Math.sin(r*t);return new C(this.R*e.lng*t,this.R*Math.log((1+n)/(1-n))/2)},unproject:function(e){var t=180/Math.PI;return new S((2*Math.atan(Math.exp(e.y/this.R))-Math.PI/2)*t,e.x*t/this.R)},bounds:function(){var e=6378137*Math.PI;return new _([-e,-e],[e,e])}()};D.prototype={transform:function(e,t){return this._transform(e.clone(),t)},_transform:function(e,t){return t=t||1,e.x=t*(this._a*e.x+this._b),e.y=t*(this._c*e.y+this._d),e},untransform:function(e,t){return t=t||1,new C((e.x/t-this._b)/this._a,(e.y/t-this._d)/this._c)}};var tt,it,rt,nt,at=t({},Ke,{code:"EPSG:3857",projection:et,transformation:function(){var e=.5/(Math.PI*et.R);return T(e,.5,-e,.5)}()}),ot=t({},at,{code:"EPSG:900913"}),st=document.documentElement.style,lt="ActiveXObject"in window,ut=lt&&!document.addEventListener,ct="msLaunchUri"in navigator&&!("documentMode"in document),ht=k("webkit"),dt=k("android"),pt=k("android 2")||k("android 3"),gt=!!window.opera,ft=k("chrome"),mt=k("gecko")&&!ht&&!gt&&!lt,yt=!ft&&k("safari"),vt=k("phantom"),bt="OTransition"in st,Ct=0===navigator.platform.indexOf("Win"),wt=lt&&"transition"in st,_t="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!pt,xt="MozPerspective"in st,Mt=!window.L_DISABLE_3D&&(wt||_t||xt)&&!bt&&!vt,Et="undefined"!=typeof orientation||k("mobile"),St=Et&&ht,Pt=Et&&_t,Lt=!window.PointerEvent&&window.MSPointerEvent,Dt=!(!window.PointerEvent&&!Lt),Tt=!window.L_NO_TOUCH&&(Dt||"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch),kt=Et&&gt,Ot=Et&&mt,At=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Nt=function(){return!!document.createElement("canvas").getContext}(),Rt=!(!document.createElementNS||!function(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}("svg").createSVGRect),Ft=!Rt&&function(){try{var e=document.createElement("div");e.innerHTML='<v:shape adj="1"/>';var t=e.firstChild;return t.style.behavior="url(#default#VML)",t&&"object"==typeof t.adj}catch(e){return!1}}(),It=(Object.freeze||Object)({ie:lt,ielt9:ut,edge:ct,webkit:ht,android:dt,android23:pt,opera:gt,chrome:ft,gecko:mt,safari:yt,phantom:vt,opera12:bt,win:Ct,ie3d:wt,webkit3d:_t,gecko3d:xt,any3d:Mt,mobile:Et,mobileWebkit:St,mobileWebkit3d:Pt,msPointer:Lt,pointer:Dt,touch:Tt,mobileOpera:kt,mobileGecko:Ot,retina:At,canvas:Nt,svg:Rt,vml:Ft}),Ht=Lt?"MSPointerDown":"pointerdown",Gt=Lt?"MSPointerMove":"pointermove",jt=Lt?"MSPointerUp":"pointerup",Bt=Lt?"MSPointerCancel":"pointercancel",zt=["INPUT","SELECT","OPTION"],Vt={},Wt=!1,Ut=0,Zt=Lt?"MSPointerDown":Dt?"pointerdown":"touchstart",Jt=Lt?"MSPointerUp":Dt?"pointerup":"touchend",qt="_leaflet_",Yt="_leaflet_events",Xt=Ct&&ft?2*window.devicePixelRatio:mt?window.devicePixelRatio:1,Qt={},$t=(Object.freeze||Object)({on:V,off:W,stopPropagation:J,disableScrollPropagation:q,disableClickPropagation:Y,preventDefault:X,stop:Q,getMousePosition:$,getWheelDelta:K,fakeStop:ee,skipped:te,isExternalTarget:ie,addListener:V,removeListener:W}),Kt=ve(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]),ei=ve(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),ti="webkitTransition"===ei||"OTransition"===ei?ei+"End":"transitionend";if("onselectstart"in document)it=function(){V(window,"selectstart",X)},rt=function(){W(window,"selectstart",X)};else{var ii=ve(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);it=function(){if(ii){var e=document.documentElement.style;nt=e[ii],e[ii]="none"}},rt=function(){ii&&(document.documentElement.style[ii]=nt,nt=void 0)}}var ri,ni,ai,oi=(Object.freeze||Object)({TRANSFORM:Kt,TRANSITION:ei,TRANSITION_END:ti,get:ne,getStyle:ae,create:oe,remove:se,empty:le,toFront:ue,toBack:ce,hasClass:he,addClass:de,removeClass:pe,setClass:ge,getClass:fe,setOpacity:me,testProp:ve,setTransform:be,setPosition:Ce,getPosition:we,disableTextSelection:it,enableTextSelection:rt,disableImageDrag:_e,enableImageDrag:xe,preventOutline:Me,restoreOutline:Ee}),si=Qe.extend({run:function(e,t,i,r){this.stop(),this._el=e,this._inProgress=!0,this._duration=i||.25,this._easeOutPower=1/Math.max(r||.5,.2),this._startPos=we(e),this._offset=t.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=m(this._animate,this),this._step()},_step:function(e){var t=+new Date-this._startTime,i=1e3*this._duration;t<i?this._runFrame(this._easeOut(t/i),e):(this._runFrame(1),this._complete())},_runFrame:function(e,t){var i=this._startPos.add(this._offset.multiplyBy(e));t&&i._round(),Ce(this._el,i),this.fire("step")},_complete:function(){y(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(e){return 1-Math.pow(1-e,this._easeOutPower)}}),li=((Object.freeze||Object)({simplify:Se,pointToSegmentDistance:Pe,closestPointOnSegment:Le,clipSegment:Oe,_getEdgeIntersection:Ae,_getBitCode:Ne,_sqClosestPointOnSegment:Fe,isFlat:Ie,_flat:He}),(Object.freeze||Object)({clipPolygon:Ge}),{project:function(e){return new C(e.lng,e.lat)},unproject:function(e){return new S(e.y,e.x)},bounds:new _([-180,-90],[180,90])}),ui={R:6378137,R_MINOR:6356752.314245179,bounds:new _([-20037508.34279,-15496570.73972],[20037508.34279,18764656.23138]),project:function(e){var t=Math.PI/180,i=this.R,r=e.lat*t,n=this.R_MINOR/i,a=Math.sqrt(1-n*n),o=a*Math.sin(r),s=Math.tan(Math.PI/4-r/2)/Math.pow((1-o)/(1+o),a/2);return r=-i*Math.log(Math.max(s,1e-10)),new C(e.lng*t*i,r)},unproject:function(e){for(var t,i=180/Math.PI,r=this.R,n=this.R_MINOR/r,a=Math.sqrt(1-n*n),o=Math.exp(-e.y/r),s=Math.PI/2-2*Math.atan(o),l=0,u=.1;l<15&&Math.abs(u)>1e-7;l++)t=a*Math.sin(s),t=Math.pow((1-t)/(1+t),a/2),u=Math.PI/2-2*Math.atan(o*t)-s,s+=u;return new S(s*i,e.x*i/r)}},ci=((Object.freeze||Object)({LonLat:li,Mercator:ui,SphericalMercator:et}),t({},Ke,{code:"EPSG:3395",projection:ui,transformation:function(){var e=.5/(Math.PI*ui.R);return T(e,.5,-e,.5)}()})),hi=t({},Ke,{code:"EPSG:4326",projection:li,transformation:T(1/180,1,-1/180,.5)}),di=t({},$e,{projection:li,transformation:T(1,0,-1,0),scale:function(e){return Math.pow(2,e)},zoom:function(e){return Math.log(e)/Math.LN2},distance:function(e,t){var i=t.lng-e.lng,r=t.lat-e.lat;return Math.sqrt(i*i+r*r)},infinite:!0});$e.Earth=Ke,$e.EPSG3395=ci,$e.EPSG3857=at,$e.EPSG900913=ot,$e.EPSG4326=hi,$e.Simple=di;var pi=window.L;window.L=e,Object.freeze=Be,e.version="1.2.0+HEAD.1ac320b",e.noConflict=je,e.Browser=It,e.Evented=Qe,e.Util=Ye,e.Class=v,e.extend=t,e.bind=i,e.stamp=r,e.setOptions=c,e.DomEvent=$t,e.DomUtil=oi,e.PosAnimation=si,e.Point=C,e.point=w,e.Bounds=_,e.bounds=x,e.Transformation=D,e.transformation=T,e.LatLng=S,e.latLng=P,e.LatLngBounds=M,e.latLngBounds=E,e.CRS=$e})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(0).default,n=function(e,t,i){this.dataSource=e,this.entity=t,this.options=i,this.draggers=[],this.heightDraggers=[],this.initDraggers()};n.prototype.initDraggers=function(){var e=this,t=r.createDragger(this.dataSource,{dragIcon:this.options.dragIcon,position:this.entity.position._value,clampToGround:this.entity.attribute.style.clampToGround,onDrag:function(t,i){var r=new Cesium.Cartesian3;if(Cesium.Cartesian3.subtract(i,e.entity.position._value,r),!e.entity.attribute.style.clampToGround){var n=Cesium.Cartographic.fromCartesian(i);e.entity.ellipse.height=new Cesium.ConstantProperty(n.height),e.entity.attribute.style.height=Number(n.height.toFixed(2))}e.entity.position._value=i;var a=new Cesium.Cartesian3;Cesium.Cartesian3.add(t.majorDragger.position._value,r,a),t.majorDragger.position=new Cesium.ConstantProperty(a),Cesium.Cartesian3.add(t.minorDragger.position._value,r,a),t.minorDragger.position=new Cesium.ConstantProperty(a),void 0!=e.entity.attribute.style.extrudedHeight&&e.updateHeightDraggers(),e.entity.changeEditing()}});this.draggers.push(t);var i=Cesium.EllipseGeometryLibrary.computeEllipsePositions({center:this.entity.position._value,semiMinorAxis:this.entity.ellipse.semiMinorAxis._value,semiMajorAxis:this.entity.ellipse.semiMajorAxis._value,rotation:Cesium.Math.toRadians(Number(this.entity.attribute.style.rotation||0)),granularity:2},!0,!1),n=new Cesium.Cartesian3(i.positions[0],i.positions[1],i.positions[2]),a=r.createDragger(this.dataSource,{dragIcon:this.options.dragIcon,position:n,clampToGround:this.entity.attribute.style.clampToGround,onDrag:function(t,i){var r=Cesium.Cartesian3.distance(e.entity.position._value,i),n=Number(r.toFixed(2));e.entity.ellipse.semiMajorAxis=new Cesium.ConstantProperty(n),e.entity.attribute.style.radius?(e.entity.attribute.style.radius=n,e.entity.ellipse.semiMinorAxis=new Cesium.ConstantProperty(n)):e.entity.attribute.style.semiMajorAxis=n,void 0!=e.entity.attribute.style.extrudedHeight&&e.updateHeightDraggers(),e.entity.changeEditing()}});t.majorDragger=a,this.draggers.push(a);var o=new Cesium.Cartesian3(i.positions[3],i.positions[4],i.positions[5]),s=r.createDragger(this.dataSource,{dragIcon:this.options.dragIcon,position:o,clampToGround:this.entity.attribute.style.clampToGround,onDrag:function(t,i){var r=Cesium.Cartesian3.distance(e.entity.position._value,i),n=Number(r.toFixed(2));e.entity.ellipse.semiMinorAxis=new Cesium.ConstantProperty(n),e.entity.attribute.style.radius?(e.entity.attribute.style.radius=n,e.entity.ellipse.semiMajorAxis=new Cesium.ConstantProperty(n)):e.entity.attribute.style.semiMinorAxis=n,void 0!=e.entity.attribute.style.extrudedHeight&&e.updateHeightDraggers(),e.entity.changeEditing()}});t.minorDragger=s,this.draggers.push(s),void 0!=this.entity.attribute.style.extrudedHeight&&this.initHeightDraggers()},n.prototype.initHeightDraggers=function(){var e=this,t=Number(this.entity.attribute.style.extrudedHeight)-Number(this.entity.attribute.style.height),i=r.createDragger(this.dataSource,{dragIcon:this.options.dragIcon,position:r.getPositionsWithHeight(this.entity.position._value,t),clampToGround:this.entity.attribute.style.clampToGround,onDrag:function(i,r){var n=new Cesium.Cartesian3;Cesium.Cartesian3.subtract(r,e.entity.position._value,n);var a=Cesium.Cartographic.fromCartesian(r),o=Number(a.height.toFixed(2));e.entity.position._value=r,e.entity.ellipse.extrudedHeight=new Cesium.ConstantProperty(Number(o)+Number(t)),e.entity.ellipse.height=new Cesium.ConstantProperty(a.height),e.entity.attribute.style.extrudedHeight=Number(o)+Number(t),e.entity.attribute.style.height=o,e.updateDraggers(),e.entity.changeEditing()}});this.heightDraggers.push(i);var n=Cesium.EllipseGeometryLibrary.computeEllipsePositions({center:this.entity.position._value,semiMinorAxis:this.entity.ellipse.semiMinorAxis._value,semiMajorAxis:this.entity.ellipse.semiMajorAxis._value,rotation:Cesium.Math.toRadians(Number(this.entity.attribute.style.rotation||0)),granularity:2},!0,!1),a=new Cesium.Cartesian3(n.positions[0],n.positions[1],n.positions[2]),o=r.createDragger(this.dataSource,{dragIcon:this.options.dragIcon,position:r.getPositionsWithHeight(a,t),clampToGround:this.entity.attribute.style.clampToGround,onDrag:function(t,i){var r=Cesium.Cartographic.fromCartesian(i);e.entity.ellipse.extrudedHeight=new Cesium.ConstantProperty(r.height),e.entity.attribute.style.extrudedHeight=Number(r.height.toFixed(2)),e.updateHeightDraggers(),e.entity.changeEditing()},vertical:!0,horizontal:!1});this.heightDraggers.push(o);var s=new Cesium.Cartesian3(n.positions[3],n.positions[4],n.positions[5]),l=r.createDragger(this.dataSource,{dragIcon:this.options.dragIcon,position:r.getPositionsWithHeight(s,t),clampToGround:this.entity.attribute.style.clampToGround,onDrag:function(t,i){var r=Cesium.Cartographic.fromCartesian(i);e.entity.ellipse.extrudedHeight=new Cesium.ConstantProperty(r.height),e.entity.attribute.style.extrudedHeight=Number(r.height.toFixed(2)),e.updateHeightDraggers(),e.entity.changeEditing()},vertical:!0,horizontal:!1});this.heightDraggers.push(l)},n.prototype.updateDraggers=function(){this.destroy(),this.initDraggers()},n.prototype.updateHeightDraggers=function(){for(var e=0;e<this.heightDraggers.length;e++)this.dataSource.entities.remove(this.heightDraggers[e]);this.heightDraggers=[],this.initHeightDraggers()},n.prototype.destroy=function(){var e=0;for(e=0;e<this.draggers.length;e++)this.dataSource.entities.remove(this.draggers[e]);if(this.draggers=[],void 0!=this.entity.attribute.style.extrudedHeight){for(e=0;e<this.heightDraggers.length;e++)this.dataSource.entities.remove(this.heightDraggers[e]);this.heightDraggers=[]}},t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(0).default,n=function(e,t,i){this.dataSource=e,this.entity=t,this.options=i,this.draggers=[],this.initDraggers()};n.prototype.initDraggers=function(){var e=this,t=this.entity.position._value,i=Number(this.entity.attribute.style.heightRadii)||0,n=Cesium.Cartographic.fromCartesian(t);n.height+=i;var a=Cesium.Cartesian3.fromRadians(n.longitude,n.latitude,n.height),o=r.createDragger(this.dataSource,{dragIcon:this.options.dragIcon,position:a,onDrag:function(t,i){var r=new Cesium.Cartesian3;Cesium.Cartesian3.subtract(i,e.entity.position._value,r);var n=Cesium.Cartographic.fromCartesian(i),a=Number(e.entity.attribute.style.heightRadii)||0;n.height-=a;var o=Cesium.Cartesian3.fromRadians(n.longitude,n.latitude,n.height);e.entity.position._value=o,e.entity.changeEditing()}});this.draggers.push(o)},n.prototype.updateDraggers=function(){this.destroy(),this.initDraggers()},n.prototype.destroy=function(){for(var e=0;e<this.draggers.length;e++)this.dataSource.entities.remove(this.draggers[e]);this.draggers=[]},t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(0).default,n=function(e,t,i){this.dataSource=e,this.entity=t,this.draggers=[];for(var n=t.polygon.hierarchy._value,a=0;a<n.length;a++){var o=n[a],s=r.createDragger(this.dataSource,{dragIcon:i.dragIcon,position:o,clampToGround:t.attribute.style.hasOwnProperty("clampToGround")?t.attribute.style.clampToGround:!t.attribute.style.perPositionHeight,onDrag:function(e,i){e.positions[e.index]=i,t.changeEditing()}});s.index=a,s.positions=n,this.draggers.push(s)}};n.prototype.updateDraggers=function(){for(var e=this.entity.polygon.hierarchy._value,t=0;t<this.draggers.length;t++){var i=e[t];this.draggers[t].position=i}},n.prototype.destroy=function(){for(var e=0;e<this.draggers.length;e++)this.dataSource.entities.remove(this.draggers[e]);this.draggers=[]},t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(0).default,n=function(e,t,i){this.dataSource=e,this.entity=t,this.draggers=[],this.heightDraggers=[];var n=this,a=0,o=t.polygon.hierarchy._value;for(a=0;a<o.length;a++){var s=o[a];if(void 0!=t.polygon.height){var l=Cesium.Cartographic.fromCartesian(s);l.height+=t.polygon.height._value,s=Cesium.Cartesian3.fromRadians(l.longitude,l.latitude,l.height)}var u=r.createDragger(this.dataSource,{dragIcon:i.dragIcon,position:s,onDrag:function(e,i){e.positions[e.index]=i;for(var r=t.polygon.hierarchy._value,a=r[0],o=1;o<r.length;o++){var s=Cesium.Cartographic.fromCartesian(a),l=Cesium.Cartographic.fromCartesian(r[o]);Number(l.height)>Number(s.height)&&(a=r[o])}var u=Number(t.polygon.extrudedHeight)-Number(Cesium.Cartographic.fromCartesian(a).height);t.attribute.style.extrudedHeight=Number(u.toFixed(2)),n.updateDraggers(),t.changeEditing()}});u.index=a,u.positions=o,this.draggers.push(u)}if(t.polygon.extrudedHeight)for(a=0;a<o.length;a++){var c=o[a],h=Cesium.Cartographic.fromCartesian(c);h.height=t.polygon.extrudedHeight._value;var d=Cesium.Cartesian3.fromRadians(h.longitude,h.latitude,h.height),u=r.createDragger(this.dataSource,{dragIcon:i.dragIcon,position:d,onDrag:function(e,i){for(var r=n.entity.polygon.hierarchy._value,a=r[0],o=1;o<r.length;o++){var s=Cesium.Cartographic.fromCartesian(a),l=Cesium.Cartographic.fromCartesian(r[o]);Number(l.height)>Number(s.height)&&(a=r[o])}var u=Cesium.Cartographic.fromCartesian(i);t.polygon.extrudedHeight=new Cesium.ConstantProperty(Number(u.height));var c=Number(u.height)-Number(Cesium.Cartographic.fromCartesian(a).height);t.attribute.style.extrudedHeight=Number(c.toFixed(2)),n.updateDraggers(),t.changeEditing()},vertical:!0,horizontal:!1});u.index=a,this.heightDraggers.push(u)}};n.prototype.updateDraggers=function(){var e=this.entity.polygon.hierarchy._value,t=this.entity.polygon.extrudedHeight._value,i=0;void 0!=this.entity.polygon.height&&(i=this.entity.polygon.height._value);for(var r=0;r<this.heightDraggers.length;r++){var n=e[r],a=this.heightDraggers[r],o=Cesium.Cartographic.fromCartesian(n);o.height=t;var s=Cesium.Cartesian3.fromRadians(o.longitude,o.latitude,o.height);a.position=s;var l=this.draggers[r],u=Cesium.Cartographic.fromCartesian(n);u.height+=i,s=Cesium.Cartesian3.fromRadians(u.longitude,u.latitude,u.height),l.position=s}},n.prototype.destroy=function(){var e=0;for(e=0;e<this.draggers.length;e++)this.dataSource.entities.remove(this.draggers[e]);for(this.draggers=[],e=0;e<this.heightDraggers.length;e++)this.dataSource.entities.remove(this.heightDraggers[e]);this.heightDraggers=[]},t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(0).default,n=function(e,t,i){this.dataSource=e,this.entity=t,this.draggers=[];for(var n=t.polyline.positions._value,a=0;a<n.length;a++){var o=n[a],s=r.createDragger(this.dataSource,{dragIcon:i.dragIcon,position:o,onDrag:function(e,i){n[e.index]=i,t.polyline.positions=n,t.changeEditing()}});s.index=a,this.draggers.push(s)}};n.prototype.updateDraggers=function(){for(var e=this.entity.polyline.positions.getValue(),t=0;t<this.draggers.length;t++){var i=e[t];this.draggers[t].position=i}},n.prototype.destroy=function(){for(var e=0;e<this.draggers.length;e++)this.dataSource.entities.remove(this.draggers[e]);this.draggers=[]},t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(0).default,n=function(e,t,i){this.dataSource=e,this.entity=t,this.draggers=[];for(var n=t.polylineVolume.positions.getValue(),a=0;a<n.length;a++){var o=n[a],s=r.createDragger(this.dataSource,{dragIcon:i.dragIcon,position:o,onDrag:function(e,i){n[e.index]=i,t.polylineVolume.positions=n,t.changeEditing()}});s.index=a,this.draggers.push(s)}};n.prototype.updateDraggers=function(){for(var e=this.entity.polylineVolume.positions.getValue(),t=0;t<this.draggers.length;t++){var i=e[t];this.draggers[t].position=i}},n.prototype.destroy=function(){for(var e=0;e<this.draggers.length;e++)this.dataSource.entities.remove(this.draggers[e]);this.draggers=[]},t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(0).default,n=function(e,t,i){var n=this;this.dataSource=e,this.entity=t,this.draggers=[];for(var a=this.getDraggersPositions(),o=0;o<a.length;o++){var s=a[o];if(void 0!=t.rectangle.height){var l=Cesium.Cartographic.fromCartesian(s);l.height+=t.rectangle.height._value,s=Cesium.Cartesian3.fromRadians(l.longitude,l.latitude,l.height)}var u=r.createDragger(this.dataSource,{dragIcon:i.dragIcon,position:s,clampToGround:t.attribute.style.clampToGround,onDrag:function(e,i){e.positions[e.index]=i;var r;r=0==e.index?Cesium.Rectangle.fromCartesianArray([i,e.positions[1]]):Cesium.Rectangle.fromCartesianArray([i,e.positions[0]]),t.rectangle.coordinates.setValue(r),n.updateDraggers(),t.changeEditing()}});u.index=o,u.positions=a,this.draggers.push(u)}};n.prototype.updateDraggers=function(){var e=this.getDraggersPositions(),t=0;void 0!=this.entity.rectangle.height&&(t=this.entity.rectangle.height._value);for(var i=0;i<this.draggers.length;i++){var r=e[i];if(!this.entity.attribute.style.clampToGround){var n=this.draggers[i],a=Cesium.Cartographic.fromCartesian(r);a.height+=t,n.position=Cesium.Cartesian3.fromRadians(a.longitude,a.latitude,a.height)}}},n.prototype.getDraggersPositions=function(){var e=this.entity.rectangle.coordinates._value,t=Cesium.Rectangle.northwest(e),i=Cesium.Rectangle.southeast(e);return Cesium.Cartesian3.fromRadiansArray([t.longitude,t.latitude,i.longitude,i.latitude])},n.prototype.destroy=function(){for(var e=0;e<this.draggers.length;e++)this.dataSource.entities.remove(this.draggers[e]);this.draggers=[]},t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(0).default,n=function(e,t,i){this.dataSource=e,this.entity=t,this.draggers=[],this.heightDraggers=[];var n=this,a=0,o=this.getDraggersPositions();for(a=0;a<o.length;a++){var s=o[a];if(void 0!=t.rectangle.height){var l=Cesium.Cartographic.fromCartesian(s);l.height+=t.rectangle.height._value,s=Cesium.Cartesian3.fromRadians(l.longitude,l.latitude,l.height)}var u=r.createDragger(this.dataSource,{dragIcon:i.dragIcon,position:s,clampToGround:t.attribute.style.clampToGround,onDrag:function(e,i){e.positions[e.index]=i;var r;r=0==e.index?Cesium.Rectangle.fromCartesianArray([i,e.positions[1]]):Cesium.Rectangle.fromCartesianArray([i,e.positions[0]]),t.rectangle.coordinates.setValue(r),n.updateDraggers(),t.changeEditing()}});u.index=a,u.positions=o,this.draggers.push(u)}if(t.rectangle.extrudedHeight)for(a=0;a<o.length;a++){var c=o[a],l=Cesium.Cartographic.fromCartesian(c);l.height+=t.rectangle.extrudedHeight._value;var s=Cesium.Cartesian3.fromRadians(l.longitude,l.latitude,l.height),u=r.createDragger(this.dataSource,{dragIcon:i.dragIcon,position:s,onDrag:function(e,i){var r=Cesium.Cartographic.fromCartesian(i);t.rectangle.extrudedHeight=new Cesium.ConstantProperty(r.height);var a=Number(r.height)-Number(t.rectangle.height);t.attribute.style.extrudedHeight=Number(a.toFixed(2)),n.updateDraggers(),t.changeEditing()},vertical:!0,horizontal:!1});u.index=a,this.heightDraggers.push(u)}};n.prototype.updateDraggers=function(){var e=this.getDraggersPositions(),t=this.entity.rectangle.extrudedHeight._value,i=0;void 0!=this.entity.rectangle.height&&(i=this.entity.rectangle.height._value);for(var r=0;r<this.heightDraggers.length;r++){var n=e[r],a=this.heightDraggers[r],o=Cesium.Cartographic.fromCartesian(n);o.height+=t;var s=Cesium.Cartesian3.fromRadians(o.longitude,o.latitude,o.height);a.position=s;var l=this.draggers[r],u=Cesium.Cartographic.fromCartesian(n);u.height+=i,s=Cesium.Cartesian3.fromRadians(u.longitude,u.latitude,u.height),l.position=s}},n.prototype.getDraggersPositions=function(){var e=this.entity.rectangle.coordinates._value,t=Cesium.Rectangle.northwest(e),i=Cesium.Rectangle.southeast(e);return Cesium.Cartesian3.fromRadiansArray([t.longitude,t.latitude,i.longitude,i.latitude])},n.prototype.destroy=function(){var e=0;for(e=0;e<this.draggers.length;e++)this.dataSource.entities.remove(this.draggers[e]);for(this.draggers=[],e=0;e<this.heightDraggers.length;e++)this.dataSource.entities.remove(this.heightDraggers[e]);this.heightDraggers=[]},t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(0).default,n=function(e,t,i){this.dataSource=e,this.entity=t,this.draggers=[],this.heightDraggers=[];var n=this,a=0,o=t.wall.positions._value;for(a=0;a<o.length;a++){var s=o[a],l=r.createDragger(this.dataSource,{dragIcon:i.dragIcon,position:s,onDrag:function(e,i){e.positions[e.index]=i,n.updateDraggers(),t.changeEditing()}});l.index=a,l.positions=o,this.draggers.push(l)}if(t.wall.maximumHeights)for(a=0;a<o.length;a++){var u=o[a],c=Cesium.Cartographic.fromCartesian(u.clone());c.height=t.wall.maximumHeights._value[a];var s=Cesium.Cartesian3.fromRadians(c.longitude,c.latitude,c.height),l=r.createDragger(this.dataSource,{dragIcon:i.dragIcon,position:s,onDrag:function(e,i){var r=Cesium.Cartographic.fromCartesian(i),a=n.entity.wall.minimumHeights._value,o=Number(r.height)-Number(a[e.index]);t.attribute.style.extrudedHeight=o.toFixed(2),n.updateDraggers(),t.changeEditing()},vertical:!0,horizontal:!1});l.index=a,this.heightDraggers.push(l)}};n.prototype.updateDraggers=function(){for(var e=this.entity.wall.positions._value,t=this.entity.wall.minimumHeights._value,i=this.entity.wall.maximumHeights._value,n=0;n<this.heightDraggers.length;n++){var a=e[n].clone(),o=this.heightDraggers[n],s=Cesium.Cartographic.fromCartesian(a);t[n]=s.height,i[n]=Number(s.height)+Number(this.entity.attribute.style.extrudedHeight),o.position=r.getPositionsWithHeight(a,this.entity.attribute.style.extrudedHeight),this.draggers[n].position=a}},n.prototype.destroy=function(){var e=0;for(e=0;e<this.draggers.length;e++)this.dataSource.entities.remove(this.draggers[e]);for(this.draggers=[],e=0;e<this.heightDraggers.length;e++)this.dataSource.entities.remove(this.heightDraggers[e]);this.heightDraggers=[]},t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(4),n=i(0).default,a=function(e){this.viewer=e};a.prototype.setCursor=function(e){$("#"+this.viewer._container.id).css("cursor",e||"")},a.prototype.createDrawPointHandler=function(e){this.setCursor("crosshair");var t=this;e.inProgress=!0;var i=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas);return i.setInputAction(function(n){var a=r.getCurrentMousePosition(t.viewer.scene,n.position,e);a&&(t.setCursor(),e.updatePositions(a),e.inProgress=!1,e.stopDrawing(),e.startEditing(),i.destroy(),t.drawHandler=null)},Cesium.ScreenSpaceEventType.LEFT_CLICK),this.drawHandler=i,i},a.prototype.createDrawPolylineHandler=function(e,t){this.setCursor("crosshair");var i=this;e.inProgress=!0;var a=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas);return a.lastPointTemporary=!1,a.setInputAction(function(o){var s=r.getCurrentMousePosition(i.viewer.scene,o.position,e);s&&(a.lastPointTemporary&&t.pop(),e.attribute&&e.attribute.addHeight&&(s=n.getPositionsWithHeight(s,e.attribute.addHeight)),t.push(s),a.lastPointTemporary=!1,e.attribute&&e.attribute.minMaxPoints&&(t.length==e.attribute.minMaxPoints.min&&t.length==e.attribute.minMaxPoints.max||e.attribute.minMaxPoints.isSuper&&4==t.length)&&(e.inProgress=!1,a.destroy(),i.drawHandler=null,e.stopDrawing(),e.startEditing(),i.setCursor()),e.changeDrawing())},Cesium.ScreenSpaceEventType.LEFT_CLICK),a.setInputAction(function(n){if(n.endPosition){var o=r.getCurrentMousePosition(i.viewer.scene,n.endPosition,e);o&&(a.lastPointTemporary&&t.pop(),t.push(o),a.lastPointTemporary=!0,e.moveDrawing())}},Cesium.ScreenSpaceEventType.MOUSE_MOVE),a.setInputAction(function(r){e.inProgress=!1,a.destroy(),i.drawHandler=null,t.pop(),e.stopDrawing(),e.startEditing(),i.setCursor()},Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),this.drawHandler=a,a},a.prototype.createDrawPolygonHandler=function(e,t){this.setCursor("crosshair");var i=this;e.inProgress=!0;var a=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas);return a.lastPointTemporary=!1,a.setInputAction(function(o){var s=r.getCurrentMousePosition(i.viewer.scene,o.position,e);if(s){if(a.lastPointTemporary&&t.pop(),t.push(s),e.attribute.style.extrudedHeight){var l=n.getMaxHeightForPositions(t);e.polygon.extrudedHeight=l+Number(e.attribute.style.extrudedHeight)}a.lastPointTemporary=!1,e.changeDrawing()}},Cesium.ScreenSpaceEventType.LEFT_CLICK),a.setInputAction(function(o){if(o.endPosition){var s=r.getCurrentMousePosition(i.viewer.scene,o.endPosition,e);if(s){if(a.lastPointTemporary&&t.pop(),t.push(s),e.attribute.style.extrudedHeight){var l=n.getMaxHeightForPositions(t);e.polygon.extrudedHeight=l+Number(e.attribute.style.extrudedHeight)}a.lastPointTemporary=!0,e.moveDrawing()}}},Cesium.ScreenSpaceEventType.MOUSE_MOVE),a.setInputAction(function(r){e.inProgress=!1,a.destroy(),i.drawHandler=null,t.pop(),e.stopDrawing(),e.startEditing(),i.setCursor()},Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),this.drawHandler=a,a},a.prototype.createTwoPointsModelHandler=function(e,t){this.setCursor("crosshair");var i=this;e.inProgress=!0;var n=[],a=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas);return a.lastPointTemporary=!1,a.setInputAction(function(o){var s=r.getCurrentMousePosition(i.viewer.scene,o.position,e);if(s){if(a.lastPointTemporary&&n.pop(),n.push(s),1==n.length&&!e.attribute.style.clampToGround){var l=Number(Cesium.Cartographic.fromCartesian(s).height.toFixed(2));e.rectangle.height=l,e.attribute.style.height=l,e.attribute.style.extrudedHeight&&(e.rectangle.extrudedHeight=l+Number(e.attribute.style.extrudedHeight))}if(2==n.length){var u=Cesium.Rectangle.fromCartesianArray(n);t.setValue(u)}a.lastPointTemporary=!1,e.changeDrawing(),2==n.length&&(e.inProgress=!1,a.destroy(),i.drawHandler=null,e.stopDrawing(),e.startEditing(),i.setCursor())}},Cesium.ScreenSpaceEventType.LEFT_CLICK),a.setInputAction(function(o){if(o.endPosition){var s=r.getCurrentMousePosition(i.viewer.scene,o.endPosition,e);if(s){if(a.lastPointTemporary&&n.pop(),n.push(s),2==n.length){var l=Cesium.Rectangle.fromCartesianArray(n);t.setValue(l)}a.lastPointTemporary=!0,e.moveDrawing()}}},Cesium.ScreenSpaceEventType.MOUSE_MOVE),this.drawHandler=a,a},a.prototype.createDrawWallHandler=function(e,t,i,n){this.setCursor("crosshair");var a=this;e.inProgress=!0;var o=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas);return o.lastPointTemporary=!1,o.setInputAction(function(s){var l=r.getCurrentMousePosition(a.viewer.scene,s.position,e);if(l){o.lastPointTemporary&&(t.pop(),i.pop(),n.pop()),t.push(l);var u=Cesium.Cartographic.fromCartesian(l),c=Number(u.height.toFixed(2)),h=Number(c)+Number(e.attribute.style.extrudedHeight);i.push(c),n.push(h),o.lastPointTemporary=!1,e.changeDrawing()}},Cesium.ScreenSpaceEventType.LEFT_CLICK),o.setInputAction(function(s){if(s.endPosition){var l=r.getCurrentMousePosition(a.viewer.scene,s.endPosition,e);if(l){o.lastPointTemporary&&(t.pop(),i.pop(),n.pop()),t.push(l);var u=Cesium.Cartographic.fromCartesian(l),c=Number(u.height.toFixed(2)),h=Number(c)+Number(e.attribute.style.extrudedHeight);i.push(c),n.push(h),o.lastPointTemporary=!0,e.moveDrawing()}}},Cesium.ScreenSpaceEventType.MOUSE_MOVE),o.setInputAction(function(r){e.inProgress=!1,o.destroy(),a.drawHandler=null,t.pop(),i.pop(),n.pop(),e.stopDrawing(),e.startEditing(),a.setCursor()},Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),this.drawHandler=o,o},a.prototype.destroyDrawHandler=function(){this.setCursor(),this.drawHandler&&(this.setCursor(),this.drawHandler.destroy(),this.drawHandler=null)},a.prototype.createEditSelectHandler=function(e){var t=this,i=new Cesium.ScreenSpaceEventHandler(this.viewer.canvas);i.setInputAction(function(i){var r=t.viewer.scene.pick(i.position),n=null;if(Cesium.defined(r)){var a=Cesium.defaultValue(r.id,r.primitive.id);if(a instanceof Cesium.Entity){Cesium.defaultValue(a.inProgress,!1)||(n=a)}}e(n)},Cesium.ScreenSpaceEventType.LEFT_CLICK),this.selectHandler=i},a.prototype.createEditDraggerHandler=function(){var e=new Cesium.ScreenSpaceEventHandler(this.viewer.canvas);e.dragger=null;var t=this;e.setInputAction(function(i){var r=t.viewer.scene.pick(i.position);if(Cesium.defined(r)){var n=r.id;n&&Cesium.defaultValue(n._isDragger,!1)&&(n.billboard&&(n.billboard.scale_src=n.billboard.scale._value,n.billboard.scale._value=1.2*n.billboard.scale_src),e.dragger=n,t.viewer.scene.screenSpaceCameraController.enableRotate=!1,t.viewer.scene.screenSpaceCameraController.enableTilt=!1,t.viewer.scene.screenSpaceCameraController.enableTranslate=!1)}},Cesium.ScreenSpaceEventType.LEFT_DOWN),e.setInputAction(function(i){var r=t.viewer.scene.pick(i.position);if(Cesium.defined(r)){var n=r.id;n&&Cesium.defaultValue(n._isDragger,!1)&&(n.billboard&&(n.billboard.scale_src=n.billboard.scale._value,n.billboard.scale._value=1.2*n.billboard.scale_src),e.dragger=n,t.viewer.scene.screenSpaceCameraController.enableRotate=!1,t.viewer.scene.screenSpaceCameraController.enableTilt=!1,t.viewer.scene.screenSpaceCameraController.enableTranslate=!1)}},Cesium.ScreenSpaceEventType.LEFT_DOWN,Cesium.KeyboardEventModifier.CTRL),e.setInputAction(function(n){if(e.dragger){if(e.dragger.horizontal){var a;if(e.dragger.model){var o=t.viewer.scene,s=o.pick(n.endPosition);if(Cesium.defined(s)&&s.id==e.dragger){var l=o.camera.getPickRay(n.endPosition);a=o.globe.pick(l,o)}}null==a&&(a=r.getCurrentMousePosition(t.viewer.scene,n.endPosition)),a&&(e.dragger.position=a,e.dragger.onDrag&&e.dragger.onDrag(e.dragger,a))}if(e.dragger.vertical){var u=n.endPosition.y-n.startPosition.y,c=e.dragger.position._value,h=new Cesium.EllipsoidTangentPlane(c);i.center=c,i.radius=1;var d=t.viewer.scene.frameState.camera.getPixelSize(i,t.viewer.scene.frameState.context.drawingBufferWidth,t.viewer.scene.frameState.context.drawingBufferHeight),p=new Cesium.Cartesian3;Cesium.Cartesian3.multiplyByScalar(h.zAxis,-u*d,p);var g=Cesium.Cartesian3.clone(c);Cesium.Cartesian3.add(c,p,g),e.dragger.position=g,e.dragger.onDrag&&e.dragger.onDrag(e.dragger,g)}}},Cesium.ScreenSpaceEventType.MOUSE_MOVE);var i=new Cesium.BoundingSphere;e.setInputAction(function(r){if(e.dragger&&e.dragger.verticalCtrl){var n=r.endPosition.y-r.startPosition.y,a=e.dragger.position._value,o=new Cesium.EllipsoidTangentPlane(a);i.center=a,i.radius=1;var s=t.viewer.scene.frameState.camera.getPixelSize(i,t.viewer.scene.frameState.context.drawingBufferWidth,t.viewer.scene.frameState.context.drawingBufferHeight),l=new Cesium.Cartesian3;Cesium.Cartesian3.multiplyByScalar(o.zAxis,-n*s,l);var u=Cesium.Cartesian3.clone(a);Cesium.Cartesian3.add(a,l,u),e.dragger.position=u,e.dragger.onDrag&&e.dragger.onDrag(e.dragger,u)}},Cesium.ScreenSpaceEventType.MOUSE_MOVE,Cesium.KeyboardEventModifier.CTRL),e.setInputAction(function(){e.dragger&&(e.dragger.billboard&&(e.dragger.billboard.scale._value=e.dragger.billboard.scale_src),e.dragger=null,t.viewer.scene.screenSpaceCameraController.enableRotate=!0,t.viewer.scene.screenSpaceCameraController.enableTilt=!0,t.viewer.scene.screenSpaceCameraController.enableTranslate=!0)},Cesium.ScreenSpaceEventType.LEFT_UP),e.setInputAction(function(){e.dragger&&(e.dragger.billboard&&(e.dragger.billboard.scale._value=e.dragger.billboard.scale_src),e.dragger=null,t.viewer.scene.screenSpaceCameraController.enableRotate=!0,t.viewer.scene.screenSpaceCameraController.enableTilt=!0,t.viewer.scene.screenSpaceCameraController.enableTranslate=!0)},Cesium.ScreenSpaceEventType.LEFT_UP,Cesium.KeyboardEventModifier.CTRL),this.draggerHandler=e},a.prototype.destroyEditHandler=function(){this.selectHandler&&(this.selectHandler.destroy(),this.selectHandler=null),this.draggerHandler&&(this.draggerHandler.destroy(),this.draggerHandler=null)},t.default=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(10).default,n=r.extend({queryData:function(){var e=this,t=this.config.url;this.config.layers&&this.config.layers.length>0&&(t+="/"+this.config.layers[0]);var i=L.esri.query({url:t});this.config.where&&i.where(this.config.where),i.run(function(t,i,r){if(null!=t&&t.code>0)return void haoutil.alert(t.message,"服务访问出错");if(void 0==i||null==i||0==i.features.length)return void haoutil.msg("未找到符合查询条件的要素！");for(var n=[],a=0;a<i.features.length;a++){var o=i.features[a];null!=o&&null!=o.geometry&&(o.geometry.coordinates&&0==o.geometry.coordinates.length||n.push(o))}i.features=n,Cesium.GeoJsonDataSource.load(i,{clampToGround:!0}).then(function(t){e.showResult(t)}).otherwise(function(t){e.showError("服务出错",t)})})}});t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(10).default,n=r.extend({queryData:function(){var e=this;Cesium.CzmlDataSource.load(this.config.url).then(function(t){e.showResult(t)}).otherwise(function(t){e.showError("服务出错",t)})},getEntityAttr:function(e){return e._description._value}});t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(2).default,n=r.extend({model:null,add:function(){this.model?this.viewer.entities.add(this.model):this.initData()},remove:function(){this.viewer.entities.remove(this.model)},centerAt:function(e){if(null!=this.model)if(this.config.extent||this.config.center)this.viewer.mars.centerAt(this.config.extent||this.config.center,{duration:e,isWgs84:!0});else{var t=this.config.position;this.viewer.mars.centerAt(t,{duration:e,isWgs84:!0})}},initData:function(){var e=this.config.position;e=this.viewer.mars.point2map(e);var t=Cesium.Cartesian3.fromDegrees(e.x,e.y,e.z||0),i=Cesium.Math.toRadians(e.heading||0),r=Cesium.Math.toRadians(e.pitch||0),n=Cesium.Math.toRadians(e.roll||0),a=new Cesium.HeadingPitchRoll(i,r,n),o=Cesium.Transforms.headingPitchRollQuaternion(t,a),s={uri:this.config.url};for(var l in this.config)"url"!=l&&"name"!=l&&"position"!=l&&"center"!=l&&"tooltip"!=l&&"popup"!=l&&(s[l]=this.config[l]);this.model=this.viewer.entities.add({name:this.config.name,position:t,orientation:o,model:s,_config:this.config,tooltip:this.config.tooltip,popup:this.config.popup})},hasOpacity:!0,setOpacity:function(e){null!=this.model&&(this.model.model.color=new Cesium.Color.fromCssColorString("#FFFFFF").withAlpha(e))}});t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(10).default,n=r.extend({queryData:function(){var e=this;Cesium.KmlDataSource.load(this.config.url,{camera:this.viewer.scene.camera,canvas:this.viewer.scene.canvas}).then(function(t){e.showResult(t)}).otherwise(function(t){e.showError("服务出错",t)})},getEntityAttr:function(e){var t={name:e._name},i=e._kml.extendedData;for(var r in i)t[r]=i[r].value;return t}});t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(2).default,n=i(5),a=r.extend({terrain:null,add:function(){this.terrain||(this.terrain=n.getTerrainProvider(this.config)),this.viewer.terrainProvider=this.terrain},remove:function(){this.viewer.terrainProvider=n.getEllipsoidTerrain()}});t.default=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(2).default,n=i(5),a=i(4),o=r.extend({model:null,originalCenter:null,boundingSphere:null,add:function(){this.model?this.viewer.scene.primitives.add(this.model):this.initData()},remove:function(){this.viewer.scene.primitives.remove(this.model),this.model=null},centerAt:function(e){this.config.extent||this.config.center?this.viewer.mars.centerAt(this.config.extent||this.config.center,{duration:e,isWgs84:!0}):this.boundingSphere&&this.viewer.camera.flyToBoundingSphere(this.boundingSphere,{offset:new Cesium.HeadingPitchRange(0,-.5,2*this.boundingSphere.radius),duration:e})},initData:function(){this.config.maximumScreenSpaceError=this.config.maximumScreenSpaceError||1,this.model=this.viewer.scene.primitives.add(new Cesium.Cesium3DTileset(this.config)),this.model._config=this.config,this.model.tooltip=this.config.tooltip,this.model.popup=this.config.popup;var e=this;this.model.readyPromise.then(function(t){var i=t.boundingSphere;e.boundingSphere=i;var r=i.center,n=Cesium.Cartographic.fromCartesian(r),a=Number(n.height.toFixed(2)),o=Number(Cesium.Math.toDegrees(n.longitude).toFixed(6)),s=Number(Cesium.Math.toDegrees(n.latitude).toFixed(6));e.originalCenter={x:o,y:s,z:a},console.log((e.config.name||"")+" 模型原始位置:"+JSON.stringify(e.originalCenter));var l=e.viewer.mars.point2map(e.originalCenter);if(l.x!=e.originalCenter.x||l.y!=e.originalCenter.y||null!=e.config.offset){e.config.offset=e.config.offset||{},e.config.offset.x&&e.config.offset.y&&(e.config.offset=e.viewer.mars.point2map(e.config.offset));var u={x:e.config.offset.x||l.x,y:e.config.offset.y||l.y,z:e.config.offset.z||0,heading:e.config.offset.heading||0};"-height"==e.config.offset.z?(u.z=5-a,e.updateMatrix(u)):"auto"==e.config.offset.z?e.autoHeight(r,u):e.updateMatrix(u)}!e.viewer.mars.isFlyAnimation()&&e.config.flyTo&&e.centerAt(0),e.config.calback&&e.config.calback(t)})},updateMatrix:function(e){if(null!=this.model){console.log(" 模型修改后位置:"+JSON.stringify(e));var t=!1;if(0!=e.heading&&this.model._root&&this.model._root.transform){var i=Cesium.Matrix4.fromArray(this.model._root.transform),r=Cesium.Matrix4.getTranslation(i,new Cesium.Cartesian3);if(Cesium.Cartographic.fromCartesian(r)){var n=Cesium.Cartesian3.fromDegrees(e.x,e.y,e.z),i=Cesium.Transforms.eastNorthUpToFixedFrame(n),a=Cesium.Matrix4.fromRotationTranslation(Cesium.Matrix3.fromRotationZ(Cesium.Math.toRadians(e.heading)));Cesium.Matrix4.multiply(i,a,i),this.model._root.transform=i,t=!0}}if(!t){var o=this.model.boundingSphere,s=Cesium.Cartographic.fromCartesian(o.center),l=Cesium.Cartesian3.fromRadians(s.longitude,s.latitude,0),u=Cesium.Cartesian3.fromDegrees(e.x,e.y,e.z),c=Cesium.Cartesian3.subtract(u,l,new Cesium.Cartesian3);this.model.modelMatrix=Cesium.Matrix4.fromTranslation(c)}}},autoHeight:function(e,t){var i=this;n.terrainPolyline({viewer:this.viewer,positions:[e,e],calback:function(e,r){if(null!=e&&0!=e.length&&!r){var n=a.formatPositon(e[0]),o=n.z-i.originalCenter.z+1;t.z=o,i.updateMatrix(t)}}})},hasOpacity:!0,setOpacity:function(e){this.model&&(this.model.style=new Cesium.Cesium3DTileStyle({color:"color() *vec4(1,1,1,"+e+")"}))}});t.default=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(2).default,n=r.extend({create:function(){for(var e=this.config._layers,t=0;t<e.length;t++)this.hasOpacity=e[t].hasOpacity,this.hasZIndex=e[t].hasZIndex},setVisible:function(e){for(var t=this.config._layers,i=0;i<t.length;i++)t[i].setVisible(e)},add:function(){for(var e=this.config._layers,t=0;t<e.length;t++)e[t].setVisible(!0)},remove:function(){for(var e=this.config._layers,t=0;t<e.length;t++)e[t].setVisible(!1)},centerAt:function(e){for(var t=this.config._layers,i=0;i<t.length;i++)t[i].centerAt(e)},setOpacity:function(e){for(var t=this.config._layers,i=0;i<t.length;i++)t[i].setOpacity(e)}});t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(13).default,n=r.extend({getDataForGrid:function(e,t){var i=this,r=this.config.url;this.config.layers&&this.config.layers.length>0&&(r+="/"+this.config.layers[0]);var n=L.esri.query({url:r}),a=L.latLngBounds(L.latLng(e.rectangle.ymin,e.rectangle.xmin),L.latLng(e.rectangle.ymax,e.rectangle.xmax));n.within(a),this.config.where&&n.where(this.config.where),n.run(function(r,n,a){if(i._visible&&i._cacheGrid[e.key])return null!=r&&r.code>0?void console.log("arcgis服务访问出错"+r.message):void(void 0!=n&&null!=n&&("Feature"==n.type&&(n={type:"FeatureCollection",features:[n]}),t(n.features)))})},createEntity:function(e,t,i){var r=this;return Cesium.GeoJsonDataSource.load(t,{clampToGround:!0}).then(function(t){if(!r.checkHasBreak[e.key]){if(0==t.entities.values.length)return null;var n=t.entities.values[0];n._id=r.config.id+"_"+e.key+"_"+n.id,r._addEntity(n,i)}}).otherwise(function(e){r.showError("服务出错",e)}),null},_addEntity:function(e,t){var i=this,r=this.config.symbol;r&&("function"==typeof r?r(e,e.properties):"default"==r?this.setDefSymbol(e):this.setConfigSymbol(e,r)),(this.config.columns||this.config.popup)&&(e.popup={html:function(e){return i.viewer.mars.popup.getPopupForConfig(i.config,e.properties)},anchor:this.config.popupAnchor||[0,-15]}),this.config.tooltip&&(e.tooltip={html:function(e){return i.viewer.mars.popup.getPopupForConfig({popup:i.config.tooltip},e.properties)},anchor:this.config.tooltipAnchor||[0,-15]}),this.dataSource.entities.add(e),t(e)}});t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(22).default,n=r.extend({dataSource:null,hasOpacity:!1,create:function(){this.dataSource=new Cesium.CustomDataSource;var e=this;this.config.type_new="custom_featuregrid",this.config.addImageryCache=function(t){return e._addImageryCache(t)},this.config.removeImageryCache=function(t){return e._removeImageryCache(t)}},addEx:function(){this.viewer.dataSources.add(this.dataSource)},removeEx:function(){this.viewer.dataSources.remove(this.dataSource)},_addImageryCache:function(e){},_removeImageryCache:function(e){}});t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(11),n=i(13).default,a=i(12).default,o=i(6).default,s=i(3).default,l=n.extend({_keys:null,_key_index:0,getKey:function(){this._keys||(this._keys=this.config.key||["c95467d0ed2a3755836e37dc27369f97","4320dda936d909d73ab438b4e29cf2a2","e64a96ed7e361cbdc0ebaeaf3818c564","df3247b7df64434adecb876da94755d7","d4375ec477cb0a473c448fb1f83be781","13fdd7b2b90a9d326ae96867ebcc34ce","c34502450ae556f42b21760faf6695a0","57f8ebe12797a73fc5b87f5d4ef859b1"]);var e=this._key_index++%this._keys.length;return this._keys[e]},getDataForGrid:function(e,t){var i=r.wgs2gcj([e.rectangle.xmin,e.rectangle.ymax]),n=r.wgs2gcj([e.rectangle.xmax,e.rectangle.ymin]),a=i[0]+","+i[1]+"|"+n[0]+","+n[1],o=this.config.filter||{};o.output="json",o.key=this.getKey(),o.polygon=a,o.offset||(o.offset=25),o.types||(o.types="120000|130000|190000");$.ajax({url:"http://restapi.amap.com/v3/place/polygon",type:"get",dataType:"json",timeout:"5000",data:o,success:function(e){if("10000"!==e.infocode)return void console.log("POI 请求失败("+e.infocode+")："+e.info);var i=e.pois;t(i)},error:function(e){console.log("POI 请求出错("+e.status+")："+e.statusText)}})},createEntity:function(e,t){var i="<div>名称："+t.name+"</div><div>地址："+t.address+"</div><div>区域："+t.pname+t.cityname+t.adname+"</div><div>类别："+t.type+"</div>",n=t.location.split(",");n=r.gcj2wgs(n);var l=this.viewer.mars.point2map({x:n[0],y:n[1]}),u={name:t.name,position:Cesium.Cartesian3.fromDegrees(l.x,l.y,this.config.height||3),popup:{html:i,anchor:[0,-15]},properties:t},c=this.config.symbol;if(c){var h=c.styleOptions;if(c.styleField){var d=attr[c.styleField],p=c.styleFieldOptions[d];null!=p&&(h=$.extend({},h),h=$.extend(h,p))}h=h||{},h.image?(u.billboard=o.attribute2Entity({style:h}),u.billboard.heightReference=Cesium.HeightReference.RELATIVE_TO_GROUND):u.point=a.attribute2Entity({style:h}),h.label&&(u.label=s.attribute2Entity({style:h.label}),u.label.heightReference=Cesium.HeightReference.RELATIVE_TO_GROUND,u.label.text=t.name)}else u.point={color:new Cesium.Color.fromCssColorString("#3388ff"),pixelSize:10,outlineColor:new Cesium.Color.fromCssColorString("#ffffff"),outlineWidth:2,heightReference:Cesium.HeightReference.RELATIVE_TO_GROUND,scaleByDistance:new Cesium.NearFarScalar(1e3,1,2e4,.5)},u.label={text:t.name,font:"16px Helvetica",style:Cesium.LabelStyle.FILL_AND_OUTLINE,fillColor:Cesium.Color.AZURE,outlineColor:Cesium.Color.BLACK,outlineWidth:2,horizontalOrigin:Cesium.HorizontalOrigin.CENTER,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,pixelOffset:new Cesium.Cartesian2(0,-15),heightReference:Cesium.HeightReference.RELATIVE_TO_GROUND,scaleByDistance:new Cesium.NearFarScalar(1e3,1,5e3,.8),distanceDisplayCondition:new Cesium.DistanceDisplayCondition(0,5e3)};return this.dataSource.entities.add(u)}});t.default=l},function(e,t,i){"use strict";function r(e){if(e=Cesium.defaultValue(e,Cesium.defaultValue.EMPTY_OBJECT),this.options=e,this._tileWidth=Cesium.defaultValue(e.tileWidth,256),this._tileHeight=Cesium.defaultValue(e.tileHeight,256),this._minimumLevel=Cesium.defaultValue(e.minimumLevel,0),this._maximumLevel=e.maximumLevel,e.rectangle&&e.rectangle.xmin&&e.rectangle.xmax&&e.rectangle.ymin&&e.rectangle.ymax){var t=e.rectangle.xmin,i=e.rectangle.xmax,r=e.rectangle.ymin,n=e.rectangle.ymax;e.rectangle=Cesium.Rectangle.fromDegrees(t,r,i,n)}this._tilingScheme=Cesium.defaultValue(e.tilingScheme,new Cesium.GeographicTilingScheme({ellipsoid:e.ellipsoid})),this._rectangle=Cesium.defaultValue(e.rectangle,this._tilingScheme.rectangle),this._rectangle=Cesium.Rectangle.intersection(this._rectangle,this._tilingScheme.rectangle),this._hasAlphaChannel=Cesium.defaultValue(e.hasAlphaChannel,!0),this._errorEvent=new Cesium.Event,this._readyPromise=Cesium.when.resolve(!0),this._credit=void 0,this._ready=!0}Object.defineProperty(t,"__esModule",{value:!0}),Cesium.defineProperties(r.prototype,{url:{get:function(){return this._url}},token:{get:function(){return this._token}},proxy:{get:function(){return this._proxy}},tileWidth:{get:function(){if(!this._ready)throw new DeveloperError("tileWidth must not be called before the imagery provider is ready.");return this._tileWidth}},tileHeight:{get:function(){if(!this._ready)throw new DeveloperError("tileHeight must not be called before the imagery provider is ready.");return this._tileHeight}},maximumLevel:{get:function(){if(!this._ready)throw new DeveloperError("maximumLevel must not be called before the imagery provider is ready.");return this._maximumLevel}},minimumLevel:{get:function(){if(!this._ready)throw new DeveloperError("minimumLevel must not be called before the imagery provider is ready.");return 0}},tilingScheme:{get:function(){if(!this._ready)throw new DeveloperError("tilingScheme must not be called before the imagery provider is ready.");return this._tilingScheme}},rectangle:{get:function(){if(!this._ready)throw new DeveloperError("rectangle must not be called before the imagery provider is ready.");return this._rectangle}},tileDiscardPolicy:{get:function(){if(!this._ready)throw new DeveloperError("tileDiscardPolicy must not be called before the imagery provider is ready.");return this._tileDiscardPolicy}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},credit:{get:function(){return this._credit}},usingPrecachedTiles:{get:function(){return this._useTiles}},hasAlphaChannel:{get:function(){return!0}},layers:{get:function(){return this._layers}}}),r.prototype.getTileCredits=function(e,t,i){},r.prototype.requestImage=function(e,t,i){var r=document.createElement("canvas");if(r.width=256,r.height=256,i<this._minimumLevel)return r;if(this.options.debuggerTileInfo){var n=r.getContext("2d");n.strokeStyle="#ffff00",n.lineWidth=2,n.strokeRect(1,1,255,255);var a="L"+i+"X"+e+"Y"+t;n.font="bold 25px Arial",n.textAlign="center",n.fillStyle="black",n.fillText(a,127,127),n.fillStyle="#ffff00",n.fillText(a,124,124)}return r},r.prototype._getGridKey=function(e){return e.level+"_x"+e.x+"_y"+e.y},r.prototype.addImageryCache=function(e){e.level<this._minimumLevel||e.level<e.maxLevel-1||this.options.addImageryCache&&(e.key=this._getGridKey(e),this.options.addImageryCache(e))},r.prototype.removeImageryCache=function(e){e.level<this._minimumLevel||this.options.removeImageryCache&&(e.key=this._getGridKey(e),this.options.removeImageryCache(e))},t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(2).default,n=r.extend({model:null,add:function(){null==this.model&&this.initData(),this.model.setVisible(!0)},remove:function(){null!=this.model&&this.model.setVisible(!1)},initData:function(){function e(e,t){e=e||{},this._tilingScheme=e.tilingScheme||new Cesium.GeographicTilingScheme,this._color=e.color||new Cesium.Color(1,1,1,.4),this._tileWidth=e.tileWidth||256,this._tileHeight=e.tileHeight||256,this._ready=!0,this._sexagesimal=e.sexagesimal||!1,this._numLines=e.numLines||50,this._scene=t,this._labels=new Cesium.LabelCollection,t.primitives.add(this._labels),this._polylines=new Cesium.PolylineCollection,t.primitives.add(this._polylines),this._ellipsoid=t.globe.ellipsoid;var i=document.createElement("canvas");i.width=256,i.height=256,this._canvas=i;var r=this;t.camera.moveEnd.addEventListener(function(){r._show&&(r._polylines.removeAll(),r._labels.removeAll(),r._currentExtent=null,r._drawGrid(r._getExtentView()))}),t.imageryLayers.addImageryProvider(this)}function t(e){return e<.01?2:e<.1?1:0}var i=function(){try{return"x"in Object.defineProperty({},"x",{})}catch(e){return!1}}(),r=Object.defineProperties;i&&r||(r=function(e){return e}),r(e.prototype,{url:{get:function(){}},proxy:{get:function(){}},tileWidth:{get:function(){return this._tileWidth}},tileHeight:{get:function(){return this._tileHeight}},maximumLevel:{get:function(){return 18}},minimumLevel:{get:function(){return 0}},tilingScheme:{get:function(){return this._tilingScheme}},rectangle:{get:function(){return this._tilingScheme.rectangle}},tileDiscardPolicy:{get:function(){}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return this._ready}},credit:{get:function(){return this._credit}},hasAlphaChannel:{get:function(){return!0}}}),e.prototype.makeLabel=function(e,t,i,r,n){this._labels.add({position:this._ellipsoid.cartographicToCartesian(new Cesium.Cartographic(e,t,10)),text:i,font:"16px Helvetica",style:Cesium.LabelStyle.FILL_AND_OUTLINE,fillColor:Cesium.Color.AZURE,outlineColor:Cesium.Color.BLACK,outlineWidth:2,pixelOffset:new Cesium.Cartesian2(5,r?5:-5),eyeOffset:Cesium.Cartesian3.ZERO,horizontalOrigin:Cesium.HorizontalOrigin.LEFT,verticalOrigin:r?Cesium.VerticalOrigin.BOTTOM:Cesium.VerticalOrigin.TOP,scale:1})},e.prototype._drawGrid=function(e){if(!this._currentExtent||!this._currentExtent.equals(e)){this._currentExtent=e,this._polylines.removeAll(),this._labels.removeAll();var i,r=(this._canvasSize,0),a=0;for(i=0;i<n.length&&r<(e.north-e.south)/10;i++)r=n[i];for(i=0;i<n.length&&a<(e.east-e.west)/10;i++)a=n[i];var o=(e.west<0?Math.ceil(e.west/a):Math.floor(e.west/a))*a,s=(e.south<0?Math.ceil(e.south/r):Math.floor(e.south/r))*r,l=(e.east<0?Math.ceil(e.east/r):Math.floor(e.east/r))*r,u=(e.north<0?Math.ceil(e.north/a):Math.floor(e.north/a))*a;o=Math.max(o-2*a,-Math.PI),l=Math.min(l+2*a,Math.PI),s=Math.max(s-2*r,-Math.PI/2),u=Math.min(u+2*a,Math.PI/2);var c,h,d=this._ellipsoid,p=Cesium.Math.toRadians(1),g=s+Math.floor((u-s)/r/2)*r;for(h=o;h<l;h+=a){var f=[];for(c=s;c<u;c+=p)f.push(new Cesium.Cartographic(h,c));f.push(new Cesium.Cartographic(h,u)),this._polylines.add({positions:d.cartographicArrayToCartesianArray(f),width:1});var m=Cesium.Math.toDegrees(h);this.makeLabel(h,g,this._sexagesimal?this._decToSex(m):m.toFixed(t(a)),!1)}var y=o+Math.floor((l-o)/a/2)*a;for(c=s;c<u;c+=r){var f=[];for(h=o;h<l;h+=p)f.push(new Cesium.Cartographic(h,c));f.push(new Cesium.Cartographic(l,c)),this._polylines.add({positions:d.cartographicArrayToCartesianArray(f),width:1});var v=Cesium.Math.toDegrees(c);this.makeLabel(y,c,this._sexagesimal?this._decToSex(v):v.toFixed(t(r)),!0)}}},e.prototype.requestImage=function(e,t,i){return this._show&&this._drawGrid(this._getExtentView()),this._canvas},e.prototype.setVisible=function(e){this._show=e,e?(this._currentExtent=null,this._drawGrid(this._getExtentView())):(this._polylines.removeAll(),this._labels.removeAll())},e.prototype.isVisible=function(){return this._show},e.prototype._decToSex=function(e){var t=Math.floor(e),i=(60*(Math.abs(e)-t)).toFixed(2);return"60.00"==i&&(t+=1,i="0.00"),[t,":",i].join("")},e.prototype._getExtentView=function(){for(var e=this._scene.camera,t=this._scene.canvas,i=[e.pickEllipsoid(new Cesium.Cartesian2(0,0),this._ellipsoid),e.pickEllipsoid(new Cesium.Cartesian2(t.width,0),this._ellipsoid),e.pickEllipsoid(new Cesium.Cartesian2(0,t.height),this._ellipsoid),e.pickEllipsoid(new Cesium.Cartesian2(t.width,t.height),this._ellipsoid)],r=0;r<4;r++)if(void 0===i[r])return Cesium.Rectangle.MAX_VALUE;return Cesium.Rectangle.fromCartographicArray(this._ellipsoid.cartesianArrayToCartographicArray(i))};var n=[Cesium.Math.toRadians(.05),Cesium.Math.toRadians(.1),Cesium.Math.toRadians(.2),Cesium.Math.toRadians(.5),Cesium.Math.toRadians(1),Cesium.Math.toRadians(2),Cesium.Math.toRadians(5),Cesium.Math.toRadians(10)];this.model=new e({numLines:10},this.viewer.scene)}});t.default=n},function(module,exports,__webpack_require__){function createMap(e){return e.url?($.ajax({type:"get",dataType:"json",url:e.url,timeout:0,success:function(t){var i=t.map3d;t.serverURL&&(i.serverURL=t.serverURL),e.serverURL&&(i.serverURL=e.serverURL),createMapByData(e,i,t)},error:function(t,i,r){console.log("Json文件"+e.url+"加载失败！"),haoutil.alert("Json文件"+e.url+"加载失败！")}}),null):(e.serverURL&&e.data&&(e.data.serverURL=e.serverURL),createMapByData(e,e.data))}function createMapByData(opt,configdata,jsondata){if(null==configdata)return void console.log("配置信息不能为空！");if(!configdata.hasOwnProperty("copyright")||configdata.copyright)try{eval(function(e,t,i,r,n,a){if(n=function(e){return e.toString(30)},!"".replace(/^/,String)){for(;i--;)a[n(i)]=r[i]||n(i);r=[function(e){return a[e]}],n=function(){return"\\w+"},i=1}for(;i--;)r[i]&&(e=e.replace(new RegExp("\\b"+n(i)+"\\b","g"),r[i]));return e}('1(g(){2.3("\\4\\5\\6\\7\\8\\9\\a\\b d e\\f\\0\\h\\i %c \\j\\k\\l\\m\\n://o.p.q","r:s")},t);',0,30,"u67b6|setTimeout|console|log|u5f53|u524d|u4e09|u7ef4|u5730|u56fe|u4f7f|u7528MarsGIS||for|Cesium|u6846|function|u5b9e|u73b0|u5b98|u65b9|u7f51|u7ad9|uff1ahttp|cesium|marsgis|cn|color|red|6E4".split("|"),0,{}))}catch(e){}var viewer=_map(opt.id,configdata,opt),gisdata={};return gisdata.config=configdata,viewer.gisdata=gisdata,opt.success&&opt.success(viewer,gisdata,jsondata),viewer}function _map(id,config,options){function destroy(){_tooltip.destroy(),_popup.destroy()}function getLayer(e,t){null==t&&(t="name");var i=configdata.basemaps;if(i&&i.length>0)for(var r=0;r<i.length;r++){var n=i[r];if(null!=n&&n[t]==e)return n._layer}if((i=configdata.operationallayers)&&i.length>0)for(var r=0;r<i.length;r++){var n=i[r];if(null!=n&&n[t]==e)return n._layer}return null}function getConfig(){return _util.clone(configdata)}function getTerrainProvider(){if(null==stkTerrainProvider){var e=configdata.terrain;e.url&&(configdata.serverURL&&(e.url=e.url.replace("$serverURL$",configdata.serverURL)),e.url=e.url.replace("$hostname$",location.hostname).replace("$host$",location.host)),stkTerrainProvider=_util.getTerrainProvider(e)}return stkTerrainProvider}function hasTerrain(){return null!=stkTerrainProvider&&viewer.terrainProvider!=_util.getEllipsoidTerrain()}function updateTerrainProvider(e){viewer.terrainProvider=e?getTerrainProvider():_util.getEllipsoidTerrain()}function changeBasemap(e){for(var t=viewer.gisdata.config.basemaps,i=0;i<t.length;i++){var r=t[i];"group"==r.type&&null==r.layers||null!=r._layer&&(e==r.name||e==r.id?r._layer.setVisible(!0):r._layer.setVisible(!1))}}function getImageryProviderArr(){var providerViewModels=[],layersCfg=configdata.basemaps;if(layersCfg&&layersCfg.length>0)for(var i=0;i<layersCfg.length;i++){var item=layersCfg[i];if("group"!=item.type||null!=item.layers){var funstr="var _basemaps"+i+" = function () {                        var item = "+JSON.stringify(item)+';                        if (item.type == "group") {                            var arrVec = [];                            for (var index = 0; index < item.layers.length; index++) {                                var temp = mars3d.layer.createImageryProvider(item.layers[index]);                                if (temp == null) continue;                                arrVec.push(temp);                            }                            return arrVec;                        }                        else {                            return mars3d.layer.createImageryProvider(item);                        }                     }';eval(funstr);var imgModel=new Cesium.ProviderViewModel({name:item.name||"未命名",tooltip:item.name||"未命名",iconUrl:item.icon||"",creationFunction:eval("_basemaps"+i)});providerViewModels.push(imgModel)}}return providerViewModels}function getTerrainProviderViewModelsArr(){return[new Cesium.ProviderViewModel({name:"无地形",iconUrl:Cesium.buildModuleUrl("Widgets/Images/TerrainProviders/Ellipsoid.png"),tooltip:"WGS84标准椭球，即 EPSG:4326",category:"",creationFunction:function(){return new Cesium.EllipsoidTerrainProvider({ellipsoid:Cesium.Ellipsoid.WGS84})}}),new Cesium.ProviderViewModel({name:"有地形",iconUrl:Cesium.buildModuleUrl("Widgets/Images/TerrainProviders/CesiumWorldTerrain.png"),tooltip:"提供的高分辨率全球地形",category:"",creationFunction:function(){return getTerrainProvider()}})]}function centerAt(e,t){if(null==t?t={}:_util.isNumber(t)&&(t={duration:t}),null==e&&(t.isWgs84=!0,e=configdata.extent||configdata.center),e.xmin&&e.xmax&&e.ymin&&e.ymax){var i=e.xmin,r=e.xmax,n=e.ymin,a=e.ymax;if(t.isWgs84){var o=point2map({x:i,y:n});i=o.x,n=o.y;var s=point2map({x:r,y:a});r=s.x,a=s.y}var l=Cesium.Rectangle.fromDegrees(i,n,r,a);viewer.camera.flyTo({destination:l,duration:t.duration,complete:t.complete})}else{t.isWgs84&&(e=point2map(e));var u=t.minz||2500;viewer.camera.positionCartographic.height<u&&(u=viewer.camera.positionCartographic.height),null!=e.z&&0!=e.z&&(u=e.z),viewer.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(e.x,e.y,u),orientation:{heading:Cesium.Math.toRadians(e.heading||0),pitch:Cesium.Math.toRadians(e.pitch||-90),roll:Cesium.Math.toRadians(e.roll||0)},duration:t.duration,complete:t.complete})}}function isFlyAnimation(){return _isFlyAnimation}function openFlyAnimation(e,t){var i=t||_latlng.getCameraView(viewer);_isFlyAnimation=!0,viewer.camera.setView({destination:Cesium.Cartesian3.fromDegrees(-85.16,13.71,23e6)}),viewer.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(i.x,i.y,23e6),duration:2,easingFunction:Cesium.EasingFunction.LINEAR_NONE,complete:function(){var t=1.2*(i.z||9e4)+8e3;t>23e6&&(t=23e6),viewer.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(i.x,i.y,t),complete:function(){centerAt(i,{duration:2,complete:function(){_isFlyAnimation=!1,e&&e()}})}})}})}function rotateAnimation(e,t){var i=_latlng.getCameraView(viewer),r=t/3;viewer.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(i.x+120,i.y,i.z),orientation:{heading:Cesium.Math.toRadians(i.heading),pitch:Cesium.Math.toRadians(i.pitch),roll:Cesium.Math.toRadians(i.roll)},duration:r,easingFunction:Cesium.EasingFunction.LINEAR_NONE,complete:function(){viewer.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(i.x+240,i.y,i.z),orientation:{heading:Cesium.Math.toRadians(i.heading),pitch:Cesium.Math.toRadians(i.pitch),roll:Cesium.Math.toRadians(i.roll)},duration:r,easingFunction:Cesium.EasingFunction.LINEAR_NONE,complete:function(){viewer.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(i.x,i.y,i.z),orientation:{heading:Cesium.Math.toRadians(i.heading),pitch:Cesium.Math.toRadians(i.pitch),roll:Cesium.Math.toRadians(i.roll)},duration:r,easingFunction:Cesium.EasingFunction.LINEAR_NONE,complete:function(){e&&e()}})}})}})}function addLocationWidget(e){$("#"+viewerDivId).prepend('<div id="location_mars_jwd"  class="location-bar animation-slide-bottom no-print" >                        <div id="location_mars_camera" ></div>                        <div id="location_mars_height" ></div>                        <div id="location_mars_lat" ></div>                        <div id="location_mars_lon" ></div>                        <div id="mars_msgbar" style="min-width: 0px;" ></div>                      </div>'),e.style?$("#location_mars_jwd").css(e.style):$("#location_mars_jwd").css({left:viewer.animation?"170px":"0",right:"0",bottom:viewer.timeline?"25px":"0"}),new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas).setInputAction(function(t){var i=_latlng.getCurrentMousePosition(viewer.scene,t.endPosition);if(i){var r=Cesium.Cartographic.fromCartesian(i),n=Cesium.Math.toDegrees(r.longitude),a=Cesium.Math.toDegrees(r.latitude),o=r.height,s={};switch(e.crs){default:var l=e.hasOwnProperty("toFixed")?e.toFixed:6;s.x=n.toFixed(l),s.y=a.toFixed(l);break;case"degree":s.x=_util.formatDegree(n),s.y=_util.formatDegree(a);break;case"project":var l=e.hasOwnProperty("toFixed")?e.toFixed:0;s.x=i.x.toFixed(l),s.y=i.y.toFixed(l);break;case"wgs":var l=e.hasOwnProperty("toFixed")?e.toFixed:6,u=point2wgs({x:n,y:a});s.x=u.x.toFixed(l),s.y=u.y.toFixed(l);break;case"wgs-degree":var u=point2wgs({x:n,y:a});s.x=_util.formatDegree(u.x),s.y=_util.formatDegree(u.y)}$("#location_mars_lon").html("经度："+s.x),$("#location_mars_lat").html("纬度："+s.y),0!=o&&o>-500&&$("#location_mars_height").html("海拔："+o.toFixed(1)+"米")}else $("#location_mars_lon").html(""),$("#location_mars_lat").html(""),$("#location_mars_height").html("")},Cesium.ScreenSpaceEventType.MOUSE_MOVE),viewer.scene.camera.changed.addEventListener(function(e){var t=viewer.camera.positionCartographic,i="视点高："+t.height.toFixed(1)+"米";$("#location_mars_camera").html(i)})}function addMsgBarWidget(e){function t(){var t=_latlng.getCenter(viewer);if(t){var i=!1;for(var r in e.data){var n=e.data[r];if(t.x>=n.xmin&&t.x<=n.xmax&&t.y>=n.ymin&&t.y<=n.ymax){$("#mars_msgbar").html(n.msg),i=!0;break}}}i||$("#mars_msgbar").html("")}null!=e.data&&0!=e.data.length&&(document.getElementById("mars_msgbar")||($("#"+viewerDivId).prepend('<div id="mars_msgbar" class="location-bar animation-slide-bottom no-print" ></div>'),e.style&&$("#mars_msgbar").css(e.style)),viewer.scene.camera.moveEnd.addEventListener(t))}function addNavigationWidget(e){Cesium.viewerCesiumNavigationMixin&&(viewer.extend(Cesium.viewerCesiumNavigationMixin,{defaultResetView:Cesium.Rectangle.fromDegrees(110,20,120,30),enableZoomControls:!0}),viewer.animation?$(".distance-legend").css({left:"150px",bottom:"25px",border:"none",background:"rgba(0, 0, 0, 0)","z-index":"992"}):$(".distance-legend").css({left:"-10px",bottom:"-1px",border:"none",background:"rgba(0, 0, 0, 0)","z-index":"992"}),$(".navigation-controls").hide(),e.style?$(".compass").css(e.style):$(".compass").css({top:"10px",left:"10px"}))}function getCrs(){return crs}function point2map(e){if("gcj"==crs){var t=_util.clone(e),i=pointconvert.wgs2gcj([t.x,t.y]);return t.x=i[0],t.y=i[1],t}return e}function point2wgs(e){if("gcj"==crs){var t=_util.clone(e),i=pointconvert.gcj2wgs([t.x,t.y]);return t.x=i[0],t.y=i[1],t}return e}var viewer,viewerDivId,configdata,crs;viewerDivId=id,configdata=config;var defoptions={animation:!1,timeline:!1,fullscreenButton:!0,vrButton:!1,geocoder:!1,sceneModePicker:!1,homeButton:!0,navigationHelpButton:!0,navigationInstructionsInitiallyVisible:!1,infoBox:!0,selectionIndicator:!1,shouldAnimate:!0,baseLayerPicker:!1};for(var key in configdata)"crs"!==key&&"controls"!==key&&"minzoom"!==key&&"maxzoom"!==key&&"center"!==key&&"style"!==key&&"terrain"!==key&&"basemaps"!==key&&"operationallayers"!==key&&(defoptions[key]=configdata[key]);null==options&&(options={});for(var i in defoptions)options.hasOwnProperty(i)||(options[i]=defoptions[i]);if(Cesium.BingMapsApi.defaultKey="AtkX3zhnRe5fyGuLU30uZw8r3sxdBDnpQly7KfFTCB2rGlDgXBG3yr-qEiQEicEc",Cesium.Ion&&(Cesium.Ion.defaultAccessToken=configdata.ionToken||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI1NjM5MjMxOS1lMWVkLTQyNDQtYTM4Yi0wZjA4ZDMxYTlmNDMiLCJpZCI6MTQ4MiwiaWF0IjoxNTI4Njc3NDQyfQ.vVoSexHMqQhKK5loNCv6gCA5d5_z3wE2M0l_rWnIP_w"),configdata.crs=configdata.crs||"3857",crs=configdata.crs,!0===options.geocoder){var _GaodePOIGeocoder=__webpack_require__(52).default;options.geocoder=new _GaodePOIGeocoder(options.geocoderConfig)}configdata.terrain&&configdata.terrain.visible&&(options.terrainProvider=getTerrainProvider());var hasremoveimagery=!1;if(options.baseLayerPicker?(options.imageryProviderViewModels||(options.imageryProviderViewModels=getImageryProviderArr()),options.terrainProviderViewModels||(options.terrainProviderViewModels=getTerrainProviderViewModelsArr())):null==options.imageryProvider&&(hasremoveimagery=!0,options.imageryProvider=Cesium.createTileMapServiceImageryProvider({url:Cesium.buildModuleUrl("Assets/Textures/NaturalEarthII")})),viewer=new Cesium.Viewer(id,options),viewer.cesiumWidget.creditContainer.style.display="none",viewer.mars={popup:_popup,tooltip:_tooltip,keyboard:function(e){e?_firstPerson.bind(viewer):_firstPerson.unbind(viewer)},getLayer:getLayer,centerAt:centerAt,isFlyAnimation:isFlyAnimation,openFlyAnimation:openFlyAnimation,rotateAnimation:rotateAnimation,hasTerrain:hasTerrain,updateTerrainProvider:updateTerrainProvider,changeBasemap:changeBasemap,getCrs:getCrs,point2map:point2map,point2wgs:point2wgs,getConfig:getConfig,destroy:destroy},hasremoveimagery)for(var imageryLayerCollection=viewer.imageryLayers,length=imageryLayerCollection.length,i=0;i<length;i++){var layer=imageryLayerCollection.get(0);imageryLayerCollection.remove(layer,!0)}viewer.homeButton&&viewer.homeButton.viewModel.command.beforeExecute.addEventListener(function(e){centerAt(),e.cancel=!0}),centerAt(null,{duration:0});var orderlayers=[];if(!options.baseLayerPicker){var layersCfg=configdata.basemaps;if(layersCfg&&layersCfg.length>0)for(var i=0;i<layersCfg.length;i++){var item=layersCfg[i];if(item.visible&&item.crs&&(crs=item.crs),_layer.createLayer(item,viewer,config.serverURL,options.layerToMap),orderlayers.push(item),"group"==item.type&&item.layers)for(var idx=0;idx<item.layers.length;idx++){var childitem=item.layers[idx];orderlayers.push(childitem)}}}var layersCfg=configdata.operationallayers;if(layersCfg&&layersCfg.length>0)for(var i=0;i<layersCfg.length;i++){var item=layersCfg[i];if(_layer.createLayer(item,viewer,config.serverURL,options.layerToMap),orderlayers.push(item),"group"==item.type&&item.layers)for(var idx=0;idx<item.layers.length;idx++){var childitem=item.layers[idx];orderlayers.push(childitem)}}for(var i=0;i<orderlayers.length;i++){var item=orderlayers[i],order=Number(item.order);isNaN(order)&&(order=i),item.order=order,null!=item._layer&&item._layer.setZIndex(order)}var lastCameraView;viewer.scene.morphStart.addEventListener(function(e){lastCameraView=_latlng.getCameraView(viewer)}),viewer.scene.morphComplete.addEventListener(function(e){setTimeout(function(){centerAt(lastCameraView,{duration:2})},100)});var hasMouseZomm=!1,controlsCfg=configdata.controls;if(controlsCfg)for(var i=0;i<controlsCfg.length;i++){var item=controlsCfg[i];if(!item.hasOwnProperty("visible")||item.visible)switch(item.type){case"navigation":addNavigationWidget(item);break;case"location":addLocationWidget(item);break;case"msgbar":addMsgBarWidget(item);break;case"mousezoom":hasMouseZomm=!0}}options.geocoder&&(options.geocoder.viewer=viewer),_popup.init(viewer),_tooltip.init(viewer);var scene=viewer.scene;if(scene.globe.baseColor=new Cesium.Color.fromCssColorString("#546a53"),configdata.style&&(scene.globe.depthTestAgainstTerrain=configdata.style.testTerrain,scene.globe.enableLighting=configdata.style.lighting,scene.skyAtmosphere&&(scene.skyAtmosphere.show=configdata.style.atmosphere),scene.fog&&(scene.fog.enabled=configdata.style.fog)),scene.screenSpaceCameraController.maximumZoomDistance=configdata.maxzoom||2e7,scene.screenSpaceCameraController.minimumZoomDistance=configdata.minzoom||1,viewer._cesiumWidget._supportsImageRenderingPixelated=Cesium.FeatureDetection.supportsImageRenderingPixelated(),viewer._cesiumWidget._forceResize=!0,Cesium.FeatureDetection.supportsImageRenderingPixelated()){for(var vtxf_dpr=window.devicePixelRatio;vtxf_dpr>=2;)vtxf_dpr/=2;viewer.resolutionScale=vtxf_dpr}if(!config.hasOwnProperty("copyright")||config.copyright){var viewportQuad=new Cesium.ViewportQuad;viewportQuad.rectangle=new Cesium.BoundingRectangle(160,5,103,24),viewer.scene.primitives.add(viewportQuad),viewportQuad.material=new Cesium.Material({fabric:{type:"Image",uniforms:{color:new Cesium.Color(1,1,1,1),image:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGcAAAAYCAYAAADnNePtAAAACXBIWXMAAAsTAAALEwEAmpwYAAAF42lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDIgNzkuMTYwOTI0LCAyMDE3LzA3LzEzLTAxOjA2OjM5ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo2NzBCMzhDNkMyQjdFNzExOEQ3MUQ1NDIzMjRERTZDQyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozQ0ZEMzEyOEJEREIxMUU3ODBCOTg1QTM3NDY2NEVEMSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpmZDk2M2I4ZC01MDdlLTVjNDUtOTg4OS02MmY0NTg2NDhjNGEiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBXaW5kb3dzIiB4bXA6Q3JlYXRlRGF0ZT0iMjAxOC0xMC0yNVQyMDowNzozMyswODowMCIgeG1wOk1vZGlmeURhdGU9IjIwMTgtMTAtMjVUMjA6MjY6MjMrMDg6MDAiIHhtcDpNZXRhZGF0YURhdGU9IjIwMTgtMTAtMjVUMjA6MjY6MjMrMDg6MDAiIGRjOmZvcm1hdD0iaW1hZ2UvcG5nIiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDozM0I4MEQ3RkM3QjdFNzExOTE4NkRGNjMwMjlEOTE4MiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo2NzBCMzhDNkMyQjdFNzExOEQ3MUQ1NDIzMjRERTZDQyIvPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJzYXZlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDpmZDk2M2I4ZC01MDdlLTVjNDUtOTg4OS02MmY0NTg2NDhjNGEiIHN0RXZ0OndoZW49IjIwMTgtMTAtMjVUMjA6MjY6MjMrMDg6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAoV2luZG93cykiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+fps6oAAACQpJREFUaIHtmnuw1VUVxz+Xx+WChTwERXm/EuWpIIkJDYSMgImNFmBTwYB4MRIYsVQkHiZgylgJWmShSC/y0YgCCgr4oEiEgJwUkAgQeRuI6AX59sdavzn77Pv7nXtv0zTNxJrZ89t7rbXXfq/9XfucIklUgroAA4BLgHZAEdAGqAvsBdYBTwFPAscrY/AMVUxFFSxOfeBxYHCK7CBwDGiILRLACWAc8Oh/sI//t1StgGwssIvyC/McdoIaAa2Bs4EmwJ1AbeDnwBP/Rl+KsRP5v041gOr/lZYkpaXHlE4zA50Wkr7o34TXWNIq130ow3ZWmiFpi6SHJX1TUq1K1jtH0uOS7pPUQ1IrSZ8LUntJ50m6XdJ6SV+thO1iSbMlLZXUMJINk3RA0jJJ0yXVSanfRtK3JPWUdFYkayXpO26na6F+pDF/mrEwt7n8S5IWStrk/COSSqMBr3FZnyoszp1BWztSBpWV6kja5fV2yzbQNP/OlHSPpHslvR/YvyPDVlMf5/ZA96lI54ZAtklStRQ7Vwc6hyR1C2RXBLJXCo0tZoxXOi0KdJrIdpUk7Zd0VYrhTi5/rlDjURodtDe+CvVQbjJXFtB5IbDfJeDXljRC0mJJRwOdA7KTvFY2oUmdHoHO9zPaaivpuOu8FMm6BfVnO6+jpIGxnRqBh6sG3Jji+fYCs4PyPuAqz08FXkipsxlYAwwEGgP7K+Fhw76UBfkLgA+Bf1bCxnnADcBJoJbzTgFyGcCnwAdRW/8AfuT9nub8rwPLPT8GeAR4E/it1ykm++455G3U8bbHAiuBt4GzAr2j/n0CQ8TzgUnJWMMJ6ewpps3AnqD8FaCr57dndA5gK9AbAwtpi1MEdAT+jqG+04GsJMgvA1oCE73zhagMeA9bnMTGyUCWRp9iEwe5BQTYDfTCNuevgHswINQYOAKcm2JrENAdeJ8c2OrraR/wG+CcSL8Ztg7vAtcAG4CHIbc4NwPDsd0QUy3yF/GzQb4Lud0VU0v/fpIhF4b8ZgHzvJxQG//2xhYQ4GfAFOALwM4Mm4eA1zJkhzP4PYBWwHqgvfM+Bq4DbsEWrC3wGHAT8Gvnp9E7QANsvhLk+RIwHkO2S7AFTjzUauCOoH4RwWlMJr010DSjwerkXATYTk9oFHbcj5JPHYB+2A7bnWF3MLZr+mCL0yCQtfNv/4C3FVhA+cWui0F4gIuAGdhJLcNcWnVsgjtl9KO2yw4ALZxXgrnSwZhrngLMAW7DFnNShq2tngAmYKdrF+Z9Njv/VKCfzFt17AQrlCdHrz75JyKkBzCfnNDLwBueb+flDoG8F/A7z8/3QcZ0ObYTAXr6t0Ugb4DdNUO8vB24GrgXcxkh1ccm+GMs+J2K+frBbnOf92MzFjjfh7mqhNYAd/s4Tgb8Iuw0zQCaAxuB0pSxZFFyAnpid80K72uzQGcQ5gUWkr85jRwZLFE29U5BI30jneOS1jm6OeW8nbK4J65bTdLmoO4G56/18hZJr0v6k5dXSaqXgYrwNg57e1923sTA/txAd6LS0SWSasggvCSdlFQmg8EdvI4k7ZHFKCe8PD2y0VSGOhd6fUk6LQtPxsjQ62IZlJ8czcMRWXxUDkovUzqVyWBe2mAGyOBmGr0WNxSllYFuPxk8/8jL8yX9wvMTCthI0jVR29+TNCko3y+pmSz2OOa8eFKRQdmE3pOFD5K00fsoGSwOY5hHJF0sqbrbuDVlLhYEbUyQHYSk/Gyg96SkumGfErf2N8w3xlSTHGyOaTl2Ud6CXZJ/wJ5uhmD3SIjk4meiIcD1QDcMKQ0ld2+s8rqnqdwbXV//7scg7wpyFztAPe9nTeBW4CHSQcq1Qb4Ic4PHsEt+pdvpSz6kHwZswS59MBcJsA1zoTGtw9xzVwxS93H+AQxu59/dvkqlkl71FVwj6YNgRU9Jul45l1SV4BCZS2pfQF6i3PE+4Lz+Xv59BbYvkLmgPTKXkvBHBv0f4bwWkoZk2LlI5poPBvUukz3BTHAbwySNkjQv0PmL7BVierDrR8mC0D+7zrKgnSJJ+2TPSHMDO1PS+pVk+kh61BWXBoYT2hENviqpo09ilnxc0M5dzmsl6RPn/aRA3edl/n+yLIK/XHZHzAls/lDShcrdYStk90toZ5WPO3ya6SdbtBEyl9dd5n6HBTrTMvpVQ9I7rrMqkj2ofHo6a3yJu1mNxRH4kXuQ/LigJfAD8uOdiqgehsreJTvGaIYFdwCvYGgMYAfwoue/jSGptlHdK7DguDEG7/thAV4T8pFnfSyOWQCMBhaTc6Fgbua0f8PfotoBbwG/BJ7HEOpeH09FdAqDxgTfhJZE5bQXFqNotZb6ao6TNFblaaOkwQV2cpJ6S3pL9hJcQ1LrFJ1Gkt5wu5tkr8uhfEDU9gnZBTpcdgEXe0prf0xQrzSS1ZSdgKTcVtK5yl3YCY3MsB0CgrsjWWefn+HKobXwba2HDAHG9LbsFX+qDAnnnZyEZvn3x9gp6Uv+s0cX4FnsEpyA7d7OwGXA17B3qfXYSUx23JWU322tgbXApcAitxNfoMu9HwmVYLFLRwxglGFxSU3sZaOE3JNNvaBeeIo+A7yOPfHMdN42LBZK2kgo7bUktn1+JNvrfVzk/YKc17gHAwQfYuDjrqBeewxYDSQ8vSk7ozRY0V6Smssuviw6ncKbJ+l82R3SLLI/Snaf7JT9/FDRKZzvNo9KujTg9/N+PeM7uFQGZUfLLtuNstM7T9JN3u4cSVsl7XWb10ZthXfVzRn9CWOoRRk6f3T5R5JelMHkzZK+Eel1Ug5On1DkYbImZIByyGW6zAUN8gktRG/KLs7Gssvy4shuU0mz3FZFixKm2yXdGPHOli1QF+9fsez5v45ycQeeT/glAb+RorhC0lBJq2UuPev3pOsk/VXSA5JaZui0lwXETWUI8fMVjK+7ym+Ugv8haI65sM7AZAwQdMIu+R7Ys8SrfvyHYrHDM9hTzjbgu+Q/k5yhKlJFf/AAGIkhocPA09jEF3tqCNyPPTi+DFyIIZ/+pAe1Z6gKVJnFAXu6vwR7ku+AwcMN2MPdlcBcDCIexP6Bk/XbyRmqAv0L6oKRuwwQEIsAAAAASUVORK5CYII="}}})}if(hasMouseZomm&&_util.isPCBroswer()){$("#"+viewerDivId).append('<div class="cesium-mousezoom"><div class="zoomimg"/></div>');var handler=new Cesium.ScreenSpaceEventHandler(scene.canvas);handler.setInputAction(function(e){$(".cesium-mousezoom").addClass("cesium-mousezoom-visible"),setTimeout(function(){$(".cesium-mousezoom").removeClass("cesium-mousezoom-visible")},200)},Cesium.ScreenSpaceEventType.WHEEL),handler.setInputAction(function(e){$(".cesium-mousezoom").css({top:e.endPosition.y+"px",left:e.endPosition.x+"px"})},Cesium.ScreenSpaceEventType.MOUSE_MOVE)}var stkTerrainProvider,_isFlyAnimation=!1;return viewer}var _layer=__webpack_require__(21),_util=__webpack_require__(5),pointconvert=__webpack_require__(11),_latlng=__webpack_require__(4),_popup=__webpack_require__(54),_tooltip=__webpack_require__(55),_firstPerson=__webpack_require__(53);exports.name="Cesium三维地球框架",exports.version="1.6",exports.author="木遥（QQ 516584683，微信 marsgis）",exports.website="http://cesium.marsgis.cn",exports.createMap=createMap,exports.layer=_layer,exports.pointconvert=pointconvert,exports.latlng=_latlng,exports.util=_util,exports.draw={},exports.draw.utils=__webpack_require__(0).default,exports.draw.DynamicProperty=__webpack_require__(1).default,exports.draw.BillboardControl=__webpack_require__(6).default,exports.draw.LabelControl=__webpack_require__(3).default,exports.draw.EllipseControl=__webpack_require__(15).default,exports.draw.PolylineControl=__webpack_require__(8).default,exports.draw.PolylineVolumeControl=__webpack_require__(18).default,exports.draw.PolygonControl=__webpack_require__(7).default,exports.draw.EllipsoidControl=__webpack_require__(16).default,exports.draw.PointControl=__webpack_require__(12).default,exports.draw.RectangleControl=__webpack_require__(19).default,exports.draw.ModelControl=__webpack_require__(17).default,exports.draw.WallControl=__webpack_require__(20).default,exports.Draw=__webpack_require__(14).default,exports.Measure=__webpack_require__(51).default,exports.FlowEcharts=__webpack_require__(56).default},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(14).default,n=i(3).default,a=i(0).default,o=i(5),s=i(4),l=function(e){function t(e){d(),C="length",e=e||{},e.type=C,e.hasOwnProperty("terrain")||(e.terrain=!0),x.start(e)}function l(e){d(),C="section",e=e||{},e.type=C,e.terrain=!0,x.start(e)}function u(e){d(),C="area",e=e||{},e.type=C,M.start(e)}function c(e){d(),e=e||{},e.hasOwnProperty("isSuper")&&!e.isSuper?(C="height",e.type=C,E.start(e)):(C="super_height",e.type=C,S.start(e))}function h(e){d(),C="angle",e=e||{},e.type=C,P.start(e)}function d(){x.clearLastNoEnd(),M.clearLastNoEnd(),E.clearLastNoEnd(),S.clearLastNoEnd(),P.clearLastNoEnd(),w.stopDraw()}function p(){C="",d(),w.deleteAll()}function g(e,t){var i=_.entities.values;for(var r in i){var n=i[r];if(n.label&&n.isMarsMeasureLabel&&n.attribute&&n.attribute.value){if(n.attribute.type!=e)continue;"area"==e?n.label.text._value=(n.attribute.textEx||"")+f(n.attribute.value,t):n._label.text._value=(n.attribute.textEx||"")+m(n.attribute.value,t)}}}function f(e,t){if(null==e)return"";null!=t&&"auto"!=t||(t=e<1e6?"m":"km");var i="";switch(t){default:case"m":i=e.toFixed(2)+"平方米";break;case"km":i=(e/1e6).toFixed(2)+"平方公里";break;case"mu":i=(.0015*e).toFixed(2)+"亩";break;case"ha":i=(1e-4*e).toFixed(2)+"公顷"}return i}function m(e,t){if(null==e)return"";null!=t&&"auto"!=t||(t=e<1e3?"m":"km");var i="";switch(t){default:case"m":i=e.toFixed(2)+"米";break;case"km":i=(.001*e).toFixed(2)+"公里";break;case"mile":i=(54e-5*e).toFixed(2)+"海里";break;case"zhang":i=(.3*e).toFixed(2)+"丈"}return i}var y=e.viewer,v={color:"#ffffff",font_family:"楷体",font_size:23,border:!0,border_color:"#000000",border_width:3,background:!0,background_color:"#000000",background_opacity:.5,scaleByDistance:!0,scaleByDistance_far:8e5,scaleByDistance_farValue:.3,scaleByDistance_near:1e3,scaleByDistance_nearValue:1,pixelOffset:[0,-15]};if(e.label)for(var b in e.label)v[b]=e.label[b];var C="",w=new r({viewer:y,hasEdit:!1,onChangeDrawing:function(e){switch(C){case"length":case"section":x.showAddPointLength(e);break;case"area":M.showAddPointLength(e);break;case"height":E.showAddPointLength(e);break;case"super_height":S.showAddPointLength(e);break;case"angle":P.showAddPointLength(e)}},onMoveDrawing:function(e){switch(C){case"length":case"section":x.showMoveDrawing(e);break;case"area":M.showMoveDrawing(e);break;case"height":E.showMoveDrawing(e);break;case"super_height":S.showMoveDrawing(e);break;case"angle":P.showMoveDrawing(e)}},onStopDrawing:function(e){switch(C){case"length":case"section":x.showDrawEnd(e);break;case"area":M.showDrawEnd(e);break;case"height":E.showDrawEnd(e);break;case"super_height":S.showDrawEnd(e);break;case"angle":P.showDrawEnd(e)}}}),_=w.getDataSource(),x={options:null,arrLables:[],totalLable:null,clearLastNoEnd:function(){if(null!=this.totalLable&&_.entities.remove(this.totalLable),this.arrLables&&this.arrLables.length>0){var e=this.arrLables;if(e&&e.length>0)for(var t in e)_.entities.remove(e[t])}this.totalLable=null,this.arrLables=[]},start:function(e){this.options=e;var t=n.attribute2Entity({style:v},{horizontalOrigin:Cesium.HorizontalOrigin.LEFT,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,show:!1});this.totalLable=_.entities.add({label:t,isMarsMeasureLabel:!0,attribute:{unit:this.options.unit,type:this.options.type}}),this.arrLables=[],w.startDraw({type:"polyline",addHeight:e.addHeight,style:e.style||{lineType:"glow",color:"#ebe12c",width:9,glowPower:.1,clampToGround:"section"==this.options.type||this.options.terrain}})},showAddPointLength:function(e){var t=w.getPositions(e),i=n.attribute2Entity({style:v},{horizontalOrigin:Cesium.HorizontalOrigin.LEFT,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,show:!0}),r=_.entities.add({position:t[t.length-1],label:i,isMarsMeasureLabel:!0,attribute:{unit:this.options.unit,type:this.options.type}});if(1==t.length)r.label.text="起点";else{var a=this.getLength(t),o=m(a,this.options.unit);r.label.text=o,r.attribute.value=a,this.getLength([t[t.length-2],t[t.length-1]])<5&&(r.show=!1)}this.arrLables.push(r)},showMoveDrawing:function(e){var t=w.getPositions(e);if(!(t.length<2)){var i=this.getLength(t),r=m(i,this.options.unit);this.totalLable.position=t[t.length-1],this.totalLable.label.text="总长:"+r,this.totalLable.label.show=!0,this.totalLable.attribute.value=i,this.totalLable.attribute.textEx="总长:",this.options.calback&&this.options.calback(r,i)}},showDrawEnd:function(e){var t=w.getPositions(e),i=this.arrLables.length-t.length;if(i>=0){for(var r=this.arrLables.length-1;r>=t.length-1;r--)_.entities.remove(this.arrLables[r]);this.arrLables.splice(t.length-1,i+1)}e._totalLable=this.totalLable,e._arrLables=this.arrLables,this.totalLable=null,this.arrLables=[],null!=e.polyline&&("section"==this.options.type?this.updateSectionForTerrain(e):this.options.terrain&&this.updateLengthForTerrain(e))},updateLengthForTerrain:function(e){function t(){l++;var c=[r[l-1],r[l]];o.terrainPolyline({viewer:y,positions:c,calback:function(o,h){if(u=h?1==l?u.concat(c):u.concat([r[l]]):u.concat(o),l>=r.length-1){if(e.polyline.positions.setValue(u),a){var d=i.getLength(u),p=m(d,s);a.label.text="总长:"+p,a.attribute.value=d,i.options.calback&&i.options.calback(p,d)}}else{var d=i.getLength(o),p=m(d,s),g=n[l];g.label.text=p,g.attribute.value=d,t()}}})}var i=this,r=e.polyline.positions.getValue(),n=e._arrLables,a=e._totalLable,s=a&&a.unit,l=0,u=[];t()},updateSectionForTerrain:function(e){function t(){l++;var e=[i[l-1],i[l]];o.terrainPolyline({viewer:y,positions:e,calback:function(o,y){u=y?1==l?u.concat(e):u.concat([i[l]]):u.concat(o);for(var v=Cesium.Cartographic.fromCartesian(i[l-1]).height,b=Cesium.Cartographic.fromCartesian(i[l]).height,C=(b-v)/o.length,w=0;w<o.length;w++){0!=w&&(c+=Cesium.Cartesian3.distance(o[w],o[w-1])),h.push(Number(c.toFixed(1)));var _=s.formatPositon(o[w]);d.push(_.z),g.push(_);var x=Number((v+C*w).toFixed(1));p.push(x)}if(l>=i.length-1){if(n){var M=f.getLength(u),E=m(M,a);n.label.text="总长:"+E,n.attribute.value=M}f.options.calback&&f.options.calback({distancestr:E,distance:M,arrLen:h,arrLX:p,arrHB:d,arrPoint:g})}else{var M=f.getLength(o),E=m(M,a),S=r[l];S.label.text=E,S.attribute.value=M,t()}}})}var i=e.polyline.positions.getValue();if(!(i.length<2)){var r=e._arrLables,n=e._totalLable,a=n&&n.unit,l=0,u=[],c=0,h=[],d=[],p=[],g=[],f=this;t()}},getLength:function(e){for(var t=0,i=0,r=e.length-1;i<r;i++)t+=Cesium.Cartesian3.distance(e[i],e[i+1]);return t}},M={options:null,totalLable:null,clearLastNoEnd:function(){null!=this.totalLable&&_.entities.remove(this.totalLable),this.totalLable=null},start:function(e){this.options=e;var t=n.attribute2Entity({style:v},{horizontalOrigin:Cesium.HorizontalOrigin.CENTER,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,show:!1});this.totalLable=_.entities.add({label:t,isMarsMeasureLabel:!0,attribute:{unit:this.options.unit,type:this.options.type}}),w.startDraw({type:"polygon",style:e.style||{color:"#00fff2",outline:!0,outlineColor:"#fafa5a",outlineWidth:4,opacity:.4,clampToGround:!0}})},showAddPointLength:function(e){},showMoveDrawing:function(e){var t=w.getPositions(e);if(!(t.length<3)){var r=i(7).default,n=r.toGeoJSON(e),o=turf.area(n),s=f(o,this.options.unit),l=turf.centerOfMass(n),u=a.getMaxHeightForPositions(t),c=Cesium.Cartesian3.fromDegrees(l.geometry.coordinates[0],l.geometry.coordinates[1],u+1);this.totalLable.position=c,this.totalLable.label.text="面积:"+s,this.totalLable.label.show=!0,this.totalLable.attribute.value=o,this.totalLable.attribute.textEx="面积:",this.options.calback&&this.options.calback(s,o)}},showDrawEnd:function(e){if(null!=e.polygon){var t=e.polygon.hierarchy.getValue();$.each(t,function(e,t){t.z=t.z+1}),e._totalLable=this.totalLable,this.totalLable=null}}},E={options:null,totalLable:null,clearLastNoEnd:function(){null!=this.totalLable&&_.entities.remove(this.totalLable),this.totalLable=null},start:function(e){this.options=e;var t=n.attribute2Entity({style:v},{horizontalOrigin:Cesium.HorizontalOrigin.RIGHT,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,show:!1});this.totalLable=_.entities.add({label:t,isMarsMeasureLabel:!0,attribute:{unit:this.options.unit,type:this.options.type}}),w.startDraw({type:"polyline",minMaxPoints:{min:2,max:2,isSuper:!1},style:e.style||{lineType:"glow",color:"#ebe12c",width:9,glowPower:.1}})},showAddPointLength:function(e){},showMoveDrawing:function(e){var t=w.getPositions(e);if(!(t.length<2)){var i=Cesium.Cartographic.fromCartesian(t[0]),r=Cesium.Cartographic.fromCartesian(t[1]),n=Math.abs(r.height-i.height),o=m(n,this.options.unit);this.totalLable.position=a.getMidPosition(t[0],t[1]),this.totalLable.label.text="高度差:"+o,this.totalLable.label.show=!0,this.totalLable.attribute.value=n,this.totalLable.attribute.textEx="高度差:",this.options.calback&&this.options.calback(o,n)}},showDrawEnd:function(e){e._totalLable=this.totalLable,this.totalLable=null}},S={options:null,totalLable:null,xLable:null,hLable:null,clearLastNoEnd:function(){null!=this.totalLable&&_.entities.remove(this.totalLable),null!=this.xLable&&_.entities.remove(this.xLable),null!=this.hLable&&_.entities.remove(this.hLable),this.totalLable=null,this.xLable=null,this.hLable=null},start:function(e){this.options=e;var t=n.attribute2Entity({style:v},{horizontalOrigin:Cesium.HorizontalOrigin.RIGHT,verticalOrigin:Cesium.VerticalOrigin.CENTER,show:!1});this.totalLable=_.entities.add({label:t,isMarsMeasureLabel:!0,attribute:{unit:this.options.unit,type:this.options.type}});var i=n.attribute2Entity({style:v},{horizontalOrigin:Cesium.HorizontalOrigin.CENTER,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,show:!1});i.pixelOffset=new Cesium.Cartesian2(0,0),this.xLable=_.entities.add({label:i,isMarsMeasureLabel:!0,attribute:{unit:this.options.unit,type:this.options.type}}),this.hLable=_.entities.add({label:i,isMarsMeasureLabel:!0,attribute:{unit:this.options.unit,type:this.options.type}}),w.startDraw({type:"polyline",minMaxPoints:{min:2,max:2,isSuper:!0},style:e.style||{lineType:"glow",color:"#ebe12c",width:9,glowPower:.1}})},showAddPointLength:function(e){var t=w.getPositions(e);if(4==t.length){var i=t[3].clone();t.pop(),t.pop(),t.pop(),t.push(i)}if(2==t.length){var r=a.getZHeightPosition(t[0],t[1]);a.getHDistance(t[0],t[1])>3&&(t.push(r),t.push(t[0]))}this.showSuperHeight(t)},showMoveDrawing:function(e){var t=w.getPositions(e);if(4==t.length){var i=t[3].clone();t.pop(),t.pop(),t.pop(),t.push(i)}if(2==t.length){var r=a.getZHeightPosition(t[0],t[1]);a.getHDistance(t[0],t[1])>3&&(t.push(r),t.push(t[0]))}this.showSuperHeight(t)},showDrawEnd:function(e){e._arrLables=[this.totalLable,this.hLable,this.xLable],this.totalLable=null,this.hLable=null,this.xLable=null},showSuperHeight:function(e){var t,i,r,n;if(4==e.length){var o,s,l=a.getMidPosition(e[0],e[1]),u=Cesium.Cartographic.fromCartesian(e[0]),c=Cesium.Cartographic.fromCartesian(e[1]),h=Cesium.Cartographic.fromCartesian(e[2]),d=c.height-h.height;n=c.height-u.height,r=Cesium.Cartesian3.distance(e[0],e[1]),n>-1&&n<1?(s=e[1],this.updateSuperHeightLabel(this.totalLable,s,"高度差:",n),this.updateSuperHeightLabel(this.hLable,l,"",r)):(d>-.1&&d<.1?(o=a.getMidPosition(e[2],e[1]),s=a.getMidPosition(e[2],e[3]),i=Cesium.Cartesian3.distance(e[1],e[2]),t=Cesium.Cartesian3.distance(e[3],e[2])):(s=a.getMidPosition(e[2],e[1]),o=a.getMidPosition(e[2],e[3]),i=Cesium.Cartesian3.distance(e[3],e[2]),t=Cesium.Cartesian3.distance(e[1],e[2])),this.updateSuperHeightLabel(this.totalLable,s,"高度差:",t),this.updateSuperHeightLabel(this.xLable,o,"",i),this.updateSuperHeightLabel(this.hLable,l,"",r))}else if(2==e.length){t=Cesium.Cartesian3.distance(e[1],e[0]);var s=a.getMidPosition(e[0],e[1]);xLable.label.show&&(xLable.label.show=!1,hLable.label.show=!1),this.updateSuperHeightLabel(this.totalLable,s,"高度差:",t)}var p=m(t,this.options.unit);this.options.calback&&this.options.calback(p,t)},updateSuperHeightLabel:function(e,t,i,r){null!=e&&(e.position=t,e.label.text=i+m(r,this.options.unit),e.label.show=!0,e.attribute.value=r,e.attribute.textEx=i)}},P={options:null,totalLable:null,exLine:null,clearLastNoEnd:function(){null!=this.totalLable&&_.entities.remove(this.totalLable),this.totalLable=null,null!=this.exLine&&_.entities.remove(this.exLine),this.exLine=null},start:function(e){this.options=e;var t=n.attribute2Entity({style:v},{horizontalOrigin:Cesium.HorizontalOrigin.LEFT,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,show:!1});this.totalLable=_.entities.add({label:t,isMarsMeasureLabel:!0,attribute:{unit:this.options.unit,type:this.options.type}}),w.startDraw({type:"polyline",minMaxPoints:{min:2,max:2},style:e.style||{lineType:"arrow",color:"#ebe967",width:9,clampToGround:!0}})},showAddPointLength:function(e){},showMoveDrawing:function(e){var t=w.getPositions(e);if(!(t.length<2)){var i=Cesium.Cartesian3.distance(t[0],t[1]),r=s.formatPositon(t[0]),n=s.formatPositon(t[1]),a=turf.point([r.x,r.y,r.z]),o=turf.point([n.x,n.y,n.z]),l=Math.round(turf.rhumbBearing(a,o)),u=turf.destination(a,i/3e3,0,{units:"kilometers"});u={x:u.geometry.coordinates[0],y:u.geometry.coordinates[1],z:r.z};var c=Cesium.Cartesian3.fromDegrees(u.x,u.y,u.z);this.updateExLine([t[0],c]),this.totalLable.position=t[1],this.totalLable.label.text="角度:"+l+"°\n距离:"+m(i),this.totalLable.label.show=!0,this.totalLable.attribute.value=l,this.totalLable.attribute.textEx="角度:",this.options.calback&&this.options.calback(l+"°",l)}},updateExLine:function(e){this.exLine?this.exLine.polyline.positions.setValue(e):this.exLine=_.entities.add({polyline:{positions:e,width:3,clampToGround:!0,material:new Cesium.PolylineDashMaterialProperty({color:Cesium.Color.RED})}})},showDrawEnd:function(e){e._totalLable=this.totalLable,this.totalLable=null,this.exLine=null}};return{measuerLength:t,measureHeight:c,measureArea:u,measureSection:l,measureAngle:h,updateUnit:g,clearMeasure:p,formatArea:f,formatLength:m}};t.default=l},function(e,t,i){"use strict";function r(e){e=e||{},this.citycode=e.citycode||"",this.gaodekey=e.key||["c95467d0ed2a3755836e37dc27369f97","4320dda936d909d73ab438b4e29cf2a2","e64a96ed7e361cbdc0ebaeaf3818c564","df3247b7df64434adecb876da94755d7","d4375ec477cb0a473c448fb1f83be781","13fdd7b2b90a9d326ae96867ebcc34ce","c34502450ae556f42b21760faf6695a0","57f8ebe12797a73fc5b87f5d4ef859b1"]}Object.defineProperty(t,"__esModule",{value:!0});var n=i(11);r.prototype.getOneKey=function(){var e=this.gaodekey;return e[Math.floor(Math.random()*e.length+1)-1]},r.prototype.geocode=function(e,t){var i=this,r=this.getOneKey();return new Cesium.Resource({url:"http://restapi.amap.com/v3/place/text",queryParameters:{key:r,city:this.citycode,keywords:e}}).fetchJson().then(function(t){if(0==t.status)return void haoutil.msg("请求失败("+t.infocode+")："+t.info);if(0===t.pois.length)return void haoutil.msg("未查询到“"+e+"”相关数据！");var r=3e3;return i.viewer.camera.positionCartographic.height<r&&(r=i.viewer.camera.positionCartographic.height),t.pois.map(function(e){var t=e.location.split(",");t=n.gcj2wgs(t);var a=i.viewer.mars.point2map({x:t[0],y:t[1]});return{displayName:e.name,destination:Cesium.Cartesian3.fromDegrees(a.x,a.y,r)}})})},t.default=r},function(e,t,i){"use strict";function r(e){function t(e){switch(e){case 38:case"W".charCodeAt(0):return"moveForward";case"S".charCodeAt(0):case 40:return"moveBackward";case"D".charCodeAt(0):case 39:return"moveRight";case"A".charCodeAt(0):case 37:return"moveLeft";case"Q".charCodeAt(0):return"moveUp";case"E".charCodeAt(0):return"moveDown";default:return}}function i(t){var i=e.camera,r=i.direction,n=Cesium.Cartesian3.normalize(i.position,new Cesium.Cartesian3),a=Cesium.Cartesian3.cross(r,n,new Cesium.Cartesian3);r=Cesium.Cartesian3.cross(n,a,new Cesium.Cartesian3),r=Cesium.Cartesian3.normalize(r,r),r=Cesium.Cartesian3.multiplyByScalar(r,t,r),i.position=Cesium.Cartesian3.add(i.position,r,i.position)}var r=e.scene,n=e.canvas;n.setAttribute("tabindex","0"),n.onclick=function(){n.focus()};var o=r.globe.ellipsoid;r.screenSpaceCameraController.enableRotate=!1,r.screenSpaceCameraController.enableTranslate=!1,r.screenSpaceCameraController.enableZoom=!1,r.screenSpaceCameraController.enableTilt=!1,r.screenSpaceCameraController.enableLook=!1;var s,l,u={looking:!1,moveForward:!1,moveBackward:!1,moveUp:!1,moveDown:!1,moveLeft:!1,moveRight:!1},c=100,h=new Cesium.ScreenSpaceEventHandler(n);h.setInputAction(function(e){u.looking=!0,l=s=Cesium.Cartesian3.clone(e.position)},Cesium.ScreenSpaceEventType.LEFT_DOWN),h.setInputAction(function(e){l=e.endPosition},Cesium.ScreenSpaceEventType.MOUSE_MOVE),h.setInputAction(function(e){u.looking=!1},Cesium.ScreenSpaceEventType.LEFT_UP),h.setInputAction(function(e){c*=e>0?.8:1.2,console.log(e)},Cesium.ScreenSpaceEventType.WHEEL),document.addEventListener("keydown",function(e){var i=t(e.keyCode);void 0!==i&&(u[i]=!0)},!1),document.addEventListener("keyup",function(e){var i=t(e.keyCode);void 0!==i&&(u[i]=!1)},!1),a=function(t){var r=e.camera;if(u.looking){var a=n.clientWidth,h=n.clientHeight,d=(l.x-s.x)/a,p=-(l.y-s.y)/h;r.lookRight(.05*d),r.lookUp(.05*p);var g=r.direction,f=Cesium.Cartesian3.normalize(r.position,new Cesium.Cartesian3),m=Cesium.Cartesian3.cross(g,f,new Cesium.Cartesian3);f=Cesium.Cartesian3.cross(m,g,new Cesium.Cartesian3),r.up=f,r.right=m}var y=o.cartesianToCartographic(r.position).height,v=y/c;u.moveForward&&i(v),u.moveBackward&&i(-v),u.moveUp&&r.moveUp(v),u.moveDown&&r.moveDown(v),u.moveLeft&&r.moveLeft(v),u.moveRight&&r.moveRight(v)},e.clock.onTick.addEventListener(a)}function n(e){var t=e.scene;e.canvas;t.screenSpaceCameraController.enableRotate=!0,t.screenSpaceCameraController.enableTranslate=!0,t.screenSpaceCameraController.enableZoom=!0,t.screenSpaceCameraController.enableTilt=!0,t.screenSpaceCameraController.enableLook=!0,a&&(e.clock.onTick.removeEventListener(a),a=void 0)}Object.defineProperty(t,"__esModule",{value:!0}),i.d(t,"bind",function(){return r}),i.d(t,"unbind",function(){return n});var a},function(module,__webpack_exports__,__webpack_require__){"use strict";function isOnly(e){_isOnly=e}function init(e){viewer=e;$("#"+viewer._container.id).append('<div id="pupup-all-view" ></div>'),handler=new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas),handler.setInputAction(mousePickingClick,Cesium.ScreenSpaceEventType.LEFT_CLICK),viewer.scene.postRender.addEventListener(bind2scene)}function mousePickingClick(e){_isOnly&&close();var t=e.position,i=viewer.scene.pick(t);if(i&&Cesium.defined(i.id)&&Cesium.defined(i.id.popup)){var r,n=i.id;return r=n.billboard||n.label||n.point?i.primitive.position:_latlng.getCurrentMousePosition(viewer.scene,t),void show(n,r)}if(i&&Cesium.defined(i.primitive)&&Cesium.defined(i.primitive.popup)){var r=_latlng.getCurrentMousePosition(viewer.scene,t);return void show(i.primitive,r)}pickImageryLayerFeatures(t)}function pickImageryLayerFeatures(e){var t=viewer.scene,i=t.camera.getPickRay(e),r=t.imageryLayers.pickImageryLayerFeatures(i,t);Cesium.defined(r)&&Cesium.when(r,function(t){if(Cesium.defined(t)&&0!==t.length){var i=t[0];if(i.imageryLayer&&i.imageryLayer.config){var r=getPopupForConfig(i.imageryLayer.config,i.properties);if(r){var n=_latlng.getCurrentMousePosition(viewer.scene,e);show({id:"imageryLayerFeaturePromise",popup:{html:r,anchor:i.imageryLayer.config.popupAnchor||[0,-12]}},n)}}}},function(){})}function show(e,t){if(null!=e&&null!=e.popup){var i="popup-"+((e.id||"")+"").replace(new RegExp("\\.","gm"),"_");close(i),objPopup[i]={popup:e.popup,cartesian:t};var r;if((r="object"==typeof e.popup?e.popup.html:e.popup)&&("function"==typeof r&&(r=r(e)),r)){r='<div id="'+i+'" class="cesium-popup">            <a class="cesium-popup-close-button cesium-popup-color" href="javascript:viewer.mars.popup.close(\''+i+'\')">×</a>            <div class="cesium-popup-content-wrapper cesium-popup-background">                <div class="cesium-popup-content cesium-popup-color">'+r+'</div>            </div>            <div class="cesium-popup-tip-container"><div class="cesium-popup-tip cesium-popup-background"></div></div>        </div>',$("#pupup-all-view").append(r);return updateViewPoint(i,t,e.popup)?void 0:void close(i)}}}function updateViewPoint(e,t,i){var r=Cesium.SceneTransforms.wgs84ToWindowCoordinates(viewer.scene,t);if(null==r)return!1;var n=$("#"+e),a=r.x-n.width()/2,o=r.y-n.height();return i&&"object"==typeof i&&i.anchor&&(a+=i.anchor[0],o+=i.anchor[1]),n.css("transform","translate3d("+a+"px,"+o+"px, 0)"),!0}function bind2scene(){for(var e in objPopup){var t=objPopup[e];updateViewPoint(e,t.cartesian,t.popup)||close(e)}}function close(e){!_isOnly&&e?($("#"+e).remove(),delete objPopup[e]):($("#pupup-all-view").empty(),objPopup={})}function destroy(){close(),handler.destroy(),viewer.scene.postRender.removeEventListener(bind2scene)}function template(e,t){for(var i in t){var r=t[i];null!=r&&"Null"!=r&&"Unknown"!=r||(r=""),"_"==i.substr(0,1)&&(i=i.substring(1)),e=e.replace(new RegExp("{"+i+"}","gm"),r)}return e}function getPopupForConfig(e,t){var i=e.popupNameField?t[e.popupNameField]:e.name;return e.popup?getPopup(e.popup,t,i):!!e.columns&&getPopup(e.columns,t,i)}function getPopup(cfg,attr,title){if(!attr)return!1;if(title=title||"",L.Util.isArray(cfg)){for(var countsok=0,inhtml='<div class="mars-popup-titile">'+title+'</div><div class="mars-popup-content" >',i=0;i<cfg.length;i++){var thisfield=cfg[i],col=thisfield.field;if("object"==typeof attr[col]&&attr[col].hasOwnProperty("getValue")&&(attr[col]=attr[col].getValue()),"function"!=typeof attr[col])if("details"!=thisfield.type){var showval=$.trim(attr[col]);if(null!=showval&&""!=showval&&"Null"!=showval&&"Unknown"!=showval&&"0"!=showval&&0!=showval.length){if(thisfield.format)try{showval=eval(thisfield.format+"("+showval+")")}catch(e){console.log("getPopupByConfig error:"+thisfield.format)}thisfield.unit&&(showval+=thisfield.unit),inhtml+="<div><label>"+thisfield.name+"</label>"+showval+"</div>",countsok++}}else{var showval=$.trim(attr[col||"OBJECTID"]);if(null==showval||""==showval||"Null"==showval||"Unknown"==showval)continue;inhtml+='<div style="text-align: center;padding: 10px 0;"><button type="button" onclick="'+thisfield.calback+"('"+showval+'\');" " class="btn btn-info  btn-sm">'+(thisfield.name||"查看详情")+"</button></div>"}}return inhtml+="</div>",0!=countsok&&inhtml}if("object"!=typeof cfg){if("all"==cfg){var countsok=0,inhtml='<div class="mars-popup-titile">'+title+'</div><div class="mars-popup-content" >';for(var col in attr)if("Shape"!=col&&"FID"!=col&&"OBJECTID"!=col&&"_definitionChanged"!=col&&"_propertyNames"!=col&&("_"==col.substr(0,1)&&(col=col.substring(1)),"object"==typeof attr[col]&&attr[col].hasOwnProperty("getValue")&&(attr[col]=attr[col].getValue()),"function"!=typeof attr[col])){var showval=$.trim(attr[col]);null!=showval&&""!=showval&&"Null"!=showval&&"Unknown"!=showval&&"0"!=showval&&0!=showval.length&&(inhtml+="<div><label>"+col+"</label>"+showval+"</div>",countsok++)}return inhtml+="</div>",0!=countsok&&inhtml}return template(cfg,attr)}switch(cfg.type){case"iframe":var _url=_util.template(cfg.url,attr),inhtml='<iframe id="ifarm" src="'+_url+'"  style="width:'+(cfg.width||"300")+"px;height:"+(cfg.height||"300")+'px;overflow:hidden;margin:0;" scrolling="no" frameborder="0" ></iframe>';return inhtml;case"javascript":return eval(cfg.calback+"("+JSON.stringify(attr)+")")}return!1}Object.defineProperty(__webpack_exports__,"__esModule",{value:!0}),__webpack_require__.d(__webpack_exports__,"isOnly",function(){return isOnly}),__webpack_require__.d(__webpack_exports__,"init",function(){return init}),__webpack_require__.d(__webpack_exports__,"show",function(){return show}),__webpack_require__.d(__webpack_exports__,"close",function(){return close}),__webpack_require__.d(__webpack_exports__,"destroy",function(){return destroy}),__webpack_require__.d(__webpack_exports__,"getPopup",function(){return getPopup}),__webpack_require__.d(__webpack_exports__,"getPopupForConfig",function(){return getPopupForConfig});var _latlng=__webpack_require__(4),viewer,handler,objPopup={},_isOnly=!0},function(e,t,i){"use strict";function r(e){l=e;$("#"+l._container.id).append('<div id="tooltip-view" class="cesium-popup" style="display:none;">     <div class="cesium-popup-content-wrapper  cesium-popup-background">         <div id="tooltip-content" class="cesium-popup-content cesium-popup-color"></div>     </div>     <div class="cesium-popup-tip-container"><div class="cesium-popup-tip  cesium-popup-background"></div></div></div> '),u=new Cesium.ScreenSpaceEventHandler(l.scene.canvas),u.setInputAction(n,Cesium.ScreenSpaceEventType.MOUSE_MOVE)}function n(e){$(".cesium-viewer").css("cursor","");var t=e.endPosition,i=l.scene.pick(t);if(i&&Cesium.defined(i.id)){var r=i.id;if((r.popup||r.cursorCSS)&&$(".cesium-viewer").css("cursor",r.cursorCSS||"pointer"),!r.tooltip)return void o();if(r.billboard||r.label||r.point){if(c==r)return;c=r}var n=h.getCurrentMousePosition(l.scene,t);a(r,n,t)}else if(i&&Cesium.defined(i.primitive)){var s=i.primitive;if((s.popup||s.cursorCSS)&&$(".cesium-viewer").css("cursor",s.cursorCSS||"pointer"),!s.tooltip)return void o();var n=h.getCurrentMousePosition(l.scene,t);a(s,n,t)}else o()}function a(e,t,i){if(null!=e&&null!=e.tooltip){if(null==i&&(i=Cesium.SceneTransforms.wgs84ToWindowCoordinates(l.scene,t)),null==i)return void o();var r,n=$("#tooltip-view");if(r="object"==typeof e.tooltip?e.tooltip.html:e.tooltip,"function"==typeof r&&(r=r(e)),r){$("#tooltip-content").html(r),n.show();var a=i.x-n.width()/2,s=i.y-n.height(),u=e.tooltip;u&&"object"==typeof u&&u.anchor?(a+=u.anchor[0],s+=u.anchor[1]):s-=10,n.css("transform","translate3d("+a+"px,"+s+"px, 0)")}}}function o(){$("#tooltip-content").empty(),$("#tooltip-view").hide(),c=null}function s(){o(),u.destroy()}Object.defineProperty(t,"__esModule",{value:!0}),i.d(t,"isOnly",function(){return isOnly}),i.d(t,"init",function(){return r}),i.d(t,"show",function(){return a}),i.d(t,"close",function(){return o}),i.d(t,"destroy",function(){return s});var l,u,c,h=i(4)},function(e,t,i){"use strict";function r(e,t){this._GLMap=e,this.dimensions=["lng","lat"],this._mapOffset=[0,0],this._api=t}function n(e,t){this._mapContainer=e,this._overlay=this._createChartOverlay(),this._overlay.setOption(t)}Object.defineProperty(t,"__esModule",{value:!0}),r.prototype.dimensions=["lng","lat"],r.prototype.setMapOffset=function(e){this._mapOffset=e},r.prototype.getBMap=function(){return this._GLMap},r.prototype.dataToPoint=function(e){var t=[999999,999999],i=Cesium.Cartesian3.fromDegrees(e[0],e[1]);if(!i)return t;var r=this._GLMap.cartesianToCanvasCoordinates(i);if(!r)return t;var n=this._mapOffset;return[r.x-n[0],r.y-n[1]]},r.prototype.pointToData=function(e){var t=this._mapOffset,e=this._bmap.project([e[0]+t[0],e[1]+t[1]]);return[e.lng,e.lat]},r.prototype.getViewRect=function(){var e=this._api;return new echarts.graphic.BoundingRect(0,0,e.getWidth(),e.getHeight())},r.prototype.getRoamTransform=function(){return echarts.matrix.create()},r.dimensions=r.prototype.dimensions,r.create=function(e,t){var i;e.eachComponent("GLMap",function(e){var n=t.getZr().painter;if(n){var a=(n.getViewportRoot(),echarts.glMap);i=new r(a,t),i.setMapOffset(e.__mapOffset||[0,0]),e.coordinateSystem=i}}),e.eachSeries(function(e){"GLMap"===e.get("coordinateSystem")&&(e.coordinateSystem=i)})},window.echarts&&(echarts.registerCoordinateSystem("GLMap",r),echarts.registerAction({type:"GLMapRoam",event:"GLMapRoam",update:"updateLayout"},function(e,t){}),echarts.extendComponentModel({type:"GLMap",getBMap:function(){return this.__GLMap},defaultOption:{roam:!1}}),echarts.extendComponentView({type:"GLMap",init:function(e,t){this.api=t,echarts.glMap.postRender.addEventListener(this.moveHandler,this)},moveHandler:function(e,t){this.api.dispatchAction({type:"GLMapRoam"})},render:function(e,t,i){},dispose:function(e){echarts.glMap.postRender.removeEventListener(this.moveHandler,this)}})),n.prototype._createChartOverlay=function(){var e=this._mapContainer.scene;e.canvas.setAttribute("tabIndex",0);var t=document.createElement("div");return t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.width=e.canvas.width+"px",t.style.height=e.canvas.height+"px",t.style.pointerEvents="none",t.setAttribute("id","echarts"),t.setAttribute("class","echartMap"),this._mapContainer.container.appendChild(t),this._echartsContainer=t,echarts.glMap=e,echarts.init(t)},n.prototype.dispose=function(e){this._echartsContainer&&(this._mapContainer.container.removeChild(this._echartsContainer),this._echartsContainer=null),this._overlay&&(this._overlay.dispose(),this._overlay=null)},n.prototype.updateOverlay=function(e){this._overlay&&this._overlay.setOption(e)},n.prototype.getMap=function(){return this._mapContainer},n.prototype.getOverlay=function(){return this._overlay},n.prototype.show=function(){document.getElementById(this._id).style.visibility="visible"},n.prototype.hide=function(){document.getElementById(this._id).style.visibility="hidden"},t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=L.Class.extend({viewer:null,options:{},config:{},path:"",isActivate:!1,isCreate:!1,initialize:function(e,t){this.viewer=t,this.config=e,this.path=e.path||"",this.init()},addCacheVersion:function(e){if(null==e)return e;var t=mars3d.widget.getCacheVersion();return t&&(-1==e.indexOf("?")?e+="?time="+t:-1==e.indexOf("time="+t)&&(e+="&time="+t)),e},activateBase:function(){this.beforeActivate();var e=this;if(this.isActivate)return this.changeWidgetView(function(e){e._dom&&($(".layui-layer").each(function(){$(this).css("z-index",19891e3)}),$(e._dom).css("z-index",19891014))}),this.disable(),void this._startActivate();if(this.isActivate=!0,!this.isCreate){if(this.options.resources&&this.options.resources.length>0){var t=[];(new Date).getTime();mars3d.widget._resources_cache=mars3d.widget._resources_cache||[];for(var i=0;i<this.options.resources.length;i++){var r=this.options.resources[i];r=this._getUrl(r),-1==mars3d.widget._resources_cache.indexOf(r)&&t.push(r)}return mars3d.widget._resources_cache=mars3d.widget._resources_cache.concat(t),void Loader.async(t,function(){if(!e.create(function(){e._createWidgetView(),e.isCreate=!0})){if(e.config.createAtStart)return e.config.createAtStart=!1,e.isActivate=!1,void(e.isCreate=!0);e._createWidgetView(),e.isCreate=!0}})}if(this.create(function(){e._createWidgetView(),this.isCreate=!0}))return;if(e.config.createAtStart)return e.config.createAtStart=!1,e.isActivate=!1,void(e.isCreate=!0);this.isCreate=!0}return this._createWidgetView(),this},_createWidgetView:function(){var e=this.options.view;if(void 0===e||null===e)this._startActivate();else if(L.Util.isArray(e)){this._viewcreate_allcount=e.length,this._viewcreate_okcount=0;for(var t=0;t<e.length;t++)this.createItemView(e[t])}else this._viewcreate_allcount=1,this._viewcreate_okcount=0,this.createItemView(e)},changeWidgetView:function(e){var t=this.options.view;if(void 0===t||null===t)return!1;if(L.Util.isArray(t)){for(var i=!1,r=0;r<t.length;r++)i=i||e(t[r]);return i}return e(t)},createItemView:function(e){switch(e.type){default:case"window":this._openWindow(e);break;case"divwindow":this._openDivWindow(e);break;case"append":this._appendView(e);break;case"custom":var t=this._getUrl(e.url),i=this;e.open(t,function(t){i.winCreateOK(e,t),++i._viewcreate_okcount>=i._viewcreate_allcount&&i._startActivate(t)},this)}},_viewcreate_allcount:0,_viewcreate_okcount:0,_openWindow:function(e){var t=this,i=this._getUrl(e.url),r={type:2,content:[i,"no"],success:function(r){e._dom=r;var n=window[r.find("iframe")[0].name];t.config.hasOwnProperty("visible")&&!t.config.visible&&$(r).hide(),layer.setTop(r),t.winCreateOK(e,n),t._viewcreate_okcount++,t._viewcreate_okcount>=t._viewcreate_allcount&&t._startActivate(r),n&&n.initWidgetView?n.initWidgetView(t):console.error(i+"页面没有定义function initWidgetView(widget)方法，无法初始化widget页面!")}};e._layerIdx=layer.open(this._getWinOpt(e,r))},_openDivWindow:function(e){var t=this._getUrl(e.url),i=this;this.getHtml(t,function(t){var r={type:1,content:t,success:function(t){e._dom=t,i.config.hasOwnProperty("visible")&&!i.config.visible&&$(t).hide(),layer.setTop(t),i.winCreateOK(e,t),++i._viewcreate_okcount>=i._viewcreate_allcount&&i._startActivate(t)}};e._layerIdx=layer.open(i._getWinOpt(e,r))})},_getUrl:function(e){return e=this.addCacheVersion(e),e.startsWith("/")||e.startsWith(".")||e.startsWith("http")?e:this.path+e},_getWinOpt:function(e,t){var i=mars3d.widget.getDefWindowOptions(),r=$.extend(i,e.windowOptions);r=$.extend(r,this.config.windowOptions),e.windowOptions=r;var n=this,a=this._getWinSize(r),o={title:!r.noTitle&&(this.config.name||" "),area:a.area,offset:a.offset,shade:0,maxmin:!1,zIndex:layer.zIndex,end:function(){e._layerIdx=-1,n.disableBase()},full:function(e){n.winFull(e)},min:function(e){n.winMin(e)},restore:function(e){n.winRestore(e)}},s=$.extend(o,r);return $.extend(s,t||{})},_getWinSize:function(e){var t=e.width,i=e.height,r="",n=e.position;if(n)if("string"==typeof n)r=n;else if("object"==typeof n){var a,o;if(n.hasOwnProperty("top")&&null!=n.top&&(a=this.bfb2Number(n.top,document.documentElement.clientHeight,e)),n.hasOwnProperty("bottom")&&null!=n.bottom){e._hasresize=!0;var s=this.bfb2Number(n.bottom,document.documentElement.clientHeight,e);a?i=document.documentElement.clientHeight-a-s:a=document.documentElement.clientHeight-i-s}if(n.hasOwnProperty("left")&&null!=n.left&&(o=this.bfb2Number(n.left,document.documentElement.clientWidth,e)),n.hasOwnProperty("right")&&null!=n.right){e._hasresize=!0;var l=this.bfb2Number(n.right,document.documentElement.clientWidth,e);o?t=document.documentElement.clientWidth-o-l:o=document.documentElement.clientWidth-t-l}null==a&&(a=(document.documentElement.clientHeight-i)/2),null==o&&(o=(document.documentElement.clientWidth-t)/2),r=[a+"px",o+"px"]}var u;return u=t&&i?[t+"px",i+"px"]:t+"px",{area:u,offset:r}},bfb2Number:function(e,t,i){return"string"==typeof e&&-1!=e.indexOf("%")?(i._hasresize=!0,t*Number(e.replace("%",""))/100):e},_appendView:function(e){if(this.isCreate&&e._dom)$(e._dom).show({duration:500}),this._startActivate(e._dom);else{var t=this._getUrl(e.url),i=this;i.getHtml(t,function(t){e._dom=$(t).appendTo(e.parent||"body"),i.winCreateOK(e,t),++i._viewcreate_okcount>=i._viewcreate_allcount&&i._startActivate(t)})}},disableBase:function(){if(this.isActivate){this.changeWidgetView(function(e){return null!=e._layerIdx&&-1!=e._layerIdx?(layer.close(e._layerIdx),e._layerIdx=-1,!0):("append"==e.type&&e._dom&&$(e._dom).hide({duration:1e3}),"custom"==e.type&&e.close&&e.close(),!1)})||(this.disable(),this.isActivate=!1)}},indexResize:function(){var e=this;this.changeWidgetView(function(t){if(null!=t._layerIdx&&-1!=t._layerIdx&&null!=t.windowOptions&&t.windowOptions._hasresize){var i=e._getWinSize(t.windowOptions),r={width:i.area[0],height:i.area[1],top:i.offset[0],left:i.offset[1]};$(t._dom).attr("myTopLeft",!0),layer.style(t._layerIdx,r),"divwindow"==t.type&&layer.iframeAuto(t._layerIdx)}})},_startActivate:function(e){this.activate(e),this.config.success&&this.config.success(this)},init:function(){},create:function(e){},beforeActivate:function(){},activate:function(e){},disable:function(){},winCreateOK:function(e,t){},winFull:function(){},winMin:function(){},winRestore:function(){},getHtml:function(e,t){$.ajax({url:e,type:"GET",dataType:"html",timeout:0,success:function(e){t(e)}})}});t.default=r},function(e,t){!function(e,t){"use strict";function i(e){return"complete"===e.readyState||"loaded"===e.readyState}function r(e,i,r){var n=t.createElement("link");n.rel="stylesheet",o(n,r,"css"),n.async=!0,n.href=e,h.appendChild(n)}function n(e,i,r){var n=t.createElement("script");n.charset="utf-8",o(n,r,"js"),n.async=!i.sync,n.src=e,h.appendChild(n)}function a(e,t){var i;e.sheet&&(i=!0),setTimeout(function(){i?t():a(e,t)},20)}function o(e,t,r){function n(){e.onload=e.onreadystatechange=null,e=null,t()}var o="onload"in e;if("css"===r&&(d||!o))return void setTimeout(function(){a(e,t)},1);o?(e.onload=n,e.onerror=function(){e.onerror=null,"css"==r?console.error("该css文件不存在："+e.href):console.error("该js文件不存在："+e.src),n()}):e.onreadystatechange=function(){i(e)&&n()}}function s(e,t,i,a){function o(){var i=t.indexOf(e);i>-1&&t.splice(i,1),0===t.length&&a()}if(!e)return void setTimeout(function(){o()});c.test(e)?r(e,i,o):n(e,i,o)}function l(e,t,i){var r=function(){i&&i()};if(e=Array.prototype.slice.call(e||[]),0===e.length)return void r();for(var n=0,a=e.length;n<a;n++)s(e[n],e,t,r)}function u(t,r){if(i(t))r();else{var n=!1;e.addEventListener("load",function(){n||(r(),n=!0)}),setTimeout(function(){n||(r(),n=!0)},1500)}}var c=new RegExp("\\.css"),h=t.head||t.getElementsByTagName("head")[0],d=+navigator.userAgent.replace(/.*(?:AppleWebKit|AndroidWebKit)\/?(\d+).*/i,"$1")<536,p={async:function(e,i){u(t,function(){l(e,{},i)})},sync:function(e,i){u(t,function(){l(e,{sync:!0},i)})}};e.Loader=p}(window,document)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,i){C=e,t=t||{},M=i||"",x=[],b=t.defaultOptions||{windowOptions:{position:"rt",maxmin:!1,resize:!0},autoDisable:!0,disableOhter:!0},"time"==(v=t.version)&&(v=(new Date).getTime());var n=t.widgetsAtStart;if(n&&n.length>0)for(var a=0;a<n.length;a++){var o=n[a];o.hasOwnProperty("uri")&&""!=o.uri?o.hasOwnProperty("visible")&&!o.visible||(o.autoDisable=!1,o.openAtStart=!0,o._nodebug=!0,r(o),x.push(o)):console.log("widget未配置uri："+JSON.stringify(o))}var s=t.debugger;if(s){var l='<div id="widget-testbar" class="widgetbar animation-slide-bottom no-print-view" >      <div style="height: 30px; line-height:30px;"><b style="color: #4db3ff;">widget测试栏</b>&nbsp;&nbsp;<button type="button" onclick="mars3d.widget.removeDebugeBar();" class="btn btn-link btn-xs">关闭</button> </div>     <button type="button" class="btn btn-info"  onclick="mars3d.widget.disableAll()" ><i class="fa fa-globe"></i>漫游</button></div>';$("body").append(l)}if((n=t.widgets)&&n.length>0)for(var a=0;a<n.length;a++){var o=n[a];if("group"==o.type){for(var l=' <div class="btn-group dropup">  <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-expanded="false"><i class="fa fa-align-justify"></i>'+o.name+' <span class="caret"></span></button> <ul class="dropdown-menu">',u=0;u<o.children.length;u++){var c=o.children[u];r(c),l+=" <li onclick=\"mars3d.widget.activate('"+c.uri+"',"+!c.disableOhter+')" ><a href="#"><i class="fa fa-star"></i>'+c.name+"</a></li>",c.hasOwnProperty("uri")&&""!=c.uri?x.push(c):console.log("widget未配置uri："+JSON.stringify(c))}l+="</ul></div>",s&&!o._nodebug&&$("#widget-testbar").append(l)}else{if(r(o),s&&!o._nodebug){var l='   <button type="button" class="btn btn-primary" onclick="mars3d.widget.activate(\''+o.uri+"',"+!o.disableOhter+')"  > <i class="fa fa-globe"></i>'+o.name+" </button>";$("#widget-testbar").append(l)}if(!o.hasOwnProperty("uri")||""==o.uri){console.log("widget未配置uri："+JSON.stringify(o));continue}x.push(o)}}for(var a=0;a<x.length;a++){var o=x[a];(o.openAtStart||o.createAtStart)&&E.push(o)}$(window).resize(function(){for(var e=0;e<x.length;e++){var t=x[e];t._class&&t._class.indexResize()}}),h()}function t(){return i(b.windowOptions)}function i(e,t){if(null==e||"object"!=typeof e)return e;if(e.constructor!=Object&&e.constructor!=Array)return e;if(e.constructor==Date||e.constructor==RegExp||e.constructor==Function||e.constructor==String||e.constructor==Number||e.constructor==Boolean)return new e.constructor(e);t=t||new e.constructor;for(var r in e)t[r]=void 0===t[r]?i(e[r],null):t[r];return t}function r(e){if(b)for(var t in b)"windowOptions"==t||e.hasOwnProperty(t)||(e[t]=b[t]);e.path=g(M+e.uri),e.name=e.name||e.label}function n(t,i){null==C&&t.viewer&&e(t.viewer),"string"==typeof t&&(t={uri:t},null!=i&&(t.disableOhter=!i));for(var n,a=0;a<x.length;a++){var o=x[a];if(t.uri==o.uri||o.id&&t.uri==o.id){n=o;for(var s in t)"uri"!=s&&(n[s]=t[s]);break}}if(null==n&&(r(t),n=t,x.push(t)),n.disableOhter&&u(n.uri),n._class)if(n._class.isActivate)if(n._class.update)n._class.update();else{n._class.disableBase();var l=setInterval(function(){n._class.isActivate||(n._class.activateBase(),clearInterval(l))},200)}else n._class.activateBase();else{for(var a=0;a<E.length;a++)if(E[a].uri==n.uri)return E[a];E.push(n),1==E.length&&h()}return n}function a(e){for(var t=0;t<x.length;t++){var i=x[t];if(e==i.uri||e==i.id)return i}}function o(e){var t=a(e);return t?t._class:null}function s(e){var t=o(e);return null!=t&&t.isActivate}function l(e){if(null!=e)for(var t=0;t<x.length;t++){var i=x[t];if(i._class&&(e==i.uri||e==i.id)){i._class.disableBase();break}}}function u(e){for(var t=0;t<x.length;t++){var i=x[t];i.autoDisable&&((!e||e!=i.uri&&e!=i.id)&&i._class&&i._class.disableBase())}}function c(e){for(var t=0;t<x.length;t++){e(x[t])}}function h(){if(0!=E.length){if(_)return void setTimeout(h,500);_=!0,w=E[0];var e=w.uri;v&&(-1==e.indexOf("?")?e+="?time="+v:e+="&time="+v),window.NProgress&&NProgress.start(),Loader.async([M+e],function(){_=!1,window.NProgress&&NProgress.done(!0),E.shift(),h()})}}function d(e){if(null!=w)return w._class=new e(w,C),w._class.activateBase(),w._class;for(var t=p(),i=0;i<x.length;i++){var r=x[i];if(t.endsWith(r.uri))return r._class=new e(r,C),r._class.activateBase(),r._class}}function p(){for(var e,t=document.scripts,i=t.length-1;i>=0;i--)if(null!=(e=t[i].src)&&""!=e&&-1!=e.indexOf("widgets"))return e;return""}function g(e){var t=e.lastIndexOf("/");return e.substring(0,t+1)}function f(){$("#widget-testbar").remove()}function m(){return v}function y(){return M}var v,b,C,w,_,x=[],M="",E=[];return{init:e,isActivate:s,activate:n,disable:l,disableAll:u,eachWidget:c,getWidget:a,getClass:o,removeDebugeBar:f,bindClass:d,getDefWindowOptions:t,getCacheVersion:m,getBasePath:y}}();t.default=r},function(e,t,i){e.exports=i(23)}]);
